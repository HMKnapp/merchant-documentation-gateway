[#MOLPay]
=== MOLPay

[#MOLPay_Introduction]
==== Introduction
[.clearfix]
--
[.right]
image::images/11-44-molpay/molpay_logo.png[MOLPay Logo, width=200]

_MOLPay_ is a payment provider supporting online merchants to establish and expand in the Southeast Asian market. +
During checkout, consumers are redirected to the _MOLPay_ payment page,
and from there to the consumer's financial institution payment page, where they complete the payment process. +
_MOLPay_ is offered in collecting model.
--

[#MOLPay_GeneralInformation]
==== General Information

[#MOLPay_PaymentMode]
===== Payment Mode, Countries and Currencies

This table illustrates which payment mode _MOLPay_ belongs to. It
also provides detailed information about the countries and currencies
which are relevant for _MOLPay_.

[%autowidth]
[stripes=none]
[cols=",",]
|===
h|Payment Mode
|<<PaymentMethods_PaymentMode_OnlineBankTransfer, Online Bank Transfer>>
h|Countries
|Malaysia, Singapore, China, Philippines, Indonesia (coming soon), Vietnam, Thailand
h|Currencies
|*Processing:* MYR, SGD, IDR, RMB/CNY, THB, VND, PHP +
*Settlement:* local currency/USD
|===

[#MOLPay_Channels]
===== Available Payment Methods (Channels)

A channel is a combination of a payment method and a consumer bank.
This table shows all available channels that a consumer can make a payment through:

[%autowidth]
[frame=all]
[cols="v,v,,"]
|===
h|Payment Method
(Channel)
h|Name
h|Country
h|Currency
|alipay
|Alipay
|China
|RMB/CNY/USD/MYR/SGD
|cimbclicks
|CIMB Clicks
|Malaysia
|MYR
|maybank2u
|Maybank2u
|Malaysia
|MYR
|fpx_amonline
|FPX B2C AmOnline
|Malaysia
|MYR
|fpx_muamalat
|FPX B2C Bank
Muamalat
|Malaysia
|MYR
|fpx_bankrakyat
|FPX B2C Bank Rakyat
|Malaysia
|MYR
|fpx_bimb
|FPX B2C Bank Islam
|Malaysia
|MYR
|dragonpay
|Dragonpay
|Philippines
|PHP
|fpx_abb
|FPX B2C Affin Bank
|Malaysia
|MYR
|fpx_abmb
|FPX B2C Alliance Bank
|Malaysia
|MYR
|fpx_bsn
|FPX B2C Bank
Simpanan Nasional
|Malaysia
|MYR
|fpx_ocbc
|FPX B2C OCBC
|Malaysia
|MYR
|fpx_scb
|FPX B2C Standard
Chartered
|Malaysia
|MYR
|fpx_uob
|FPX B2C United
Overseas Bank
|Malaysia
|MYR
|fpx_hlbconnect
|FPX B2C Hong Leong
|Malaysia
|MYR
|nganluong
|NganLuong
|Vietnam
|VND
|omise
|Omise
|Thailand
|THB
|omise_bay
|Krungsri e-Payment
via Omise
|Thailand
|THB
|omise_bbl
|Bangkok Bank
via Omise
|Thailand
|THB
|omise_ktb
|Krung Thai Bank
via Omise
|Thailand
|THB
|omise_scb
|Siam Commercial Bank
via Omise
|Thailand
|THB
|omise_tl
|Tesco Lotus
via Omise
|Thailand
|THB
|fpx_pbb
|FPX B2C Public Bank
|Malaysia
|MYR
|fpx_rhbnow
|FPX B2C RHB Bank
|Malaysia
|MYR
|singpost
|SAM by SingPost
|Singapore
|SGD
|UPOP
|UnionPay
|China
|CNY/USD/MYR
|vtcpay
|VTC Pay
|Vietnam
|VND
|===

[#MOLPay_CommunicationFormats]
===== Communication Formats

This table illustrates how _MOLPay_ notifications are encoded and
which formats and methods can be used for requests and responses.

[%autowidth]
[stripes=none]
|===
.2+h|Requests/Responses |Format |XML, JSON
   |Methods
   |POST
h|IPN Encodement
2+|Please follow the instructions given at <<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===

[#MOLPay_TransactionTypes]
==== Transaction Types

This table lists all transaction types available for _MOLPay_.

NOTE: Some of the transaction types cannot be used in the requests. Refer to
the columns below for an overview.

For <<Glossary_TransactionType, transaction type>> details which are not given here, look
at <<AppendixB, Appendix B: Transaction Types>>.

[%autowidth]
[stripes=none]
[cols="v,,,,,v"]
|===
|Transaction Type |Description |Request <<MOLPay_TransactionTypes_RequestFootnote, [1]>> |Response/IPN <<MOLPay_TransactionTypes_RequestFootnote, [2]>> |WEP <<MOLPay_TransactionTypes_RequestFootnote, [3]>> v|Link to sample

|_debit_ |Creates a request to charge the specified amount from the
consumer’s bank account. |YES | YES |YES
|<<MOLPay_samples_debit, debit sample>>

|_get-url_ |Retrieves the URL of the MOLPay landing page for the
consumer to be redirected to. |NO |YES |YES | 
|===

[#MOLPay_TransactionTypes_RequestFootnote]
[1] YES in "Request" indicates that the transaction type is sent in the request.

[#MOLPay_TransactionTypes_ResponseFootnote]
[2] YES in "Response/IPN" indicates that the transaction type appears in either response or notification.

[#MOLPay_TransactionTypes_WEPFootnote]
[3] YES in" WEP" indicates that the transaction type is visible in Wirecard Enterprise Portal.


[#MOLPay_TestCredentials]
==== Test Credentials

[cols=",,"]
[%autowidth]
[stripes=none]
|===
h|URL (Endpoint)
|For transaction type ``debit`` (REST API)
|``\https://api-test.wirecard.com/engine/rest/paymentmethods/``
h|Merchant Account ID (MAID)
2+|0518ac4e-a622-48d8-87f5-a04835ded715
h|Username
2+|Molpay-EETest
h|Password
2+|he04YtvH
h|Secret Key
2+|39c6793b-888b-4dd6-a5ac-f6b844418451
|===

[#MOLPay_Workflow]
==== Workflow
[#MOLPay_debit]
===== debit

[#MOLPay_debit_RESTAPI]
====== Payment Process Using REST API

image::images/11-44-molpay/MOLPay_workflow_debit_RESTAPI.png[Debit Workflow with REST API, width=950]

. Consumer initiates a debit transaction.
. Merchant sends a request to the WPG endpoint. This request must contain 
  ** the transaction type ``debit``
  ** the selected payment method (channel)
  ** consumer's data
  ** payment data ()
. WPG sends a response to merchant. This response contains a generated URL to MOLPay's landing page (field “payment-methods/payment-method/@url”).
. With this URL, the merchant redirects the consumer to MOLPay's landing page.
. The consumer submits the transaction on MOLPay's landing page and is redirected to their online banking.
. The consumer finishes the payment in their online banking system. Optionally, the consumer can be redirected back to the shop.
. WPG sends a success/failure notification to the merchant.

//-

[#MOLPay_debit_HPP]
====== Payment Process Using HPP

image::images/11-44-molpay/MOLPay_workflow_debit_HPP.png[Debit Workflow with HPP, width=950]

. Consumer selects one of the _MOLPay_ payment methods (channel).
. WPG redirects the consumer to the _MOLPay_ landing page.
. The consumer submits the transaction on the _MOLPay_ landing page and is redirected to their online banking. 
. The consumer finishes the payment in their online banking system. Optionally, the consumer can be redirected back to the shop.
. WPG sends a success/failure notification to the merchant.

//-

[#MOLPay_Fields]
==== Fields

The fields used for _MOLPay_ requests, responses and
notifications are the same as the REST API Fields. Please refer to the <<RestApi_Fields, REST API field list>> or the request example for the fields required in
a <<MOLPay_samples_debit, debit>> transaction.

[#MOLPay_Samples]
==== Samples

[#MOLPay_samples_debit]
===== debit

.XML debit Request (Successful)

[source, XML]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>0518ac4e-a622-48d8-87f5-a04835ded715</merchant-account-id>
  <request-id>{{$guid}}</request-id>
  <transaction-type>debit</transaction-type>
  <requested-amount currency="MYR">10</requested-amount>
  <account-holder>
    <first-name>John</first-name>
    <last-name>Doe</last-name>
    <email>john@doe.com</email>
    <phone>+123456789</phone>
  </account-holder>
  <descriptor>description</descriptor>
  <payment-methods>
    <payment-method name="fpx_abb"/>
  </payment-methods>
  <country>MY</country>
  <cancel-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/cancel</cancel-redirect-url>
  <fail-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/error</fail-redirect-url>
  <success-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/success</success-redirect-url>
</payment>
----

.XML debit Response (Successful)

[source, XML]
----
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<payment xmlns="http://www.elastic-payments.com/schema/payment">
    <merchant-account-id>0518ac4e-a622-48d8-87f5-a04835ded715</merchant-account-id>
    <transaction-id>f3efe8e4-c1eb-4600-878b-b1df4f9beef3</transaction-id>
    <request-id>e8537162-91d7-4ffe-8623-1f2f7ea69d88</request-id>
    <transaction-type>debit</transaction-type>
    <transaction-state>success</transaction-state>
    <completion-time-stamp>2019-07-09T09:15:28.000Z</completion-time-stamp>
    <statuses>
        <status code="201.0000" description="The resource was successfully created." severity="information"/>
    </statuses>
    <requested-amount currency="MYR">10</requested-amount>
    <account-holder>
        <first-name>John</first-name>
        <last-name>Doe</last-name>
        <email>john@doe.com</email>
        <phone>+123456789</phone>
    </account-holder>
    <descriptor>description</descriptor>
    <payment-methods>
        <payment-method url="https://sandbox.molpay.com/MOLPay/pay/SB_wirecard/FPX_ABB.php?amount=10&amp;orderid=f3efe8e4c1eb4600878bb1df4f9beef3&amp;cur=MYR&amp;vcode=a480484d84ea0ec762b95af7cad2cef4&amp;bill_desc=description&amp;bill_mobile=%2B123456789&amp;bill_email=john%40doe.com&amp;bill_name=John+Doe&amp;cancelurl=https%3A%2F%2Fapi-test.wirecard.com%3A443%2Fengine%2Fnotification%2Fmolpay%2Fredirect" name="fpx_abb"/>
    </payment-methods>
    <cancel-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/cancel</cancel-redirect-url>
    <fail-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/error</fail-redirect-url>
    <success-redirect-url>https://demoshop-test.wirecard.com/demoshop/#/success</success-redirect-url>
    <country>MY</country>
</payment>
----

.XML debit Request (Failure)

[source, XML]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <merchant-account-id>0518ac4e-a622-48d8-87f5-a04835ded715</merchant-account-id>
  <request-id>17b0f1b1-00b1-4e14-a4c4-8f3f80a4085b</request-id>
  <transaction-type>debit</transaction-type>
  <requested-amount currency="MYR">10</requested-amount>
  <account-holder>
    <first-name>John</first-name>
    <last-name>Doe</last-name>
    <email>john.doe</email>
    <phone>+123456789</phone>
  </account-holder>
  <descriptor>description</descriptor>
  <payment-methods>
    <payment-method name="fpx_abb"/>
  </payment-methods>
  <country>MY</country>
</payment>
----

.XML debit Response (Failure)

[source, XML]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment" xmlns:ns2="http://www.elastic-payments.com/schema/epa/transaction">
  <merchant-account-id>0518ac4e-a622-48d8-87f5-a04835ded715</merchant-account-id>
  <transaction-id>dfb68a27-65de-4682-98d2-17e83c532116</transaction-id>
  <request-id>17b0f1b1-00b1-4e14-a4c4-8f3f80a4085b</request-id>
  <transaction-type>debit</transaction-type>
  <transaction-state>failed</transaction-state>
  <completion-time-stamp>2018-10-16T09:47:30.000Z</completion-time-stamp>
  <statuses>
    <status code="400.1016" description="The Email Address is syntactically incorrect.  Please check your input and try again." severity="error"/>
  </statuses>
  <requested-amount currency="MYR">10</requested-amount>
  <account-holder>
    <first-name>John</first-name>
    <last-name>Doe</last-name>
    <email>john.doe</email>
    <phone>+123456789</phone>
  </account-holder>
  <descriptor>description</descriptor>
  <payment-methods>
    <payment-method name="fpx_abb"/>
  </payment-methods>
  <country>MY</country>
</payment>
----
