language: php
php: 7.2
git:
  depth: false
before_script:
- INIT_DIR=$(pwd)
- cd /home/travis/build/
- echo | pecl install channel://pecl.php.net/yaml-2.0.2
- git clone https://github.com/krakjoe/pthreads.git
- cd pthreads
- git checkout 6c6b15138c923b69cfa46ee05fc2dd45da587287
- phpize
- "./configure && make && make install"
- cd ..
- echo "extension=pthreads.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
- cd ${INIT_DIR}
- bash buildscripts/asciidoc/create_mermaid_config.sh
install:
- gem install asciidoctor -v 1.5.8
- gem install asciidoctor-diagram -v 1.5.14
- gem install asciidoctor-pdf --pre
- gem install rouge
- gem install concurrent-ruby
- npm install -g inline-source-cli
- npm install --save cheerio
- npm install --save lunr
- npm install --save asciidoctor.js
- npm install --save minimist
- npm install -g mermaid.cli
script:
- travis_wait bash buildscripts/build.sh
deploy:
- provider: s3
  access_key_id: "$S3ACCESSID"
  secret_access_key: "$S3ACCESSKEY"
  bucket: wirecard-docs-internal
  region: eu-central-1
  skip_cleanup: true
  local-dir: build/html
  on:
    branch: staging
- provider: s3
  access_key_id: "$S3ACCESSID"
  secret_access_key: "$S3ACCESSKEY"
  bucket: wirecard-docs
  region: eu-central-1
  skip_cleanup: true
  local-dir: build/html
  on:
    branch: master
notifications:
  slack:
    rooms:
      secure: nNElTLEVjGHWpG1kH4TLetaDld7fKiIIGE/MW7F/Ezpt76bj+ZgqfK0GHeRzy4MWgrE7SDVEv9NYmuvEXa3j0JWG2XmtTyukz/CsKP99X+zOKLUCRiWN3bNutQIZyISM1xEVi+IVSxAn5HsAaGRN9kpKe4svpBB0/b6ymfWXX0Gz2v7bkPNPfdh9HZjMTBT9Eg6oDER6vNqjDeztwq1zkEQ8Hram2YcQs6q7yhrPwIMQxRfAbyheAFxi0brToO2OE4fwg/nwm8q3qWXUak7MV96JZanCod/8DOjtsBSJjqt/0FivkYS92dxeVoDCzGVqpo7++AEMgPimR/gPdl4o4zNzcyHyCT85AZO0XIqwVCJCkr1/5uQhqOH0f4AIedHTV+FRVHBd/qx1ws5X9w2lGl8IRiu/6HUEZQZ9yzYSqvKnpnX/zUK1+9iX4q4pPI4s/nJRks+bn0iOzYX38Zr3qtNTVDFW5Xqm0qyOLFYg73UfJFwgnhK6ndC/opTiWHAA6Ds1nPcXr2UnqHrhFGrxzfjd6r3UrXDgCsIYZOntk5q32EqQ0SbI+mzQeN0QSksELdPqoiXcfze4aPoy4vsGWtrfy8HPkWZGiAtlmzVWx8FzRgT8FMFo8D00wVHHTxFm0GDvflpwW3n2frlK4ZL+6GOHgCiGJKrJ0uphyYZ6/MI=
    on_success: always
    on_failure: always
