//:payment-method-name: Klarna

[#KlarnaV2_TransactionTypes_voidAuthorization]
==== _void-authorization_

Use this transaction type to cancel an order, e.g. if the goods or services are not available
or the consumer wants to cancel their order. We recommend to cancel authorizations to avoid any influence on risk decisions for further payments.


You can cancel

* only authorized amounts that have not yet been completely captured.
* the **total order amount**.
* a **partial order amount**. If the order has been partially captured, a _void-authorization_ cancels only the part of the preceding _authorization_ that has not yet been captured.

//-

NOTE: Once canceled, you can no longer process the order. The initial authorization/reservation is no longer valid.

To refer to a specific _authorization_, _adjust-authorization_ or _pending-authorization_, you need the ``parent-transaction-id``, which is the ``transaction-id`` of the preceding transaction.

[#KlarnaV2_TransactionTypes_voidAuthorization_Workflow]
===== _void-authorization_ Workflow

[mermaid,Klarnav2_workflow_voidAuthorization,svg,subs=attributes+]
----
sequenceDiagram
    participant M as Merchant
    participant W as WPG
    participant K as Klarna
M-->>M: cancels order
M->>W: sends "void-authorization" request
W->>K: creates "void-authorization" transaction
W-->>W: capture check
    alt partial capture before
        W->>K: releases remaining auth. request
        K->>W: releases remaining order
    else no partial capture before
        W->>K: cancels authorization request
        K->>W: cancels authorization
    end
W->>M: creates/sends response
----

. -> Send a _void-authorization_ request. This request must contain the ``parent-transaction-id``. Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_ that is to be canceled.
. _{payment-gateway}_ checks if parts of this order have already been captured:
  ** If yes: _{payment-gateway}_ sends a _void-authorization_ request for the uncaptured order items to _Klarna_. 
  ** If no: _{payment-gateway}_ sends a _void-authorization_ request for the total order amount to _Klarna_. 
. _Klarna_ approves or rejects the void request and returns the result.
. _{payment-gateway}_ sends you the _void-authorization_ response which contains the status code.
. -> Process the _void-authorization_ response.

//-

[#KlarnaV2_TransactionTypes_voidAuthorization_Fields]
===== _void-authorization_ Fields

Fields can be mandatory (M) or optional (O).

[%autowidth,stripes=none]
[cols="m,,,,"]
|===
|Field |<<APIRef_FieldDefs_Cardinality, M/O>> |Data Type |Size |Description

|merchant-account-id 
|O 
|String 
|36 
|A unique identifier assigned
to every merchant account (by {payment-provider-name}).

|request-id 
|M
|String 
|150 
a|A unique identifier assigned by the merchant
to each request. Used when searching for or referencing it later.

As the request ID must be unique, ``{{$guid}}`` serves as a placeholder; Postman
uses it to generate a random ``request-id`` for testing.

Allowed characters:  ``[a-z0-9-\_]``.

|parent-transaction-id
|M
|String 
|36
|Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_.

|transaction-type 
|M  
|String
|30 
|The requested transaction type. Set this field to `void-authorization`.

|requested-amount  
|Response only
|Numeric
|18,3
|Total order amount to be reserved. The number of decimal places depends on the currency. +
The requested amount must be equal to the amount sum of all order items.

Use ``.`` (decimal point) as separator.

|[[KlarnaV2_TransactionTypes_voidAuthorization_Fields_requestedAmount_currency]]requested-amount@currency 
|Response only
|String
|3 
a|The <<KlarnaV2_CountriesCurrencies, currency>> of the requested/contested
transaction amount. +
Format: 3-character abbreviation according to ISO 4217.

|order-detail
|Response only
|String
|
|Description of the cancelation.

|locale	
|Response only
|String
|5 
|A 5-letter code which indicates what <<KlarnaV2_Locales, language>> the payment page is rendered in (RFC 1766).

|transaction-id 
|Response only
|String
|36
|A unique identifier assigned for every transaction. Generated by {payment-provider-name}. Used when searching for or referencing it later.

|transaction-state 
|Response only
|String
|12
a|Transaction status. +
Possible values: 

  - ``success``
  - ``failed``

//-

|completion-time-stamp
|Response only
|DateTime
|
|The timestamp documents the time and date when the transaction was completed.

|notifications. +
notification-url 
|O 
|String
|256
|The URL to which _{payment-gateway}_ sends an <<GeneralPlatformFeatures_IPN_NotificationExamples, Instant Payment Notification (IPN)>> for pending reservations or the transaction outcome. It overwrites the notification URL that is set up in your merchant configuration.

//include::{root}/include/klarna-payments/fields/klarnaPayments_fields_paymentMethod.adoc[tags=**;!klarnaPayments_paymentMethod_authorization]

4+<.>s|order-items.order-item.
s|Description of a specific order item.

|name 
|Response only
|String
|256 
|Name of the item in the shopping basket.

|description 
|Response only
|String
|1024 
|Description of the item in the shopping basket.

|article-number 
|Response only
|String
|256 
|EAN or other merchant-side article identifier.

|quantity 
|Response only
|Numeric 
|n/a  
|Total number of this item in the shopping basket.

|amount 
|Response only
|Numeric 
|18,3 
|Item’s price per unit.  +

Use ``.`` (decimal point) as separator.

|amount@currency 
|Response only
|String
|3 
|<<KlarnaV2_CountriesCurrencies, Currency>> of this item's price. Must match the <<KlarnaV2_TransactionTypes_voidAuthorization_Fields_requestedAmount_currency, order currency (requested amount currency)>>. +
Format: 3-character abbreviation according to ISO 4217.

|type
|Response only
|String
|n/a
a|Order item type. +
Possible values: 

  - ``shipment_fee``
  - ``handling_fee``
  - ``discount``
  - ``physical``
  - ``sales_tax``
  - ``digital``
  - ``gift_card``
  - ``store_credit``

//-

|tax-rate 
|Response only
|Numeric
|5,2 
a|Item’s tax rate per unit in percent.

|tax-amount 
|Response only
|Numeric
|5,2 
a|Item’s tax value per unit.

|discount	
|Response only
|Numeric
|18,3 
|The discount value for one order item.  +
Use ``.`` (decimal point) as separator.

4+<.>s|account-holder.
s|Contains consumer data.

|date-of-birth 
|Response only
|Date 
|
|Consumer's date of birth. +
Format: _Klarna_ accepts only ``dd-MM-YYYY`` or ``YYYY-MM-dd``. + 
If you provide a different format, _Klarna_ prompts the consumer to enter their birth date during the payment process.

|first-name 
|Response only
|String
|32 
|Consumer's first name.

|last-name 
|Response only
|String
|32 
|Consumer's last name.

|email 
|Response only
|String
|64 
|Consumer's email address.

|gender 
|Response only
|String
|1 
|Consumer's gender.

|phone 
|Response only
|String
|32 
|Consumer's phone number. +
Phone numbers need to be validated. Click <<Klarnav2_phoneNumberValidation, here>> for details.

4+<.>s|account-holder.address.
s|Consumer's address.

|street1 
|Response only
|String
|128 
|Street of the consumer's address.

|street2	
|Response only|String
|128 
|House number of the consumer's address.	 

|city 
|Response only
|String
|32 
|City of the consumer's address.

|country 
|Response only
|String
|3 
|<<KlarnaV2_CountriesCurrencies, Country code>> of the consumer's address.

|postal-code 
|Response only
|String
|16 
|Postal/ZIP code of the consumer's address.

4+<.>s|shipping. 
s|Consumer's shipping information.

|first-name 
|Response only
|String
|32 
|Recipient's first name.  

|last-name 
|Response only
|String
|32 
|Last name of the recipient.

|email 
|Response only
|String
|64 
|Email address of the recipient.	

|phone 
|Response only
|String
|32 
|The phone number of the recipient. +
Phone numbers need to be validated. Click <<Klarnav2_phoneNumberValidation, here>> for details.

4+<.>s|shipping.address.
s|Consumer's shipping address.

|street1 
|Response only
|String
|128 
|Street of the recipient's address.

|street2 
|Response only
|String
|128 
|House number of the recipient's address.	 

|house-extension 
|Response only
|String
|32 
|House extension of the recipient's address.	 

|city 
|Response only
|String
|32 
|City of the recipient's address.

|country 
|Response only
|String
|3 
|Country code of the recipient's address.

|postal-code 
|Response only
|String
|16 
|Postal/ZIP code of the recipient's address.

include::{root}/include/klarna-payments/fields/klarnaPayments_fields_status.adoc[]

|===

[#KlarnaV2_TransactionTypes_voidAuthorization_Samples]
===== _void-authorization_ Samples

._void-authorization_ Request
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_voidAuthorization_request.xml[]
----

NOTE: {{txnId}} serves as placeholder. Enter the ``transaction-id`` of the preceding _authorization_, _adjust-authorization_ or _pending-authorization_ that is to be canceled.

._void-authorization_ Response
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/Klarnav2_voidAuthorization_response.xml[]
----

//-