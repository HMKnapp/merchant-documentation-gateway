[#API_ThaiQR]
== REST API

// [#API_ThaiQR_Introduction]
// === Introduction

_Thai QR_ is a type of <<PaymentMethods_PaymentMode_OnlineBankTransfer, Online Bank Transfer>>.

[#API_ThaiQR_CountriesCurrencies]
=== Countries and Currencies

[cols="20h,80"]
|===

|Countries | Thailand
|Currencies a| Processing: THB +
               Settlement: Not applicable (Processing model only)

|===

[#API_ThaiQR_CommunicationFormats]
=== Communication Formats

This table illustrates how _Thai QR_ notifications are encoded and which formats and methods can be used for requests and responses.

[cols="20,20,60"]
|===
.2+| *Requests/Responses* | Format | XML, JSON
                        | Methods | POST
| *IPN Encodement*     2+| Please follow the instructions given at <<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===

[#API_ThaiQR_Transactions]
=== Transactions

[#API_ThaiQR_TransactionTypes]
==== Transaction Types

For <<Glossary_TransactionType, transaction type>> details which are not given here look at <<AppendixB, Transaction Types>>.

[cols=",,"]
|===
|Transaction Type |Description | Link to Sample

|_get-url_ | Retrieves the URL of {payment-gateway} with QR Code which after scanning redirects consumer to Siam Commercial Bank to process the payment. | Not available
|_debit_ |Final transaction created after Siam Commercial Bank confirms by IPN if transaction was processed. | <<API_ThaiQR_Samples_debit, _debit_ sample>>

|===

//-

[#API_ThaiQR_TestCredentials]
=== Test Credentials

[cols="35h,65"]
|===
| URLs (Endpoints) | ``\https://api-test.wirecard.com/engine/rest/paymentmethods/``
| Merchant Account ID (MAID) | 0d99527e-0ac4-47be-978a-2c53a858b3a4
| Username |
| Password |
| Secret Key |
|===

[#API_ThaiQR_AdditionalCredentials]
.Additional Test Credentials on _Thai QR_ Environment

[cols=",,"]
|===
| *Channel Id* | 
| *Channel Secret Key* | 
|===


[#API_ThaiQR_Workflow]
=== Workflow

// image::images/thai-qr/.jpg[]

. You send _debit_ request to {payment-gateway} to process the payment with _Thai QR_.
. {payment-gateway} creates a _get-url_ transaction and sends request to Siambank _Thai QR_ provider to generate special QR code for processing the payment via Siam Commercial Bank.
. Siambank _Thai QR_ provider returns message with QR code image in base64 format to {payment-gateway}.
. {payment-gateway} sends response to you with both QR code in base64 format as well as URL for HPP.
. You have two options:
.. Either you redirect consumer to HPP where QR code is displayed to scan QR code.
.. Or you encode QR code provided in base64 format and display it directly on his webpage.
. If you redirect consumer to HPP to scan QR code, {payment-gateway} will show QR code image on HPP to consumer and wait for IPN from provider.
. If you display QR code directly on his webpage, consumer will scan QR code on your webpage and is redirected to Siambank _Thai QR_ to process the payment.
. Siambank _Thai QR_ provider sends IPN message with transaction status to {payment-gateway} and {payment-gateway} creates success _debit_.
. Finally {payment-gateway} sends notification to you that _debit_ transaction was successfully created and processed.

.GETSTATUS Flow

. You send request to find out status of the transaction.
. {payment-gateway} checks if transaction is finished and stored.
. If transaction is finished and stored, you receive response from {payment-gateway} with transaction status.
. If transaction is not finished and stored, {payment-gateway} checks if timeout is expired.
. If timeout is not expired, you receive response from {payment-gateway} that such transaction was not found.
. If timeout is expired, {payment-gateway} will create failed _debit_ and send notification to you with transaction status.

[#API_ThaiQR_Expiration]
=== QR code expiration

There is no expiration for generated QR code on provider's side, but there is default timeout period (30 minutes) which is configurable globally per {payment-gateway} instance or you can set it - 

``siambank-promptpay.connector.hpp.processing.timeoutmillis``

When success IPN comes after timeout period, then failed _debit_ is created and ERROR is logged.


[#API_ThaiQR_Fields]
=== Fields

All fields used for _Thai QR_ are the same as the <<RestApi_Fields, ReST API Fields>>. Please refer to the API field list. 

[#API_ThaiQR_Samples]
=== Samples

If you want to see corresponding notification samples, go to <<GeneralPlatformFeatures_IPN_NotificationExamples, Notification Examples>>.

[#API_ThaiQR_Samples_checksignature]
.XML _get-url_ Request (Successful)

[source,xml]
----

----
 
.XML _get-url_ Response (Successful)

[source,xml]
----

----

[#API_ThaiQR_Samples_debit]
.XML _debit_ Request (Successful)

[source,xml]
----

----

.XML _debit_ Response (Successful)

[source,xml]
----

----

//-
