[#payolution]
== REST API
_payolution_ is a type of <<PaymentMethods_PaymentMode_OfflineBankTransfer, Offline Bank Transfer>>.

[#payolution_SpecificPaymentMethods]
_payolution_  offers 4 payment methods: 

* **``payolution-b2b``** +
    ** Payment on invoice. 
    ** For B2B transactions only.
    ** You have to provide the company name.
//-
* **``payolution-elv``** +
    ** SEPA direct debit payment. 
    ** You need to provide the IBAN of the consumer.
//-
* **``payolution-inv``** +
    ** Payment on invoice. 
    ** For B2C transactions only.
//-
* **``payolution-inst``** +
    ** Payment in installments. 
    ** For B2C transactions only.
//-

[#payolution_CountriesandCurrencies]
=== Countries and Currencies
[width=75%,cols=",,",stripes=none]
|===
.4+h| Countries
| Invoice B2C
| AT, DE, CH, NL
| Invoice B2B
| AT, DE, CH
| Installment
| AT, DE, CH
| Direct Debit
| AT, DE, CH
h| Currencies
2+| EUR, CHF
|===

[#payolution_CommunicationFormats]
=== Communication Formats
This table illustrates how _payolution_ notifications are encoded and
which formats and methods can be used for requests and responses.
[width=75%,stripes=none,cols=",,"]
|===
.2+h|Requests/Responses
|Format
|XML
|Methods
|POST
h|IPN Encodement
2+|Please follow the instructions given at <<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===

[#payolution_Transactions]
=== Transaction Types

[%autowidth,cols="m,a,""]
|===
| Transaction Type | Description | Link to the Samples

| authorization
| Checks the consumer's creditworthiness when they place an order.
| <<payolution_Samples_authorization, authorization samples>>

| capture-authorization
| Captures the funds reserved in a preceding authorization the moment
some or all goods are physically delivered to the consumer. +
You can only capture amounts that have been authorized successfully and neither voided nor fully captured. +
Partial and multiple captures are allowed as long as you do not exceed the authorization limit. +
| <<payolution_Samples_captureAuthorization, capture-authorization samples>>

| debit
| Authorizes and captures a payment in one go. +
Triggers fund transfer. +
| <<payolution_Samples_authorization, debit samples>>

| void-authorization
| Cancels a reserved order amount totally or partially if has not been captured before. +
Once canceled, no further operations on the order are possible. +
You can only cancel successful authorizations that have been neither voided nor
captured. +
Partial and multiple voids are allowed until all ordered items
are canceled or captured. +
Not available for payment method ``payolution-inv``.
| <<payolution_Samples_voidAuthorization, void-authorization samples>>

| refund-capture
| Refunds a captured order amount if the consumer returns some or all delivered goods. +
You can only refund amounts that have been captured successfully. +
Partial and multiple refunds are allowed until the whole captured amount has been refunded (i.e. all delivered items have been returned.)
| <<payolution_Samples_refundCapture, refund-capture samples>>

| add-data
| Adds information to a previous transaction. You can add

** invoice ID
** order ID
** shipping company
** tracking ID (for purchases and returns)
** delivery date (for purchases and returns)
** additional merchant information
//-

This is useful to 

* add information that was not available at the time ot the previous transaction.
* inform payolution about delivery date changes. This prevents from sending unjustified reminders to consumers.
//-
You can only add information to a successful capture-authorization transaction.

| <<payolution_Samples_addData, add-data samples>>

| authorization-only
| Checks if payolution accepts the consumer. +
This pre-check can save you the effort of displaying installment plans to consumers who would be rejected in a payment process. 
| <<payolution_Samples_authorizationOnly, authorization-only samples >>

| adjust-authorization
| Updates the amount of a preceding authorization. +
You can only adjust authorizations that have not yet been captured. +
For ``payolution-inst``, you can only add information to a preceding authorization request. You can change neither amount nor number of installments.
|

| calculate
| Returns installment plans for a specified amount.
| <<payolution_Samples_calculate, calculate samples >>

|===
 
[#payolution_TestCredentials]
=== Test Credentials

[cols=",,"]
[%autowidth]
[stripes=none]
|===
.3+h| URLs (Endpoints)
| For transaction type ``authorization``.
| ``\https://{test-instance-hostname}/engine/rest/paymentmethods/``
a| For transaction types 

* ``add-data``
* ``adjust-authorization``
* ``authorization-only``
* ``capture-authorization``
* ``debit``
* ``refund-capture``
* ``void-authorization``
//-
| ``\https://{test-instance-hostname}/engine/rest/payments/``
| For transaction type ``calculate``
| ``\https://api-test.wirecard.com/engine/rest/utils/installmentcalculator``
h| Merchant Account ID (MAID)
2+| 2048677d-57f4-44b0-8d67-9014c6631d5f
h| Username
2+| 16390-testing
h| Password
2+| 3!3013=D3fD8X7
h| Secret Key
2+| 74bd2f0c-6d1b-4e9a-b278-abc34b83ab9f
|===

.Additional Test Credentials on _payolution_ Environment

[%autowidth, cols= "h,"]
|===
|German Bank Account
|IBAN: DE55203205008737970454 +
BIC: DABADEHHXXX
|Austrian Bank Account
|IBAN: AT321936000136412018 +
BIC: INGDAT21XXX
|Swiss Bank Account
|Not necessary on test environment.
|Netherlands
|Installment not supported for consumers from the Netherlands.
|===

[#payolution_Workflow]
=== Workflow

[#payolution_ELV]
==== Direct Debit (``payolution-elv``) - debit Workflow

. Consumer selects payment method SEPA Direct Debit (by _payolution_).
. -> Send a ``debit`` request to WPG. +
This request must contain ``payment-method@name`` = ``payolution-elv`` and the consumer's ``iban``.
. WPG processes the request and forwards it to _payolution_.
. _payolution_ runs risk checks. If the request passes, _payolution_ forwards it to the consumer's bank.
. The consumer's bank debits the consumer's account and transfers funds to _payolution_. 
. _payolution_ sends a response to WPG and transfers funds to merchant account.
. WPG informs you about the transaction outcome.
. -> Inform the consumer about the transaction outcome.
//-

[#payolution_InvoiceB2C]
==== Invoice B2C (``payolution-b2c``) - authorization, capture-authorization Workflow

[NOTE]
====
_payolution_ sends the ``authorization`` request with the _payolution_
specific payment method ``payolution-inv``.

For B2C transactions, the account holder's date of birth is mandatory.

Invoice B2C captures the full amount only when *all ordered goods*
are ready for delivery.
====

image::images/11-23-payolution/payolution_InvoiceB2C_authorization_captureAuthorization.png[payolution Invoice B2C, width=950, align="right"]

[#payolution_InvoiceB2B]
==== Invoice B2B (``payolution-b2c``) - authorization, capture-authorization Workflow

[NOTE]
====
_Invoice B2B_ has the same structure as _Invoice B2C_.

_Invoice B2B_ sends the ``authorization`` request with the _payolution_
specific payment method ``payolution-b2b``.

``custom-field@field-name="company-name"`` is mandatory for B2B transactions.

Invoice B2B captures the full amount only when *all ordered goods* are
ready for delivery.
====

image::images/11-23-payolution/payolution_InvoiceB2B_authorization_captureAuthorization.png[payolution Invoice B2B, width=950, align="right"]

[#payolution_Installment]
==== Installment (``payolution-inst``)


There are two installment options:

. *Async installment:* Show the installment plans to your consumer on the _payolution_ web site. You need to redirect them.

. *Sync installment:* Show the installment plans to your consumer on your own shop page. Before that, you need to retreive the available installment plans with a ``claculate`` request.

//-


[#payolution_Installment_Async]
===== Async Installment - authorization, capture-authorization Workflow

[NOTE]
====
_Installment_ sends the ``authorization`` request with the _payolution_
specific payment method ``payolution-inst``.

``capture-authorization`` must be triggered *immediately after the
authorization* response has arrived.
====

image::images/11-23-payolution/payolution_Installment_authorization_captureAuthorization.png[payolution Installment, width=950, align="right"]



[#payolution_Installment_Sync]
===== Sync Installment - authorization, debit Workflow

. Consumer selects "Payment in Installments" (by _payolution_).
. -> Send a ``claculate`` request to WPG.
. WPG retrieves installment plans from _payolution_ and forwards them to you in the ``calculate`` response. +
This ``calculate`` response also contains all available installment plans and a link to _payolution's_ terms and conditions.
. -> On the checkout page, show the consumer
** the available installment plans.
** the link to _payolution's_ terms and conditions. +
. Consumer selects an installment plan and submits the payment. 
. -> Send an ``authorization`` or ``debit`` request to WPG: +
As ``field-value`` for ``custom-field field-name="duration"``, enter the selected number of installments (``calculate`` response, field ``months``). +
If you do not provide this field, the request falls back to <<payolution_Installment_Async, async installment>>.
. WPG forwards the request to _payolution_.
. _payolution_ processes the request and sends the response to WPG.
. WPG forwards the response to you.
. -> Inform the consumer about the transaction outcome.
. For ``debit`` requests and captured ``authorization`` requests: +
** _payolution_ pays the total order amount to the merchant account.
** The consumer pays _payolution_ in monthly installments.

//-

[#payolution_Reversal]
==== Reversal (_void-authorization_)

A reversal cancels an authorized order and blocks it for future
captures. Only full reversals of the non-captured amount are supported.
Reversals should not be possible for installment transactions (capture
should follow authorization immediately).

[NOTE]
====
_Reversal_ sends the _authorization_ request with the _payolution_
specific payment method "*payolution-inv*".

_Reversal_ sends a partial _capture_ request when *some of the
items* are ready for delivery.

Only the fully authorized amount that has not been captured can be
voided. Partial void authorizations are not possible.
====

image::images/11-23-payolution/payolution_reversal_voidAuthorization.png[payolution Reversal, width=950, align="right"]

[#payolution_Refund]
==== Refund (_refund-capture_)

[NOTE]
====
A refund request must be sent in case of goods returned by the consumer.

Refunds can also be used for invoice reduction or settlement of faulty
payments with the merchant account.

The refund workflow applies to both Invoice and Installment
transactions.
====

[NOTE]
====
_Refund_ sends the _authorization_ request with the _payolution_
specific payment method "*payolution-inv*".

_Refund_ sends a _capture_-_authorization_ request when *all the
items* are ready for delivery.

Multiple _captures_ are allowed in case that only part of the order is
ready for delivery.

Sends _refund-capture_ request with the amount of returned items.
====

image::images/11-23-payolution/payolution_refund_refundCapture.png[payolution Refund, width=950, align="right"]

[#payolution_Fields]
=== Fields

The fields used for _payolution_ requests, responses and notifications
are the same as the <<RestApi_Fields, REST API fields>>.

Only the fields listed below have different properties, especially
according to size.

[#payolution_Fields_authorization]
==== authorization and debit Fields

Fields can be **M**andatory or **O**ptional in an authorization/debit request for any
of _payolution's_ specific payment methods.

[%autowidth,stripes=none]
[cols="m,,,,,,a"]
|===
3+|Field |<<APIRef_FieldDefs_Cardinality, M/O>> |Data Type |Size |Description

| payment-methods
2+m| payment-method@name 
| M 
| String 
| 15 
a| The name of the payment method used for the transaction.

Accepted values:

* ``payolution-b2b``
* ``payolution-elv``
* ``payolution-inst``
* ``payolution-inv``

//-
.9+| account-holder
2+m| first-name 
| M 
| String 
| 32 
| Consumer’s first name.

2+m| last-name 
| M 
| String 
| 32 
| Consumer’s last name.

2+m| email 
| M 
| String 
| 64 
| Consumer’s email address.

2+| date-of-birth 
| M/O 
| String 
| 10 
| Consumer’s date of birth. +
Mandatory for B2C transactions. +
Optional for B2B transactions.

2+| phone 
| M/O
| String 
| 32 
| Consumer’s phone number. +
Mandatory for consumers from the Netherlands.

.4+| address
m| street1
| M 
| String 
| 128 
| First line of consumer's address.

| city 
| M 
| String 
| 32 
| City of consumer's address.

| country 
| M 
| String 
| 2 
| Country ID of consumer's address (ISO 3166-1 alpha-2).

| postal-code 
| M 
| String 
| 16 
| Postal code or ZIP of consumer's address.

.2+| bank-account
2+m| iban
| M/O
| String 
| 34 
| Consumer's IBAN. +
Mandatory for ``payolution-elv``.

2+m| bic
| M/O 
| String 
| 15 
| Consumer's BIC. +
Mandatory for ``payolution-elv``.

m| custom-fields 
2+m| custom-field field-name="duration"
| M/O 
| String 
| 15 
| <<payolution_Fields_Installments_months, Number of installments.>> +
Mandatory for ``payolution-inst`` (sync installments).

|===


[#payolution_Fields_Installments]
==== Installments Calculator Response Fields

[%autowidth,stripes=none]
[cols="m,,a"]
|===
2+|Field |Description

2+| product-id
| Installment plan ID.

2+| name
| Installment plan name.

2+| terms
| URL to _payolution's_ terms and conditions. 

.5+| details
m| interest-rate
| Interest rate in percent.

| setup-fee
| Extra charges for providing the option of payment in installments.

| monthly-pay
| Amount the consumer has to pay back in monthly installments.

| months
| [[payolution_Fields_Installments_months]]Number of installments. +
In your ``authorization`` or ``debit`` request, enter this value as ``field-value`` for ``custom-field field-name="duration"``.

| total-credit-purchase-price
| Total amount the consumer has to pay, including interest and setup-fee.

|===

[#payolution_Fields_CustomFieldsforB2BTransactions]
==== Custom Fields for B2B Transactions

Custom fields contain company information if the consumer is a business
consumer. For B2B transactions only the company name is mandatory. All
other fields are optional.

[%autowidth,stripes=none]
[cols="m,,,,a"]
|===
|Field |<<APIRef_FieldDefs_Cardinality, M/O>> |Data Type |Size |Description

| custom-field@field-name="company-name" 
| M 
| String 
| 256 
| Consumer’s company name.

| custom-field@field-name="company-uid" 
| O 
| String 
| 256 
| Consumer’s VAT identification number.

| custom-field@field-name="company-trade-register-number" 
| O 
| String
| 256 
| Consumer’s Trade register number.

| custom-field@field-name="company-register-key" 
| O 
| String 
| 256
| Additional registration information about consumer.
|===

[#payolution_AmountLimits]
=== Amount Limits

The order amount must be within the limits agreed upon in the contract
closed with _payolution_. The limits are set individually for each of
_payolution's_ specific payment method (payolution-inv, payolution-b2b
and payolution-inst). If the order amount is not within the defined
limits, the payment options Installment and Invoice should not be
available to the consumer.

[#payolution_Samples]
=== Samples

Click the link to view corresponding <<GeneralPlatformFeatures_IPN_NotificationExamples, Notification Examples>>.

[#payolution_Samples_authorization]
==== authorization

.XML B2C Invoice authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_authorization_request_success.xml[]
----

.XML B2C Invoice authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_authorization_response_success.xml[]
----

.XML B2C Invoice authorization Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_authorization_request_failure.xml[]
----

.XML B2C Invoice authorization Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_authorization_response_failure.xml[]
----

***

[#payolution_Samples_B2BInvoiceAuthorization]

.XML B2B Invoice authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_authorization_request_success.xml[]
----

.XML B2B Invoice authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_authorization_response_success.xml[]
----

.XML B2B Invoice authorization Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_authorization_request_failure.xml[]
----

.XML B2B Invoice authorization Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_authorization_response_failure.xml[]
----

***

[#payolution_Samples_InstallmentAuthorization]

.XML Installment authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_authorization_request_success.xml[]
----

.XML Installment authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_authorization_response_success.xml[]
----

.XML Installment authorization Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_authorization_request_failure.xml[]
----

.XML Installment authorization Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_authorization_response_failure.xml[]
----


[#payolution_Samples_authorizationOnly]
==== authorization-only (for all payment methods)

.XML authorization-only Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-authorization-only_request_success.xml[]
----

.XML authorization-only Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-authorization-only_response_success.xml[]
----


[#payolution_Samples_calculate]
==== calculate (for payolution-inst)

.XML calculate Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-calculate_request_success.xml[]
----




[#payolution_Samples_captureAuthorization]
==== _capture-authorization_

.XML B2C Invoice capture-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_capture-authorization_request_success_be8a53f9.xml[]
----

.XML B2C Invoice capture-authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inv_capture-authorization_response_success_be8a53f9.xml[]
----

***

.XML B2B Invoice capture-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_capture-authorization_request_success_df706683.xml[]
----

.XML B2B Invoice capture-authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_capture-authorization_response_success_df706683.xml[]
----

***

.XML Installment capture-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_capture-authorization_request_success_3541d575.xml[]
----

.XML Installment capture-authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-inst_capture-authorization_response_success_3541d575.xml[]
----

***

.XML B2B Invoice capture-authorization Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_capture-authorization_request_failure_df706683.xml[]
----

.XML B2B Invoice capture-authorization Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_capture-authorization_response_failure_df706683.xml[]
----

[#payolution_Samples_voidAuthorization]
==== _void-authorization_

.XML B2B Invoice void-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_void-authorization_request_success_cbbed962.xml[]
----

.XML B2B Invoice void-authorization Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_void-authorization_response_success_cbbed962.xml[]
----

.XML B2B Invoice void-authorization Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_void-authorization_request_failure_7311ed4a.xml[]
----

.XML B2B Invoice void-authorization Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_void-authorization_response_failure_7311ed4a.xml[]
----

[#payolution_Samples_refundCapture]
==== _refund-capture_

.XML B2B Invoice refund-capture Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_refund-capture_request_success_8f0b610e.xml[]
----

.XML B2B Invoice refund-capture Response (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_refund-capture_response_success_8f0b610e.xml[]
----

.XML B2B Invoice refund-capture Request (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_refund-capture_request_failure_240fa6d8.xml[]
----

.XML B2B Invoice refund-capture Response (Failure)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-b2b_refund-capture_response_failure_240fa6d8.xml[]
----

[#payolution_Samples_addData]
==== add-data

.XML add-data Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-add-data_request_success.xml[]
----

.XML add-data Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-add-data_response_success.xml[]
----

[#payolution_Samples_adjustAuthorization]
==== adjust-authorization 

.XML adjust-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-adjust-authorization_request_success.xml[]
----

.XML adjust-authorization Request (Successful)

[source,xml,subs=attributes+]
----
include::{root}/samples/xml/payolution-adjust-authorization_response_success.xml[]
----

//-
