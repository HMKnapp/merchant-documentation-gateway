[#API_CC_3DS2_UC_delayed-shipment]
=== Delayed Shipment

A consumer places an order for a product or service. The merchant fulfills the order in a single shipment, but with a delay. This delay may be expected or unexpected and could exceed the expiration date of the authorization.

[#API_CC_3DS2_UC_delayed-shipment_expect]
==== Option 1: Expected Delay

//provide a real life example of an expected delay

image::images/uc-delayed-shipment/uc-delayed-shipment-expected.png[3DS2 Use Cases Delayed Shipment Expected]

NOTE: In a delayed shipment with an expected delay an _authorization-only_ preceeds the check-enrollment.
 
* _authorization-only_ +
If there is an expected delay of max. 90 days you can start this payment process with an _authorization-only_. This transaction doesn't reserve any money. It only verifies the cardâ€™s validity. The advantage of an _authorization-only_ is, you don't have to pay authentication fees if the card is invalid.

.XML _authorization-only_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/authorization-only_request_success.xml[]
----

//-

.XML _authorization-only_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/authorization-only_response_success.xml[]
----

//-
 
After the _authorization-only_ the card's <<> link to the description of check-enrollment, 3DS2 compliance must be checked>>.

If the card passed the authentication check successfully, the payment process is halted until the goods have become available and are ready to be shipped. The payment process is resumed with an _authorization_ and completed with a _capture-authorization_.
 
* _authorization_ +
The _authorization_ is the first transaction after the _check-payer-response_. In this _authorization_ the whole amount for the transaction is authorized. +
Include the ``transaction-id`` from the _check-payer-response_ in the ``parent-transaction-id`` field of the _authorization_ request.
 
NOTE: If you use a different transaction instead of _check-payer-response_ to communicate with the ACS server, use the ``PARes`` received via ``TermURL``. You can find the ``PARes`` in the response you received from the ACS server.

.XML _authorization_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/authorization_request_success.xml[]
----

//-

.XML _authorization_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/authorization_response_success.xml[]
----

//-
 
* _capture-authorization_ +
The _capture-authorization_ must reference the transaction-id from the _authorization_ response in the parent-transaction-id field.
 
.XML _capture-authorization_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/capture-authorization_request_success.xml[]
----

//-

.XML _capture-authorization_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/expected/capture-authorization_response_success.xml[]
----

//-

[#API_CC_3DS2_UC_delayed-shipment_unexpect]
==== Option 2: Unexpected Delay

//provide a real life example of an unexpected delay

image::images/uc-delayed-shipment/uc-delayed-shipment-unexpected.png[3DS2 Use Cases Delayed Shipment Unexpected]

In a delayed shipment with an unexpected delay an _authorization_ follows the transaction types _check-enrollment_ and _check-payer-response_.
 
* _authorization_ (first authorization, full amount) +
The _authorization_ is the first transaction after the _check-payer-response_. In this _authorization_ the whole amount for the transaction is authorized. +
Include the ``transaction-id`` from the _check-payer-response_ in the ``parent-transaction-id`` field of the _authorization_ request.
 
NOTE: If you use a different transaction instead of _check-payer-response_ to communicate with the ACS server, use the ``PARes`` received via ``TermURL`` as part of the response to the request you sent to the ACS server.

.XML _authorization_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/authorization-1_request_success.xml[]
----

//-

.XML _authorization_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/authorization-1_response_success.xml[]
----

//-
 
* _void-authorization_ +
If the delay has become apparent the authorzied amount will be voided. The _void-authorization_ includes the transaction-id from the first _authorization_ in the parent-transaction-id field.

.XML _void-authorization_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/void-authorization_request_success.xml[]
----

//-

.XML _void-authorization_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/void-authorization_response_success.xml[]
----

//-
 
* _authorization_ (second authorization with ``authorization-reason``) +
This second _authorization_ contains the additional field ``authorization-reason`` with the value ``reauthorization``.
When the goods have become available and are ready to be shipped the formerly authorized amount will now be reserved with this second _authorization_. This second _authorization_ includes in the ``parent-transaction-id`` field the ``transaction-id`` from the first _authorization_.

.XML _authorization_ Request (Second _authorization_ Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/authorization-2_request_success.xml[]
----

//-

.XML _authorization_ Response (Second _authorization_ Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/authorization-2_response_success.xml[]
----

//-
 
* _capture-authorization_ +
The _capture-authorization_ refers to the second _authorization_. The _capture-authorization_ includes in the ``parent-transaction-id`` field the ``transaction-id`` from the second _authorization_.

.XML _capture-authorization_ Request (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/capture-authorization_request_success.xml[]
----

//-

.XML _capture-authorization_ Response (Successful)
[source,xml,subs=attributes+]
----
include::{root}/samples/xml/3ds2/use-cases/delayed-shipment/unexpected/capture-authorization_response_success.xml[]
----

//-