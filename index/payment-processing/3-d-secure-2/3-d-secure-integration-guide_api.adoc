[#3DS2_IntegrationGuide_REST]
== 3D Secure 2 for REST API

[NOTE] 
====
The 
ifdef::env-wirecard[]
<<3DS2_worfklow, 
endif::[]
3D Secure 2 workflow
ifdef::env-wirecard[]
>> 
endif::[]
remains identical to the 3D Secure 1 workflow.
====

[#3DS2_IntegrationGuide_REST_integration]
=== Step-by-Step Integration

====
_How to integrate 3D Secure 2 for REST API:_

. Send a request with check-enrollment.
. Redirect the consumer to the Access Control Server (ACS) URL.
. Send a check-payer-response request for validation of the authentication result (optional).
. Complete the payment transaction.

//-
====

.1. Send a request with check-enrollment
-placeholder-


.2. Redirect the consumer to the ACS URL
-placeholder-

.3. Send a check-payer-response request for validation of the authentication result (optional)
-placeholder-

.4. Complete the payment transaction 
Proceed with the payment transaction with the relevant transaction-type (e.g. authorization, purchase, authorization-only).

//-

You must either reference the previous-check-enrollment or the check-payer-response in the next step of the payment process. This depends on whether the check-payer-response has been executed or not.

--
.. Following check-enrollment: Use the ``transaction-id`` from the check-enrollment response in the ``parent-transaction-id`` field.

.. Following (optional) check-payer-response: Use the ``transaction-id`` returned by the check-payer-response in the ``parent-transaction-id`` field.

//-
--

If the check-payer-response was not executed, instead use the PARes received via TermURL as part of the response to the ACS HTTP POST request.

[NOTE]
====
In the context of 3D Secure transactions, make sure to distinguish between the terms authentication and authorization. Authentication confirms the cardholder's identity.
Authorization checks whether the cardholder's account holds sufficient funds and reserves the respective amount for later payment. 
====

For more detailed payment flows of typical use cases, go to our <<CreditCard_3DS2_UseCases, 3D Secure 2 Use Cases section>>. Need more information on the general 3D Secure 2 Workflows?  Check out the <<3DS2_worfklow, 3D Secure 2 Workflows section>>.

[#3DS2_IntegrationGuide_REST_example]
=== Payment-Processing Example

We provide a postman collection containing ready-made XML samples for each step of a one-time payment transaction.

The 3D Secure 2 payment-processing example is *designed for the testing environment* and *does not use real information.*

[%autowidth, cols="70,30"]
|===
s|Get the 3D Secure 2 Postman Collection for a One-Time Payment Transaction: a|pass:[<a href="resources/3-d-secure-2/usecase_pm-collection/one-time-payment.postman_collection.json" target="_blank" rel="noreferrer noopener" download>Download</a>]
|===

NOTE: A 3D Secure postman collection containing samples for all typical use cases documented in our 3D Secure 2 Use Cases section can be found  <<3DS2_Testing_Samples, here>>.

[#3DS2_IntegrationGuide_REST_example_credentials]
==== Test Credentials

The postman collection is preconfigred with the following test credentials:

[%autowidth, cols="h,", stripes="none"]
|===
| URL (Endpoint)           
| ``\{rest-api-test-endpoint}``

| Merchant Account ID (MAID) 
| 33f6d473-3036-4ca5-acb5-8c64dac862d1

| Username                   
| 70000-APILUHN-CARD

| Password                   
| 8mhwavKVb91T

2+h|Test Card
|Card Number 
|5413330300201218

|Expiration Date 
|01/23

|CVV 
|218
|===

You can find further test credentials and test card types in our <<3DS2_Testing, 3D Secure 2 Testing section>>.

[#3DS2_IntegrationGuide_REST_example_run]
==== Run the Collection

Import an run the collection with https://www.postman.com/postman[Postman].

To import the collection in Postman,

. Download the collection.

. Open Postman and click *Import* in the header bar.

. Click *Choose Files* and select the respective collection file. 

You can now run the collection.

[NOTE]
====
For more details on 3D Secure fields included in the sample requests, go to our <<3DS2_Fields, 3D Secure 2 Fields page>>. 
ifdef::env-wirecard[]
ifndef::env-nova[]
They are also included in the <<Appendix_Xml, REST API payment XSD>>.
endif::[]
endif::[]
====


Our samples work with https://webhook.site[Webhook.site] to simulate the ACS URL and to obtain the PARes.


To integrate Webhook.site in the test setup:

. Send a check-enrollment request. +
A check-enrollment response containing the ``<PAReq>``, the ``<TermUrl>`` and ``<MD>`` is returned.

. Open https://webhook.site[Webhook.site].

. Click *Edit* in the header bar. +
A pop-up window opens.

. Copy paste the Auto Submission POST request in the field *Response Body*. 
+
.Auto Submission POST Request
[source,html]
----
<html>
   <head>
      <meta HTTP-EQUIV="Content-Type" content="text/html; charset=UTF-8" />
      <meta HTTP-EQUIV="Cache-Control" CONTENT="no cache" />
      <meta HTTP-EQUIV="Pragma" CONTENT="no cache" />
      <meta HTTP-EQUIV="Expires" CONTENT="0" />
   </head>
   <body OnLoad="AutoSubmitForm();">
      <form name="downloadForm" action="AcsUrl" method="POST">
         <input type="hidden" name="PaReq" value="PaReq" />
         <input type="hidden" name="TermUrl" value="TermUrl" />
         <input type="hidden" name="MD" value="optionalValue" />
         <SCRIPT LANGUAGE="Javascript">
            <!--function AutoSubmitForm() { document.downloadForm.submit();}//-->
         </SCRIPT>
         <input type="submit" name="continue" value="Continue" />
      </form>
   </body>
</html>
----
+

[NOTE] 
====
*Default status code* = 200 +
*Content type* = text/html +
*Timeout before response* = 0
====

. In the Auto Submission POST request 
.. replace the value ``"PaReq"`` and the action ``"AcsUrl"`` with the values  from the check-enrollment response.
.. replace the value ``"TermUrl"`` with *your randomly generated URL* from the webhook site.

. Click *Save*. +
The pop-up window closes.
. Next to your randomly generated URL, click *Open in a new tab.* +
. In the new tab, click *Continue.*
. Enter the password ``{three-d-s-pw}`` and click *Submit* (if required).
. Return to the previous webhook tab. +
You can find the PARes in the Form Values section.
. Copy the PARes and return to Postman.
. Enter the PARes and the transaction id of the check-enrollment response in the check-payer-response request.
. Send the check-payer-response request.
. Complete the payment transaction.

//-





