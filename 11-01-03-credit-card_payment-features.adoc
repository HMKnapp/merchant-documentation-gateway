[#CreditCard_PaymentFeatures]
==== Payment Features

[#CreditCard_PaymentFeatures_Tokenization]
===== Tokenization

[#CreditCard_PaymentFeatures_Tokenization_Introduction]
====== Introduction

Tokenization defines a process through which sensitive data, such as
credit card number, is replaced with a surrogate value known as a
"token". This token serves as a reference or surrogate value for the original credit card data.

Tokenization enables the merchant to use credit card data based on PCI
DSS regulations, during a payment process.

It is a service provided by _Wirecard_ for its customers. The token,
generated by _Wirecard_, reduces the merchant's PCI DSS Scope. That means,
merchants do not have to store sensitive primary account numbers.

There are two options of using tokenization

.  *Sending a Credit Card Transaction with Credit Card Data*. In this
case _Wirecard Payment Processing Gateway_ takes the credit card data
and encrypts the data. These data are stored in a secured encrypted area
inside _Wirecard Data Warehouse_ and are for use only in the encrypted
state and secured environment. +
*In other words:* Every card number that accompanies a transaction in
_Wirecard Payment Processing Gateway_ is subsequently tokenized.
Regardless of the outcome of the transaction, any subsequent transaction
with these credit card data uses its assigned token instead of the clear
card account values. This means the merchant system never needs to store
the sensitive card information, helping to reduce PCI DSS compliance
issues.
. *Sending an Explicit Request with the Transaction Type _Tokenize_ or _Detokenize_*. A transaction with this transaction type encrypts or
decrypts credit card data for later reuse. The sender only gets back a
_token-ID_. This _token-ID_ can be reused many times as unique
identifier for this specific credit card without sending or storing
credit card data on shop side.
//-

What is the difference between these two options?

[cols="1,2"]
|===
|Sending a Credit Card Transaction with Credit Card Data |Sending an Explicit Request with the Transaction Type _tokenize_ or _detokenize_

|always initiates a payment process *and* encrypts credit card data |encrypts credit card data only
|  |*does not* initiate a payment process
|===

[#CreditCard_PaymentFeatures_Tokenization_TokenID]
====== The _token-id_

The merchant sends an initial request to _Wirecard Payment Processing Gateway._
This could be an _authorization_ for example. This request contains all
data concerning the goods, shipping, etc as well as the consumer's
credit card data. +

After the request of an _authorization_ transaction was processed
successfully, the response will not contain the information of the
Credit Card <data> tag. The <data> tag will be replaced with
a _token-id_ in the <card-token> tag. As soon as
the _token-id_ is created, the _token-id_ represents this
special credit card. +

With that _token-id_ any recurring or other follow up transaction
for this special credit card can be processed. As there is no additional
encryption required, the use of the _token-id_ reduces interaction
and accelerates the credit card payment process. Especially from PCI DSS
perspective it is less critical. +

e.g. A _capture-authorization_ as follow up transaction in the workflow
does not need the <data> tag of the Credit Card but only the
_token-id_.

_When using credit card, Wirecard Payment Processing Gateway_ offers two different
options to reference transactions. It depends on the merchant’s
individual business needs and business processes, which type of
referencing should be used.

Look at the following table to understand the pros and cons of
referencing with a token or with the
<<GeneralPlatformFeatures_ReferencingTransaction, parent-transaction-id>>.


[cols="1,2,3"]
|===
| |_parent-transaction-id_ |_token-id_

.4+|Pro |Can be used for all alternative payment methods and _credit card_. |
       |Recurring transactions can always reference to a FIRST transaction. | Once created, the token can be reused as often as needed.
       |Referencing is possible to a previous transaction during the life cycle of a payment process. |Credit card check is only performed once (with the first transaction). Makes the payment process faster.
       |Reference is possible even on older transactions. |Reference is valid ad long as the _credit card_ is valid.
.2+|Con |Referencing only within one life cycle of a payment process. |Can only be used with _credit card_.
       |When used with _credit card_ all card checks have to be performed with every new transaction step. |If card has expired, new token will be needed, even if the card number remains the same.
|===

NOTE: When processing _credit card_ transactions, the merchant must be PCI DSS
compliant.

If the merchant only hands through a payment process (using a token) and
does not store card holder data, it reduces the merchant’s applicable
controls required for PCI DSS validation.

If the merchant wants to store card holder data (using
parent-transaction-id), it increases the merchant’s applicable controls
required for PCI DSS validation.

The following table describes, which data can be stored and which data
must not be stored to be PCI DSS compliant.

[cols="1,2,3, 4, 5"]
[%autowidth]
|===
2+| |Data Element |Storage permitted? |Data needs to be unreadable (in line with PCI DSS requirements)?
.7+|Account Data .4+|Card holder data |Primary Account Number (PAN) |YES |YES
                                      |Card holder name |YES |NO
                                      |Service code |YES |NO
                                      |Expiration date |YES |NO
                    .3+|Sensitive Authentication Data |Full track data |NO |Doesn't apply
                                                      |CAV2/CVC2/CVV2/CID |NO |Doesn't apply
                                                      |PIN/PIN Block |NO |Doesn't apply
|===

[#CreditCard_PaymentFeatures_Tokenization_TokenID_Referencing]
*Referencing by _token-id_*

Referencing based on a token can be performed by using the Field
<token-id>.

With that feature it is possible to refer a NEW transaction to an
already submitted initial transaction. In the initial transaction the
cluster of the <card> tag will be summarized in a _token-id_.
This _token-id_ will be used in any subsequent transaction, which is
based on this initial transaction. The _token-id_ can be seen as a
black box which guarantees a correct correlation of subsequent
transactions without transmitting the complete card data repeatedly.

[cols="1,2,3, 4, 5"]
[%autowidth]
|===
.2+h|Transaction Sequence .2+h|Transaction Type 2+h|Token-ID .2+h|<card-token>
                                                h|Token Definition h|Value

|Initial Transaction (Request) |authorization |the <card>-section and all its fields +
e.g.:<account-number>, <expiration-month> etc +
obtains the substitute _token-id_ Value
|1234567890987654 |empty
|Response on initial Transaction |authorization 2+|uses _token-id_ value generated from <card> data given in the initial transaction |1234567890987654
|Any subsequent transaction of this initial transaction |purchase 2+|uses _token-id_ value generated from <card> data given in the initial transaction |1234567890987654
|===

See the
<<CreditCard_Samples_PaymentProcessingUsingToken,samples for an overview of a payment process>>
consisting of the transaction
types _Authorization_ and _Purchase_ using a token.

[#CreditCard_PaymentFeatures_Tokenization_TokenizeCreditCard]
====== Tokenize a Credit Card

The transaction type _tokenize_ converts credit card information into a
token that can be used in subsequent payment transactions, instead of
the actual credit card information.

[#CreditCard_PaymentFeatures_Tokenization_TokenizeCreditCard_Workflow]
*Workflow*

image::images/11-01-03-credit-card_payment-features/Create_TokenID_Workflow.png[Create_TokenID_Workflow]

[#CreditCard_PaymentFeatures_Tokenization_TokenizeCreditCard_Fields]
*Fields*

The following fields must be sent either in the request or the response
(M = Mandatory, O = Optional). For details of the affected fields see
<<CreditCard_Fields, the field table>>.

[col="1,2,3"]
|===
|Field |Request |Response

3+a|
[#TableHeadline]
[discrete]
====== payment

|merchant-account-id |M |M
|transaction-id |M |
|request-id |M |M
|transaction-type |M |
|ip-address |O |

3+a|
[#TableHeadline]
[discrete]
====== statuses

|statuses.status | |M
|status@code | |M
|status@description | |M
|status@severity | |M

3+a|
[#TableHeadline]
[discrete]
====== account-holder

|account-holder.first-name |O |M
|account-holder.last-name |O |M
|account-holder.email |O |M
|account-holder.gender |O |M
|account-holder.date-of-birth |O |M
|account-holder.phone |O |M

3+a|
[#TableHeadline]
[discrete]
====== card

|card.account-number |M |
|card.expiration-month |M |
|card.expiration-year |O |
|card.card-type |M |

3+a|
[#TableHeadline]
[discrete]
====== card-token

|card-token.token-id | |M
|card-token.token-ext-id | |O
|card-token.masked-account-number |O |
|===

[#CreditCard_PaymentFeatures_Tokenization_TokenizeCreditCard_Samples]
*Samples*

For transaction process details see the
<<CreditCard_Samples_Tokenization, _Tokenize_ samples>>.

[#CreditCard_PaymentFeatures_Tokenization_DetokenizeCreditCard]
====== Detokenize a Credit Card

The transaction type _detokenize_ is the inverse of the transaction type
_tokenize._ With the transaction type _detokenize_ a token-id is
provided to retrieve the original credit card information.

[#CreditCard_PaymentFeatures_Tokenization_DetokenizeCreditCard_Fields]
*Fields*

The following fields must be sent either in the request or the response
(M = Mandatory, O = Optional). For details of the affected fields see
<<CreditCard_Fields, the field table>>.

[col="1,2,3"]
|===
|Field |Request |Response

3+a|
[#TableHeadline]
[discrete]
====== payment

|merchant-account-id |M |M
|transaction-id | |M
|request-id |M |M
|transaction-type | |M
|ip-address | |O

3+a|
[#TableHeadline]
[discrete]
====== statuses

|statuses.status | |M
|status@code | |M
|status@description | |M
|status@severity | |M

3+a|
[#TableHeadline]
[discrete]
====== account-holder

|account-holder.first-name |M |O
|account-holder.last-name |M |O
|account-holder.email |M |O
|account-holder.gender |M |O
|account-holder.date-of-birth |M |O
|account-holder.phone |M |O

3+a|
[#TableHeadline]
[discrete]
====== card

|card.account-number | |M
|card.expiration-month | |M
|card.expiration-year | |O
|card.card-type | |M

3+a|
[#TableHeadline]
[discrete]
====== card-token

|card-token.token-id |M |M
|card-token.token-ext-id |O |O
|card-token.masked-account-number | |O
|===

[#CreditCard_PaymentFeatures_Tokenization_DetokenizeCreditCard_Samples]
*Samples*


For transaction process details see the
<<CreditCard_Samples_Detokenization, _detokenize_ samples>>

NOTE: The transaction type _detokenize_ *is not included in default configuration.* +
For further information please contact: support@wirecard.com

[#CreditCard_PaymentFeatures_3DSecure]
===== 3-D Secure

3-D Secure is a protocol supported by all major card schemes that
provides secure authentication and processing of online payments.
Merchants wishing to comply need to integrate the specific 3-D requests
and payment parameters.

The Three Domain (3-D) Secure initiative by VISA is a payment standard
for secure handling of credit card transactions in electronic commerce.
This provides Issuers with the ability to authenticate cardholders
during an online purchase. Branded as Verified by Visa and MasterCard
SecureCode, Amex SafeKey and JCB J/Secure, 3-D Secure is designed to
clearly identify cardholders and accelerate the growth of electronic
commerce through increased consumer confidence.

Authentication is accomplished by verification of certain data which is
maintained by the card issuing bank and identifies the individual making
an online purchase as the legal owner of the card used. 3-D Secure is
more than a payment authentication method or a technology definition. It
is a model to isolate the liabilities of the various parties involved in
the payment transaction cycle. The payment environment requires the
participating cardholder to be registered (enrolled) for the process
with his issuing bank. In essence, all parties involved in the payment
flow must support the 3-D secure transactions. The 3-D framework
requires the card issuing and acquiring banks to provide cardholders and
merchants with an authentication methodology, without binding them to
proprietary technology.

[#CreditCard_PaymentFeatures_3DSecure_MPI]
====== Merchant Plug-In (MPI)

An MPI is a software module which provides a communication interface
between the merchant and the card schemes’ directory servers. It can be
integrated in the merchant website or it may be hosted by a service
provider or an acquirer. The main functions of an MPI are to verify the
card issuers digital signature used in the authentication process,
validate enrollment and authentication response messages, encrypt and
store passwords and certificates and retrieve payment records and
associated card details to resolve transaction disputes. Merchants can
choose to leverage the enrollment check and payment authentication using
a hosted or an integrated MPI. Both options will notify the merchant if
either of the two validations failed.

Payments need to be submitted with the relevant 3-D Secure artifacts
obtained from the MPI. See the
<<CreditCard_PaymentFeatures_3dSecure_Workflow, Process Flow>>
in order to see how to submit the relevant 3-D Secure artifacts. 

[#CreditCard_PaymentFeatures_3DSecure_MPI_WirecardMPI]
*Wirecard MPI*

This chapter describes the integrated MPI hosted by Wirecard, for
merchants that wish to use Wirecard as its 3-D Secure MPI Provider. This
solution performs all of the relevant validations and exchanges as
required by the card schemes.

[#CreditCard_PaymentFeatures_3DSecure_MPI_PaymentRequest]
*Payment Request with 3rd Party MPI*

If a merchant wishes to use a 3^rd^ Party MPI, only payments need to be
submitted with the relevant 3-D Secure artifacts obtained from the 3^rd^
Party MPI. The protocol is exactly the same as defined for
authorization or purchase request. Only the relevant 3-D artifacts
should be included in addition, conditionally on their availability. The
response remains the same as defined.

[#CreditCard_PaymentFeatures_3DSecure_MPI_Fields]
*Fields*

See the field description at
<<CreditCard_Fields_Payment, payment fields>> plus the fields, which are specific to
<<CreditCard_Fields_ThreeD, 3-D Secure>>.

[#CreditCard_PaymentFeatures_3DSecure_MPI_Samples]
*Samples*

See
<<CreditCard_Samples_PaymentRequest3rdPartyMPI, request/response samples>>
for _Payment Request with 3rd Party MPI_.

[#CreditCard_PaymentFeatures_3DSecure_Workflow]
====== Workflow

image::images/11-01-03-credit-card_payment-features/CreditCard_3dPartyMPI.png[CreditCard_3dPartyMPI]

Processing 3-D Secure transactions differs from standard payment
processing. Merchants must construct and route their transaction
requests accordingly.

The three necessary steps for processing are:

. *Check Enrollment*
. *Customer ACS Communication*
. *Check Payer Response* – Validation of the authentication result. This is used in conjunction with check enrollment.
//-

[#CreditCard_PaymentFeatures_3DSecure_CheckEnrollment]
====== Check Enrollment

Wirecard Payment Processing API permits merchants to check if a
card/cardholder is enrolled in the 3-D Secure program. To verify
Enrollment status, the merchant system sends a transaction request to
Wirecard’s MPI which in turn posts an Enrollment check request (VEReq)
to the card schemes’ directory servers. In an exchange of messages the
directory communicates with the ACS of the card issuer, if required, to
determine if the cardholder is enrolled for 3-D Secure. A response
message (VERes) is returned by the ACS to the MPI to prove that the
cardholder is enrolled or that authentication has been attempted.

[#CreditCard_PaymentFeatures_3DSecure_CheckEnrollment_Fields]
*Fields*

See the field description at
<<CreditCard_Fields_Payment, payment fields>> plus the fields, which are specific to
<<CreditCard_Fields_ThreeD, 3-D Secure>>.

[#CreditCard_PaymentFeatures_3DSecure_CheckEnrollment_Samples]
*Samples*

See
<<CreditCard_Samples_CheckEnrollment, request/response samples>>
for _Check Enrollment_.

[#CreditCard_PaymentFeatures_3DSecure_CustomerACS]
====== Customer ACS Communication

_Customer ACS Communication_ redirects the consumer to the Access
Control Server (ACS) URL, a webpage provided by the cardholder's bank.
This allows the consumer to authenticate himself by entering his 3-D
credentials.

In addition to the interface setup between the merchant and Wirecard,
the successful 3-D Secure implementation requires some interaction
between the merchant and the issuing bank via the cardholder browser.

WARNING: *There is NO interaction with Wirecard for this step.*

To get the 3-D authentication to work, it is necessary that the merchant
communicates with the Access Control Server (ACS) by SSL-encrypted HTTP
POST request. In setting up the HTTPS Post authentication request, the
merchant must ensure that the following enrollment check of the purchase
order is redirected from the merchant server to the card issuer's Access
Control Server (ACS).

[#CreditCard_PaymentFeatures_3DSecure_CustomerACS_Fields]
*Fields*

See the field description at
<<CreditCard_Fields_Payment, payment fields>> plus the fields, which are specific to
<<CreditCard_Fields_ThreeD, 3-D Secure>>.

[#CreditCard_PaymentFeatures_3DSecure_CustomerACS_HTTPSRedirect]
*ACS HTTPS Redirect*

In case a card is eligible and enrolled (‘check-enrollment’, Transaction
Status Code = 200.0000) the merchant system must redirect the customer’s
browser to the ACS URL provided in the Verify 3-D Participation
response. If the card is not enrolled ((‘check-enrollment’, Transaction
Status Code = 500.1072) , the ACS redirect must be skipped.

This HTTPS POST message includes the web address (URL) of the ACS and
three hidden input types: <PaReq>, <TermUrl> and <MD>.

The <*_PaReq_*>   defined as the Payment Authentication Request.

The <*_TermUrl_*> defines the web address of the merchant site to
which the issuer returns the Payment Authentication Response (PARes)
message.

The parameter type <*_MD_*> is reserved for specific merchant data.
Although this field is mandatory, it does not need to have a value
defined. If this input type is omitted an authentication error will
occur and the payment process is aborted. The <MD> may be useful for
retrieving transaction data from the database or recalling a
transaction. The data is returned untouched by the ACS with the Payment
Authentication Response (PARes).

.Auto submission POST Request
[source,html]
----
<html>
   <head>
      <meta HTTP-EQUIV="Content-Type" content="text/html; charset=UTF-8" />
      <meta HTTP-EQUIV="Cache-Control" CONTENT="no cache" />
      <meta HTTP-EQUIV="Pragma" CONTENT="no cache" />
      <meta HTTP-EQUIV="Expires" CONTENT="0" />
   </head>
   <body OnLoad="AutoSubmitForm();">
      <form name="downloadForm" action="AcsUrl" method="POST">
         <input type="hidden" name="PaReq" value="PaReq" />
         <input type="hidden" name="TermUrl" value="TermUrl" />
         <input type="hidden" name="MD" value="optionalValue" />
         <SCRIPT LANGUAGE="Javascript">
            <!--function AutoSubmitForm() { document.downloadForm.submit();}//-->
         </SCRIPT>
         <input type="submit" name="continue" value="Continue" />
      </form>
   </body>
</html>
----

[#CreditCard_PaymentFeatures_3DSecure_CustomerACS_HTTPSRedirectTermURL]
*ACS HTTPS Redirect to TermURL*

The cardholder's browser passes the encrypted *_PaReq_* message
unprocessed to the ACS.

This step is made up of two phases: The server invokes an authentication
popup or inline window in the cardholder's browser. The cardholder
enters a password in the authentication window and the data returns to
the ACS.

The ACS authenticates the cardholder's password, constructs the
verification ID, and posts an SSL-encrypted and digitally signed Payment
Authentication Response (_PARes_) to the TermURL via the account
holder's browser. Encryption and signature ensure that the content
cannot be modified during transit.

The cardholder browser redirects the fully encrypted _PARes_ to the
merchant's server address specified as *_TermUrl_*. The response message
contains the results of the cardholder authentication and the untouched
merchant data (*_MD_*).

[#CreditCard_PaymentFeatures_3DSecure_CheckPayersResponse]
====== Check Payers Response

The merchant has received the PARes via the *_TermUrl_*. This request
should be used in case you are using the Payment Processing API as “MPI
only”.  Otherwise the PARes should be included along with the subsequent
payment request.

NOTE: To ensure a unique transaction flow the _Check Payer Response_ should be
called for ALL 3-D transactions regardless of the enrollment status. The
_Check Payer Response_ includes the ECI  which is needed for further
payment processing.

[#CreditCard_PaymentFeatures_3DSecure_CheckPayersResponse_Fields]
*Fields*

See the field description at
<<CreditCard_Fields_Payment, payment fields>> plus the fields, which are specific to
<<CreditCard_Fields_ThreeD, 3-D Secure>>.

[#CreditCard_PaymentFeatures_3DSecure_CheckPayersResponse_Samples]
*Samples*

See
<<CreditCard_Samples_CheckPayerResponse, request/response samples>>
for _Check Payer Response_.

[#CreditCard_PaymentFeatures_3DSecure_PaymentRequestPARes]
====== Payment Request with PARes

The merchant has received the PARes via the *_TermUrl_*. The PARes is
forwarded to Wirecard along with payment request.

[#CreditCard_PaymentFeatures_3DSecure_PaymentRequestPARes_Fields]
*Fields*

See the field description at
<<CreditCard_Fields_Payment, payment fields>> plus the fields, which are specific to
<<CreditCard_Fields_ThreeD, 3-D Secure>>.

NOTE: The _parent-transaction-id_ supplied is the transaction-id of the
‘check-enrollment’ response. +
The PARes is received after communicating with the issuing bank. +
EE checks the payer response encoded in PARes. If successful, it will
perform the transaction.

[[PaymentFeatures-Samples.5]]
Samples
^^^^^^^

See
https://document-center.wirecard.com/display/PTD/Samples%3A+Requests%2C+Responses+and+Notifications#Samples:Requests,ResponsesandNotifications-PaymentRequestwithPARes[request/response
samples] for __Payment Request with PARes__.

[[PaymentFeatures-DynamicDescriptor]]
Dynamic Descriptor
------------------

With the _Dynamic Descriptor_, merchants can itemize sales more clearly
to the benefit of their customers, back office and consumer care
management.

As merchants can add sales-specific information to electronic settlement
requests, consumers have a better understanding of what they purchased.
This increases their level of satisfaction and reduces the number of
chargebacks. Known as a dynamic descriptor, the details can be included
in any settlement transaction, be it e-commerce, POS or MOTO.

[[PaymentFeatures-DataandStructure]]
Data and Structure
~~~~~~~~~~~~~~~~~~

_Merchant Name_ and _Merchant Location_ are usually displayed on the
cardholder’s bank statement. These fields or parts of them are used for
presenting the dynamic data on the cardholder’s statement.

Apart from such static data, the merchant can add transaction
information to better reference their sales. For example, the merchant
may use invoice number, booking ID or transaction ID. This data is
typically passed along to the merchant. As this field has a fixed
length, the longer the merchant name is, the smaller the number of
digits allocated to dynamic information will be.

[[PaymentFeatures-DigitsAllocation]]
Digits Allocation
^^^^^^^^^^^^^^^^^

Card Brand

Field

Digits

VISA

Name

25

Location

13

Master Card

Name

22

Location

13

JBC

Name

25

Location

13

Merchants are advised to consider all these parameters before setting a
dynamic descriptor, because any text exceeding the permissible length is
cut off and discarded.

Please be aware that industry-specific restrictions apply by card
schemes.

Please also note that it is up to the issuer to decide which data
provided in the dynamic descriptor is printed on the cardholder’s
statement. Wirecard can thus not guarantee that the dynamic descriptor
data submitted to the issuers via the scheme networks is fully printed
on the cardholder’s statement.

Wirecard Bank (WDB) receives the transaction data from the Wirecard
processing platform, looks up the merchant address, consolidates static
address details and dynamic sales data (including _Merchant Name_ and
_Merchant Location_) and routes the information along with the
settlement request to the issuer. To what level the routed details will
later appear on the customer’s card statement may vary from issuer to
issuer.

[[PaymentFeatures-HowItWorks]]
How It Works
~~~~~~~~~~~~

When a merchant sends a transaction request with a dynamic descriptor,
the data provided in the reserved transaction field tag expands the
address information registered in the card acquirer’s MID database.

The dynamic descriptor is created for settlement transaction types such
as _Purchase_, _Capture_ or _Credit_. _Authorisation_ is not supported.

[[PaymentFeatures-Workflow.2]]
Workflow
~~~~~~~~

image:attachments/4751398/4751401.png[image,height=250]

{empty}1. The consumer shops at the merchant’s site and enters his card
details at checkout.

{empty}2. The merchant system records the data and posts an XML request
with the default identifiers including the descriptor text (entered in
one of the <Transaction-ID>, <Order Number>, <Request ID> or
<Descriptor> tag) to the _Wirecard Payment Gateway_.

{empty}3. _Wirecard Payment Gateway_ processes the request and forwards
the transaction details to the Wirecard Bank (acquirer).

{empty}4. Wirecard Bank acquires the card and sales details, reads the
related identifier values, looks up the merchant’s name and business
details in the MID database and complements the merchant data with the
data sent in one of the transaction identifier tag fields.

{empty}5. Wirecard Bank routes the settlement request including the
dynamic text to the issuer.

{empty}6. The issuer processes the request, debits the consumer’s
account and adds a new debit item with the dynamic descriptor to the
credit card statement.

[[PaymentFeatures-PaymentFacilitator]]
Payment Facilitator
-------------------

The _Payment Facilitator_ model allows a Payment Service Provider with a
_Payment Facilitator_ license to aggregate credit card payments, collect
funds resulting from credit card traffic and settle sub merchants
directly.

Requests in _Payment Facilitator_ traffic require additional sub
merchant information in the
<https://document-center.wirecard.com/pages/viewpage.action?pageId=3703633#Fields(CreditCard)-sub-merchant-info[sub-merchant-info]>
tag of each first request in the transaction flow (e.g.:
_check-enrollment_, _authorization-only_, _authorization_ or
_purchase_).

The sub merchant information is only required for Master Card traffic,
but Wirecard recommends to send it for every credit card brand to avoid
complexity in implementation.

Each transaction type must contain the <sub-merchant-info> in the
initial step. For the following steps <sub-merchant-info> is not
mandatory, but Wirecard recommends to send <sub-merchant-info> in every
step. This helps to avoid complexity in implementation.

[[PaymentFeatures-HowItWorks.1]]
How It Works
~~~~~~~~~~~~

image:attachments/4751398/4751402.png[image,height=250] +

See the
https://document-center.wirecard.com/display/PTD/Samples%3A+Requests%2C+Responses+and+Notifications#Samples:Requests,ResponsesandNotifications-PaymentFacilitatorTransactions[corresponding
samples for details].

[[PaymentFeatures-RecurringTransaction]]
Recurring Transaction
---------------------

To submit a
https://document-center.wirecard.com/display/PTD/General+Platform+Features#GeneralPlatformFeatures-RecurringTransaction.1[recurring
transaction], the merchant must submit a request with the transaction
type _authorization-only_, _authorization_ or _purchase_ __ including
the
https://document-center.wirecard.com/display/PTD/General+Platform+Features#GeneralPlatformFeatures-ThePeriodicType[PERIODIC
TYPE] element and a
https://document-center.wirecard.com/display/PTD/General+Platform+Features#GeneralPlatformFeatures-TheSequenceType[SEQUENCE
TYPE].

[[PaymentFeatures-CreditCardspecificPeriodicTypes]]
Credit Card specific _Periodic Types_
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Aside from the standard _Periodic Types, Credit Card_ can also be used
with the _Periodic Types ucof_ and _ci. +
_

[[PaymentFeatures-ucof]]
_ucof_
^^^^^^

_The Unscheduled Credential on File (ucof)_ allows the merchant to
reference a regularly based transaction (like an unlimited periodic
payment or an installment payment) to an already successfully submitted
transaction. _ucof_ is a transaction using a stored credential for a
fixed or variable amount that does not occur on a scheduled or regularly
occurring transaction date, where the cardholder has provided consent
for the merchant to initiate one or more future transactions. An example
of such transaction is an account auto-top up transaction.

[[PaymentFeatures-ci]]
ci
^^

The periodic type _ci_ (Consumer Initiated) allows the merchant to
identify that the cardholder himself initiated the transaction and
whether this is an initial (first) or subsequent (recurring) one. As
soon as this is subsequent merchant initiated transaction (e.g. the
cardholder used an account on merchant side ) and the corresponding
information is sent to Wirecard Payment Gateway, CVV could be omitted
within the transaction and Visa will still approve it. So this will lead
to higher approve rate in the future.

[[PaymentFeatures-Restrictions]]
Restrictions +
~~~~~~~~~~~~~~

Read, which
https://document-center.wirecard.com/display/PTD/General+Platform+Features#GeneralPlatformFeatures-Restrictions[restrictions]
have to be met to use a recurring transaction.

[[PaymentFeatures-Samples.6]]
Samples +
~~~~~~~~~

See
https://document-center.wirecard.com/display/PTD/Samples%3A+Requests%2C+Responses+and+Notifications#Samples:Requests,ResponsesandNotifications-RecurringTransaction[request/response
samples] for __Recurring Transaction__.

[[PaymentFeatures-PossibleScenarios]]
Possible Scenarios
~~~~~~~~~~~~~~~~~~

[[PaymentFeatures-ShoppingOnline/ViaanApp]]
Shopping Online/Via an App
^^^^^^^^^^^^^^^^^^^^^^^^^^

_Establish Stored Credential/First Transaction +
_

1.  Cardholder consent is obtained: _merchant-tokenization-flag_ set
to _true_
2.  Cardholder provides the Credit Card data including CVV/CVC2 code
(required): _periodic/periodic-type = 'ci'_ included in the transaction
and __periodic/sequence-type = 'first'__
3.  Merchant sends the transaction to _Wirecard Payment Gateway_

*Example: Establishment of Stored Credential/First Transaction*

[source,syntaxhighlighter-pre]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>ci</periodic-type>
    <sequence-type>first</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>d2648f3b-1017-4787-a6de-4fb013036843</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
   <card>
      <account-number>4147460000000002</account-number>
      <expiration-month>12</expiration-month>
      <expiration-year>2020</expiration-year>
      <card-type>visa</card-type>
      <card-security-code>123</card-security-code>
      <merchant-tokenization-flag>true</merchant-tokenization-flag>
   </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

_Subsequent Cardholder Initiated Purchase_

1.  Cardholder consent is obtained: _merchant-tokenization-flag_ set
to _true_
2.  Cardholder data is saved within a cardholder's account (CVV is not
required)
3.  Cardholder uses the account to make a
purchase: _periodic/periodic-type = 'ci'_ included in the transaction
and__ periodic/sequence-type = 'recurring'__
4.  Merchant sends the transaction to _Wirecard Payment Gateway_

*Example: Subsequent Cardholder initiated purchase*

[source,syntaxhighlighter-pre]
----
 <payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>ci</periodic-type>
    <sequence-type>recurring</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>4f59f9c0-73d7-49fc-9414-a7f90aa94b7f</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <parent-transaction-id>0c036ea9-3aef-41e6-82d4-d16514379bee</parent-transaction-id>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
    <card-token>
      <token-id>4628584608610002</token-id>
   </card-token>
   <card>
    <merchant-tokenization-flag>true</merchant-tokenization-flag>
    </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

_Guest Account/Single Transaction_

1.  Since Cardholder doesn't create a account, Cardholder data is not
being saved: the default value for _merchant-tokenization-flag_ is
_false_
2.  Cardholder provides the Credit Card data including CVV/CVC2 code
(required)
3.  Merchant sends the transaction to _Wirecard Payment Gateway_

*Example: guest account/single transaction*

[source,syntaxhighlighter-pre]
----
 <payment xmlns="http://www.elastic-payments.com/schema/payment">
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>d2648f3b-1017-4787-a6de-4fb013036843</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
   <card>
      <account-number>4147460000000002</account-number>
      <expiration-month>12</expiration-month>
      <expiration-year>2020</expiration-year>
      <card-type>visa</card-type>
      <card-security-code>123</card-security-code>
   </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

[[PaymentFeatures-Recurring(R)orInstallment(I)Transaction]]
Recurring (R) or Installment (I)Transaction
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

_First Recurring or Installment_

1.  Cardholder consent is obtained: _merchant-tokenization-flag_ set
to _true_
2.  Cardholder would like to initiate Recurring or Installment payments
3.  Cardholder provides the Credit Card data including CVV/CVC2
code: _periodic/periodic-type = 'installment'/'recurring'_ included in
the transaction and _periodic/sequence-type = 'first'_
4.  Merchant sends the transaction to Wirecard Payment Gateway

*Example: First Recurring or Installment*

[source,syntaxhighlighter-pre]
----
 <payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>recurring</periodic-type>
    <sequence-type>first</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>4f59f9c0-73d7-49fc-9414-a7f90aa94b7f</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <parent-transaction-id>0c036ea9-3aef-41e6-82d4-d16514379bee</parent-transaction-id>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
   <card>
      <account-number>4147460000000002</account-number>
      <expiration-month>12</expiration-month>
      <expiration-year>2020</expiration-year>
      <card-type>visa</card-type>
      <card-security-code>123</card-security-code>
      <merchant-tokenization-flag>true</merchant-tokenization-flag>
   </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

[[PaymentFeatures-SubsequentRecurringorInstallment]]
Subsequent Recurring or Installment
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

_Merchant Initiated Transaction_

1.  Merchant initiates a subsequent Recurring or Installment
payment: _periodic/periodic-type = 'installment'/'recurring'_ included
in the transaction and__ periodic/sequence-type = 'recurring'__
2.  Merchant sends the transaction to Wirecard Payment Gateway

*Example: Merchant initiated transaction*

[source,syntaxhighlighter-pre]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>recurring</periodic-type>
    <sequence-type>recurring</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>4f59f9c0-73d7-49fc-9414-a7f90aa94b7f</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <parent-transaction-id>0c036ea9-3aef-41e6-82d4-d16514379bee</parent-transaction-id>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
    <card-token>
      <token-id>4628584608610002</token-id>
   </card-token>
   <card>
    <merchant-tokenization-flag>true</merchant-tokenization-flag>
    </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

[[PaymentFeatures-ucof.1]]
ucof
^^^^

_First ucof** +
**_

_Example_: auto-top up for transit or mobile – date is irregular, i.e.
not known as usage driven

1.  Cardholder consent is obtained: _merchant-tokenization-flag_ set
to _true_
2.  Cardholder would like to initiate _ucof_ payments
3.  Cardholder provides the Credit Card data including CVV/CVC2
code: _periodic/periodic-type = 'ucof'_ included in the transaction
and__ periodic/sequence-type = 'first'__
4.  Merchant sends the transaction to Wirecard Payment Gateway

*Example: First UCOF*

[source,syntaxhighlighter-pre]
----
 <payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>ucof</periodic-type>
    <sequence-type>first</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>4f59f9c0-73d7-49fc-9414-a7f90aa94b7f</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <parent-transaction-id>0c036ea9-3aef-41e6-82d4-d16514379bee</parent-transaction-id>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
   <card>
      <account-number>4147460000000002</account-number>
      <expiration-month>12</expiration-month>
      <expiration-year>2020</expiration-year>
      <card-type>visa</card-type>
      <card-security-code>123</card-security-code>
      <merchant-tokenization-flag>true</merchant-tokenization-flag>
   </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

_Merchant Initiated Transaction_

1.  Merchant initiates a subsequent UCOF
payment: _periodic/periodic-type = 'ucof'_  included in the transaction
and__ periodic/sequence-type = 'recurring'__
2.  Merchant sends the transaction to Wirecard Payment Gateway

*Example: First UCOF*

[source,syntaxhighlighter-pre]
----
<payment xmlns="http://www.elastic-payments.com/schema/payment">
   <periodic>
    <periodic-type>ucof</periodic-type>
    <sequence-type>recurring</sequence-type>
   </periodic>
   <merchant-account-id>32bb900b-265b-414f-9971-23f7a0542434</merchant-account-id>
   <request-id>4f59f9c0-73d7-49fc-9414-a7f90aa94b7f</request-id>
   <transaction-type>authorization</transaction-type>
   <requested-amount currency="USD">1.02</requested-amount>
   <parent-transaction-id>0c036ea9-3aef-41e6-82d4-d16514379bee</parent-transaction-id>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>John.Doe@test.com</email>
      <phone></phone>
   </account-holder>
    <card-token>
      <token-id>4628584608610002</token-id>
   </card-token>
   <card>
    <merchant-tokenization-flag>true</merchant-tokenization-flag>
    </card>
   <ip-address>127.0.0.1</ip-address>
</payment>
----

[[PaymentFeatures-Non-ReferencedCapture]]
Non-Referenced Capture
~~~~~~~~~~~~~~~~~~~~~~

In an offline transaction process it is possible to have a
non-referenced capture authorization. The _Wirecard Payment Gateway_ can
support such a type of transaction when using a special
capture-authorization _Credit Card_ transaction.

A transaction is considered non-referenced capture when it meets all
the  following four conditions in the payment XML request:

1.  The transaction type is _Capture-Authorization_
2.  The payment-method is _Credit Card_
3.  The _Parent-Transaction-ID_ is empty (no tag present)
4.  The authorization-code is present (can have empty value)

If all conditions are met, then the transaction is sent to _Wirecard
Payment Gateway_. 

The most exceptional fact in this process is, that it is missing the
_Parent-Transaction-ID_. By default, _Capture-Authorization_ takes most
of its properties from the parent transaction.

Even though no parent transaction is available, captures which have not
been referenced by _Wirecard Payment Gateway_ can be processed. Cases
like this will be handled a non-referenced _Capture-Authorization_
transaction type. In that case all fields must be supplied with the
_Capture-Authorization_ request.

Attachments:
~~~~~~~~~~~~

image:images/icons/bullet_blue.gif[image,width=8,height=8]
link:attachments/4751398/4751397.png[20171013_Create
TokenID_Workflow.png] (image/png) +
image:images/icons/bullet_blue.gif[image,width=8,height=8]
link:attachments/4751398/4751401.png[20171117_Credit Card_Dynamic
Descriptor_Workflow.png] (image/png) +
image:images/icons/bullet_blue.gif[image,width=8,height=8]
link:attachments/4751398/4751402.png[Enable payment facilitator.png]
(image/png) +

[[footer]]
Document generated by Confluence on Feb 12, 2019 16:42

[[footer-logo]]
http://www.atlassian.com/[Atlassian]
