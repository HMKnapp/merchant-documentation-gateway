[#WPP_PayPal]
===== PayPal

[#WPP_PayPal_General]
====== General Information

This is a reference page for _PayPal_. Here you'll find all the
information necessary for integrating this payment method in
your Hosted and Embedded Payment Page.

.Are you unfamiliar with Wirecard Payment Page (WPP)?

NOTE: Visit one of the integration guides
(<<PPSolutions_WPP_HPP_HPPintegration, Hosted>>,
<<PPSolutions_WPP_HPP_EPPintegration, Embedded>>) for a quick explanation and
a step-by-step guide before continuing.

All <<PPSolutions_WPP, WPP>> integrations share a
<<PPSolutions_WPP_Workflow, common process flow>>﻿ for creating payments.

Below, you find example requests for
<<WPP_PayPal_TransactionType_debit, _debit_>>,
<<WPP_PayPal_TransactionType_authorization, _authorization_>>,
<<WPP_PayPal_TransactionType_authorizationonly, _authorization-only_>> and
<<WPP_PayPal_TransactionType_order, _order_>>, 
including field lists with short descriptions.

These requests are designed for the testing environment and do not
use real information. 

NOTE: For production, you need to use production credentials. For details
contact our <<ContactUs, merchant support>>.

All given requests return successful responses.

For more details on the ``redirect-url``, see the 
<<PPSolutions_WPP_ConfigureRedirects, Configuring Redirects and IPNs for WPP>>﻿﻿ 
section.

For response verification examples, see
the <<PPSolutions_WPP_WPPSecurity, WPP Security>>﻿ section.

[#WPP_PayPal_About]
====== About _PayPal_

image::images\03-01-04-07-paypal/paypal_logo.png[image,width=80]

_PayPal_ is a world wide online payment system which supports online money
transfers and allows consumers to make and accept payments without
having to share their financial information with each specific merchant
(_PayPal_ handles the transfer).

[#WPP_PayPal_TestCredentials]
====== Test Credentials

Test credentials for transaction types
<<WPP_eps_TransactionType_debit, _debit_>>,
<<WPP_PayPal_TransactionType_authorization, _authorization_>>,
<<WPP_PayPal_TransactionType_authorizationonly, _authorization-only_>> and
<<WPP_PayPal_TransactionType_order, _order_>>

[cols="35h,65"]
|===
| URL(s) Endpoints
|``\https://wpp-test.wirecard.com/api/payment/register``
| Merchant Account ID (MAID)
| 9abf05c1-c266-46ae-8eac-7f87ca97af28
| Username
| 70000-APITEST-AP
| Password
| qD2wzQ_hrc!8
| Secret Key (used for response verification)
| 5fca2a83-89ca-4f9e-8cf7-4ca74a02773f
|===

[#WPP_CC_TestCredentials_Additional]
._PayPal_ Login Credentials

[cols="15h,85"]
|===
| Email
|buyer@wirecard.com
|Password
|Einstein35
|===

image::images\03-01-04-07-paypal/paypal_wd_merchant_test_store.jpg[image,width=700]

[#WPP_PayPal_TransactionType_debit]
====== Transaction Type _debit_

A debit transaction charges the specified amount from the account
holder's bank account and marks it for immediate transfer.

For a successful transaction:

. Create a payment session (initial request).
. Redirect the customer to the payment page (initial response URL).
. Highly recommended: Parse and process the payment response. +

We provide ready-made JSON examples for each step of this process. You
can find them below.

<<WPP_PayPal_TestCredentials, Endpoint>> for _PayPal_ transactions.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_PayPal_ payment form.

.Request Headers
[cols="20,80"]
|===
h| Authorization
| Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
h| Content-Type
| application/json
|===

.Optional fields

For a full list of optional fields you can use, see the REST API
<<API_PaymentMethods_PayPal, _PayPal_ specification>>.

For a full structure of a request (optional fields included), see the
<<WPP_PayPal_JSONNVPFields, JSON/NVP Field Reference>> section.

.1. Create a Payment Session (Initial Request)

[source,json]
----
 {
    "payment": {
        "merchant-account-id": {
            "value": "9abf05c1-c266-46ae-8eac-7f87ca97af28"
            },
        "request-id": "{{$guid}}",
        "transaction-type": "debit",
        "requested-amount": {
            "currency": "EUR",
            "value": "1.00"
        },
        "payment-methods": {
            "payment-method": [
                {
                "name": "paypal"
            }
        ]
        }
    }
}
----

[cols="20e,10,10,10,5,45"]
|===
2+|Field (JSON) |Data Type |Required/Optional |Size |Description

|merchant-account-id e|value |String |Required |36 |A unique identifier
assigned to every merchant account (by Wirecard).
2+|request-id |String |Required |64 a|A unique identifier assigned to every
request (by merchant). Used when searching for or referencing it later.
``{{$guid}}`` serves as a placeholder for a random ``request-id``.

Allowed characters:  [a-z0-9-_]
2+|transaction-type |String |Required |36 |The requested transaction type.
.2+|requested-amount e|value |Numeric |Required |18 a|The full amount that is
requested/contested in a transaction. 2 decimal digits allowed.

Use . (decimal point) as the separator.

|currency |String |Required |3 a|The currency of the requested/contested
transaction amount.

Format: 3-character abbreviation according to ISO 4217.
|payment-method e|name |String |Optional |15 |The name of the payment method
used. Set this value to _PayPal_.
|===

.2. Redirect the Customer to the Payment Page (Initial Response URL)

[source,json]
----
{
"payment-redirect-url" : "https://wpp.wirecard.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7"
}
----

[cols="<,<,<",]
|===
|Field (JSON) |Data Type |Description

|payment-redirect-url |String |The URL which redirects to the payment
form. Sent as a response to the initial request.
|===

At this point, you need to redirect your customer to
``payment-redirect-url`` (or render it in an _iframe_ depending on your
<<PPSolutions_WPP, integration method>>﻿).

The customers are redirected to the payment form. There they enter their
data and submit the form to confirm the payment. A payment can be:

- successful (``transaction-state: success``),
- failed (``transaction-state: failed``),
- canceled. The customer canceled the payment before/after submission
(``transaction-state: failed``).

//-

The transaction result is the value of ``transaction-state`` in the
payment response. More details (including the status code) can also be
found in the payment response in the ``statuses`` object. Canceled
payments are returned as  _failed_, but the status description indicates it
was canceled.

In any case (unless the customer cancels the transaction on a 3rd party
provider page), a base64 encoded response containing payment information
is sent to the configured redirection URL. See
<<PPSolutions_WPP_ConfigureRedirects, Configuring Redirects and IPNs for WPP>>﻿﻿
for more details on redirection targets after payment & transaction status
notifications.

You can find a decoded payment response example below.

.3. Parse and Process the Payment Response (Decoded Payment Response)*

[source,json]
----
 {
  "api-id" : "up3-wpp",
  "parent-transaction-id" : "3f792a90-3331-45fe-96ce-3961ff69edc1",
  "shipping" : {
    "last-name" : "Puente",
    "first-name" : "Tito",
    "address" : {
      "street1" : "C/ La Cochibamba 3",
      "city" : "Madrid",
      "postal-code" : "28001",
      "country" : "ES"
    }
  },
  "wallet" : {
    "account-id" : "ZNKTXUBNSQE2Y"
  },
  "payment-methods" : {
    "payment-method" : [ {
      "name" : "paypal"
    } ]
  },
  "transaction-id" : "b026a9bc-618f-4750-9a00-4fb475c27ce1",
  "completion-time-stamp" : "2018-03-21T17:22:25",
  "requested-amount" : {
    "currency" : "EUR",
    "value" : 1.000000
  },
  "statuses" : {
    "status" : [ {
      "description" : "The resource was successfully created.",
      "provider-transaction-id" : "1PK89494VW075423R",
      "severity" : "information",
      "code" : "201.0000"
    } ]
  },
  "instrument-country" : "DE",
  "request-id" : "12eb44db-4d75-4cf4-bd52-9c047e024eee",
  "merchant-account-id" : {
    "value" : "9abf05c1-c266-46ae-8eac-7f87ca97af28"
  },
  "transaction-state" : "success",
  "transaction-type" : "debit",
  "account-holder" : {
    "last-name" : "Puente",
    "email" : "tito.puente@example.com",
    "first-name" : "Tito"
  }
}
----

[cols="30,5,5,5,55"]
|===
3+|Field (JSON) |Data Type |Description

3+|api-id |String |Identifier of the currently used API.
3+|parent-transaction-id |String |The ID of the transaction being referenced
as a parent.
.6+|shipping 2+|last-name |String |The last name of the shipping address.
2+|first-name |String |The first name of the shipping address.
.4+|address |street1 |String |The first line of the shipping address street.
|city |String |The city of the shipping address.
|postal-code |String |The postal code/ZIP of the shipping address.
|country |String |The country ID part of the shipping address.
3+|account-id |String |Account holder's _PayPal_ Wallet identifier.
|payment-methods |payment-method |name |String |The name of the payment method
used for the transaction.
3+|transaction-id |String |A unique identifier assigned to every transaction
(by Wirecard). Used when searching for or referencing to it later.
3+|completion-time-stamp |YYYY-MM-DD-Thh:mm:ss a|The UTC/ISO time-stamp
documents the time & date when the transaction was executed.

Format: YYYY-MM-DDThh:mm:ss (ISO).
.2+|requested-amount 2+|currency |String a|The currency of the requested/contested transaction amount.

Format: 3-character abbreviation according to ISO 4217.
2+|value |Numeric |The full amount that is requested/contested in a transaction. 2 decimals allowed.
.4+|statuses .4+|status |description |String |The description of the transaction status message.
|provider-transaction-id |String |A unique transaction identifier generated by the provider.
|severity |String a|The definition of the status message.

Possible values:

- information
- warning
- error

//-

|code |String |Status code of the status message.
3+|instrument-country |String |Payment origin country.
3+|request-id |String |A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later.
2+|merchant-account-id |value |String |A unique identifier assigned to every merchant account (by Wirecard).
3+|transaction-state |String a|The current transaction state.

Possible values:

- in-progress
- success
- failed

Typically, a transaction starts with state in-progress and finishes with state either success or failed. This information is returned in the response only.
3+|transaction-type |String |The requested transaction type.
.3+|account-holder 2+|last-name |String |The last name of the account holder.
2+|email |String |Account holder's email address.
2+|first-name |String |The first name of the account holder.
|===

[#WPP_PayPal_TransactionType_authorization]
====== Transaction Type _authorization_

An _authorization_ transaction places the account holder's funds on hold,
pending future _capture_, _re-authorization_ or void transaction.

As with other referenceable transaction types, you can use WPP only to
create the authorization itself. To capture or register additional
transactions referencing it, you need to use our <<RestApi, REST API>>. 

For a successful transaction:

. Create a payment session (initial request).
. Redirect the customer to the payment page (initial response URL).
. Highly recommended: Parse and process the payment response. +

 We provide ready-made JSON examples for each step of this process. You
can find them below. 

<<WPP_PayPal_TestCredentials, Endpoint>> for _PayPal_ transactions.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_PayPal_ payment form.

.Request Headers
[cols="20,80"]
|===
h| Authorization
| Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
h| Content-Type
| application/json
|===

.Optional fields

For a full list of optional fields you can use, see the REST API
<<API_PaymentMethods_PayPal, _PayPal_ specification>>.

For a full structure of a request (optional fields included), see the
<<WPP_PayPal_JSONNVPFields, JSON/NVP Field Reference>> section at the bottom.

.1. Create a Payment Session (Initial Request)

[source,json]
----
 {
  "payment" : {
    "merchant-account-id" : {
      "value" : "9abf05c1-c266-46ae-8eac-7f87ca97af28"
    },
    "request-id" : "{{$guid}}",
    "transaction-type" : "authorization",
    "requested-amount" : {
      "value" : 10.1,
      "currency" : "EUR"
    },
    "payment-methods" : {
      "payment-method" : [
        {
        "name" : "paypal"
      }
        ]
    }
  }
}
----


[cols="20e,10,10,10,5,45"]
|===
2+|Field (JSON) |Data Type |Required/Optional |Size |Description

|merchant-account-id e|value |String |Required |36 |A unique identifier
assigned to every merchant account (by Wirecard).
2+|request-id |String |Required |64 a|A unique identifier assigned to every
request (by merchant). Used when searching for or referencing it later.
``{{$guid}}`` serves as a placeholder for a random ``request-id``.

Allowed characters:  [a-z0-9-_]
2+|transaction-type |String |Required |36 |The requested transaction type.
.2+|requested-amount e|value |Numeric |Required |18 a|The full amount that is
requested/contested in a transaction. 2 decimal digits allowed.

Use . (decimal point) as the separator.

|currency |String |Required |3 a|The currency of the requested/contested
transaction amount.

Format: 3-character abbreviation according to ISO 4217.
|payment-method e|name |String |Optional |15 |The name of the payment method
used. Set this value to _PayPal_.
|===

.2. Redirect the Customer to the Payment Page (Initial Response URL)

[source,json]
----
{
"payment-redirect-url" : "https://wpp.wirecard.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7"
}
----

[cols=",,",]
|===
|Field (JSON) |Data Type |Description

|payment-redirect-url |String |The URL which redirects to the payment
form. Sent as a response to the initial request.
|===

.3. Parse and Process the Payment Response (Decoded Payment Response)

[source,json]
----
{
  "api-id" : "up3-wpp",
  "parent-transaction-id" : "b675f63c-2df0-420f-a081-7c6b4967c992",
  "shipping" : {
    "last-name" : "Puente",
    "first-name" : "Tito",
    "address" : {
      "street1" : "C/ La Cochibamba 3",
      "city" : "Madrid",
      "postal-code" : "28001",
      "country" : "ES"
    }
  },
  "wallet" : {
    "account-id" : "ZNKTXUBNSQE2Y"
  },
  "payment-methods" : {
    "payment-method" : [ {
      "name" : "paypal"
    } ]
  },
  "transaction-id" : "ff0b8cf4-6fd3-4318-9e54-e8c035add938",
  "completion-time-stamp" : "2018-03-21T16:49:30",
  "requested-amount" : {
    "currency" : "EUR",
    "value" : 10.100000
  },
  "statuses" : {
    "status" : [ {
      "description" : "The resource was successfully created.",
      "provider-transaction-id" : "86M17436478175249",
      "severity" : "information",
      "code" : "201.0000"
    } ]
  },
  "instrument-country" : "DE",
  "request-id" : "2502cae8-91b6-4dac-8f60-6e9c6ef0cbe6",
  "merchant-account-id" : {
    "value" : "9abf05c1-c266-46ae-8eac-7f87ca97af28"
  },
  "transaction-state" : "success",
  "transaction-type" : "authorization",
  "account-holder" : {
    "last-name" : "Puente",
    "email" : "tito.puente@example.com",
    "first-name" : "Tito"
  }
}
----

[cols="30,5,5,5,55"]
|===
3+|Field (JSON) |Data Type |Description

3+|api-id |String |Identifier of the currently used API.
3+|parent-transaction-id |String |The ID of the transaction being referenced as a parent.
.6+|shipping 2+|last-name |String |The last name of the shipping address.
2+|first-name |String |The first name of the shipping address.
.4+|address |street1 |String |The first line of the shipping address street.
|city |String |The city of the shipping address.
|postal-code |String |The postal code/ZIP of the shipping address.
|country |String |The country ID part of the shipping address.
3+|account-id |String |Account holder's _PayPal_ Wallet identifier.
|payment-methods |payment-method |name |String |The name of the payment method used for the transaction.
3+|transaction-id |String |A unique identifier assigned to every transaction (by Wirecard). Used when searching for or referencing to it later.
3+|completion-time-stamp |YYYY-MM-DD-Thh:mm:ss a|The UTC/ISO time-stamp documents the time & date when the transaction was executed.

Format: YYYY-MM-DDThh:mm:ss (ISO).
.2+|requested-amount 2+|currency |String a|The currency of the requested/contested transaction amount.

Format: 3-character abbreviation according to ISO 4217.
2+|value |Numeric |The full amount that is requested/contested in a transaction. 2 decimals allowed.
.4+|statuses .4+|status |description |String |The description of the transaction status message.
|provider-transaction-id |String |A unique transaction identifier generated by the provider.
|severity |String a|The definition of the status message.

Possible values:

- information
- warning
- error

//-

|code |String |Status code of the status message.
3+|instrument-country |String |Payment origin country.
3+|request-id |String |A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later.
2+|merchant-account-id |value |String |A unique identifier assigned to every merchant account (by Wirecard).
3+|transaction-state |String a|The current transaction state.

Possible values:

- in-progress
- success
- failed

Typically, a transaction starts with state in-progress and finishes with state either success or failed. This information is returned in the response only.
3+|transaction-type |String |The requested transaction type.
.3+|account-holder 2+|last-name |String |The last name of the account holder.
2+|email |String |Account holder's email address.
2+|first-name |String |The first name of the account holder.
|===

[#WPP_PayPal_TransactionType_authorizationonly]
====== Transaction Type _authorization-only_

////
Is an authorization-only really possible with WPP?
If no, why do we describe it here? It is well described at API/PayPal,
where we refer to.
////

An authorization-only transaction creates a _PayPal_ billing agreement
between the merchant and account holder, obtaining authorization for
pre-approved payments. 

This transaction type requires specific fields in the request:

- ``periodic-type``, set to value _recurring_ or _installment_.
- ``sequence-type``, set to value _first_.
- The ``value`` field of ``requested-amount`` set to zero.

The periodic and sequence information indicates that this is the first
transaction in a series. The zero transaction amount is required because
this is only an agreement for future transactions, not a charge.
The ``provider-transaction-reference-id`` field returned in the response
contains the ID used to reference the billing agreement.

As with other referenceable transactions, you can use WPP only to create
this initial billing agreement. For all following transactions (i.e.
capturing the _authorization_), you need to use
our <<RestApi, REST API>>.

For a successful transaction:

. Create a payment session (initial request).
. Redirect the customer to the payment page (initial response URL).
. Highly recommended: Parse and process the payment response. +

We provide ready-made JSON examples for each step of this process. You
can find them below.

<<WPP_PayPal_TestCredentials, Endpoint>> for _PayPal_ transactions.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_PayPal_ payment form.

.Request Headers
[cols="20,80"]
|===
h| Authorization
| Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
h| Content-Type
| application/json
|===

.Optional fields

For a full list of optional fields you can use, see the REST API
<<API_PaymentMethods_PayPal, _PayPal_ specification>>.

For a full structure of a request (optional fields included), see the
<<WPP_PayPal_JSONNVPFields, JSON/NVP Field Reference>> section at the bottom.

.1. Create a Payment Session (Initial Request)

[source,json]
----
 {
    "payment": {
        "merchant-account-id": {
        "value": "9abf05c1-c266-46ae-8eac-7f87ca97af28"
        },
        "request-id": "{{$guid}}",
        "transaction-type": "authorization-only",
        "requested-amount": {
            "currency": "EUR",
            "value": "0"
        },
        "payment-methods": {
            "payment-method": [
                {
                "name": "paypal"
            }
        ]
        },
        "periodic": {
            "periodic-type": "recurring",
            "sequence-type": "first"
        }
    }
}
----

[cols="20e,10,10,10,5,45"]
|===
2+|Field (JSON) |Data Type |Required/Optional |Size |Description

|merchant-account-id |value |String |Required |36 |A unique identifier assigned
to every merchant account (by Wirecard).
2+|request-id |String |Required |64 a|A unique identifier assigned to every
request (by merchant). Used when searching for or referencing it later.
{{$guid}} serves as a placeholder for a random request-id.

Allowed characters: [a-z0-9-_]

2+|transaction-type |String |Required |36 |The requested transaction type.
.2+|requested-amount |value |Numeric |Required |18 a|The full amount that is
requested/contested in a transaction. 2 decimals allowed.

Use . (decimal point) as the separator.
|currency |String |Required |3 a|The currency of the requested/contested
transaction amount.

Format: 3-character abbreviation according to ISO 4217.
|payment-method |name |String |Optional |15 |The name of the
payment method used for the transaction. Set this value to ``paypal``.
.2+|periodic |periodic-type |String |Conditional |9 |Required for recurring
transactions. Indicates if (and how) payment occurs more than once.
|sequence-type |String |Conditional |9 |Required for recurring transactions.
Indicates the phase of a recurring transaction.
|===

.2. Redirect the Customer to the Payment Page (Initial Response URL)

[source,json]
----
{
"payment-redirect-url" : "https://wpp.wirecard.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7"
}
----

[cols=",,",]
|===
|Field (JSON) |Data Type |Description

|payment-redirect-url |String |The URL which redirects to the payment
form. Sent as a response to the initial request.
|===

.3. Parse and Process the Payment Response (Decoded Payment Response)

[source,json]
----
 {
  "api-id" : "up3-wpp",
  "parent-transaction-id" : "40760e14-e3d4-4ceb-92a5-747258589cc6",
  "shipping" : {
    "last-name" : "Puente",
    "first-name" : "Tito",
    "address" : {
      "street1" : "C/ La Cochibamba 3",
      "city" : "Madrid",
      "postal-code" : "28001",
      "country" : "ES"
    }
  },
  "wallet" : {
    "account-id" : "ZNKTXUBNSQE2Y"
  },
  "payment-methods" : {
    "payment-method" : [ {
      "name" : "paypal"
    } ]
  },
  "periodic" : {
    "periodic-type" : "recurring",
    "sequence-type" : "first"
  },
  "transaction-id" : "e3a29b72-9bb4-41de-ac57-438e4eff6c6b",
  "completion-time-stamp" : "2018-03-21T17:16:52",
  "requested-amount" : {
    "currency" : "EUR",
    "value" : 0.000000
  },
  "statuses" : {
    "status" : [ {
      "description" : "The resource was successfully created.",
      "severity" : "information",
      "code" : "201.0000"
    } ]
  },
  "provider-transaction-reference-id" : "B-9W832714HC860770E",
  "instrument-country" : "DE",
  "request-id" : "d6958186-8572-4795-863b-95b2337277de",
  "merchant-account-id" : {
    "value" : "9abf05c1-c266-46ae-8eac-7f87ca97af28"
  },
  "transaction-state" : "success",
  "transaction-type" : "authorization-only",
  "account-holder" : {
    "last-name" : "Puente",
    "email" : "tito.puente@example.com",
    "first-name" : "Tito"
  }
}
----


[cols="30,5,5,5,55"]
|===
3+|Field (JSON) |Data Type |Description

3+|api-id |String |Identifier of the currently used API.
3+|parent-transaction-id |String |The ID of the transaction being referenced as
a parent.
.6+|shipping 2+|last-name |String |The last name of the shipping address.
2+|first-name |String |The first name of the shipping address.
.4+|address |street1 |String |The first line of the shipping address street.
|city |String |The city of the shipping address.
|postal-code |String |The postal code/ZIP of the shipping address.
|country |String |The country ID part of the shipping address.
3+|account-id |String |Account holder's _PayPal_ wallet identifier.
|payment-methods |payment-method |name |String |The name of the payment method
used for the transaction.
.2+|periodic 2+|periodic-type |String |Indicates if (and how) payment occurs more
than once.
2+|sequence-type |String |Indicates the phase of a recurring transaction.
3+|transaction-id |String |A unique identifier assigned to every transaction
(by Wirecard). Used when searching for or referencing to it later.
3+|completion-time-stamp |YYYY-MM-DD-Thh:mm:ss a|The UTC/ISO time-stamp
documents the time & date when the transaction was executed.

Format: YYYY-MM-DDThh:mm:ss (ISO).
.2+|requested-amount 2+|currency |String a|The currency of the
requested/contested transaction amount.

Format: 3-character abbreviation according to ISO 4217.
2+|value |Numeric |The full amount that is requested/contested in a transaction. 2 decimals allowed.
.4+|statuses .4+|status |description |String |The description of the
transaction status message.
|provider-transaction-id |String |A unique transaction identifier generated
by the provider.
|severity |String a|The definition of the status message.

Possible values:

- information
- warning
- error

//-

|code |String |Status code of the status message.
3+|instrument-country |String |Payment origin country.
3+|request-id |String |A unique identifier assigned to every request
(by merchant). Used when searching for or referencing it later.
2+|merchant-account-id |value |String |A unique identifier assigned to every
merchant account (by Wirecard).
3+|transaction-state |String a|The current transaction state.

Possible values:

- in-progress
- success
- failed

Typically, a transaction starts with state in-progress and finishes with state
either success or failed. This information is returned in the response only.
3+|transaction-type |String |The requested transaction type.
.3+|account-holder 2+|last-name |String |The last name of the account holder.
2+|email |String |Account holder's email address.
2+|first-name |String |The first name of the account holder.
|===

[#WPP_PayPal_TransactionType_order]
====== Transaction Type _order_

_order_ is a _PayPal_-specific transaction type, which indicates that the
buyer has consented to the purchase but does not place the funds on
hold. For detailed information on how it works, see its 
<<API_PayPal_Transactions_TransactionTypes_PayPalSpecific_order, REST API specification>>.

After merchant creates an order, they can place multiple authorizations
upon it to place funds on hold until ready to capture. This transaction
is primarily for situations where items are not available for shipment
immediately after the order is placed, e.g.:

- when a merchant ships items from multiple distribution centers and
needs separate authorizations for each shipment,
- delayed shipping on items that are not in stock.

As with other referenceable transaction types, you can use WPP only to
create an order transaction. To register an additional authorization to
capture it, you need to use our link:#PayPalwithWPP-Follow-up[REST
API]. 

For a successful transaction:

. Create a payment session (initial request).
. Redirect the customer to the payment page (initial response URL).
. Highly recommended: Parse and process the payment response. +

We provide ready-made JSON examples for each step of this process. You
can find them below. 

<<WPP_PayPal_TestCredentials, Endpoint>> for _PayPal_ transactions.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_PayPal_ payment form.

After the merchant creates an _order_, they can place multiple
authorizations upon it to place funds on hold until ready to _capture_.

Merchants often use this technique to accept orders for items that are
not available for shipment when the order is placed. For example, when a
merchant ships items from multiple distribution centers and needs
separate _authorizations_ for each shipment. Another example would be
delayed shipping on items that are not in stock.

.Request Headers
[cols="20,80"]
|===
h| Authorization
| Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
h| Content-Type
| application/json
|===

.Optional fields

For a full list of optional fields you can use, see the REST API
<<API_PaymentMethods_PayPal, _PayPal_ specification>>.

For a full structure of a request (optional fields included), see the
<<WPP_PayPal_JSONNVPFields, JSON/NVP Field Reference>> section at the bottom.

.1. Create a Payment Session (Initial Request)

[source,json]
----
{
    "payment": {
        "merchant-account-id": {
            "value": "9abf05c1-c266-46ae-8eac-7f87ca97af28"
            },
        "request-id": "{{$guid}}",
        "transaction-type": "order",
        "requested-amount": {
            "currency": "EUR",
            "value": "1.00"
        },
        "payment-methods": {
            "payment-method": [
                {
                "name": "paypal"
            }
        ]
        }
    }
}
----

[cols="20e,10,10,10,5,45"]
|===
2+|Field (JSON) |Data Type |Required/Optional |Size |Description

|merchant-account-id e|value |String |Required |36 |A unique identifier
assigned to every merchant account (by Wirecard).
2+|request-id |String |Required |64 a|A unique identifier assigned to every
request (by merchant). Used when searching for or referencing it later.
``{{$guid}}`` serves as a placeholder for a random ``request-id``.

Allowed characters:  [a-z0-9-_]
2+|transaction-type |String |Required |36 |The requested transaction type.
.2+|requested-amount e|value |Numeric |Required |18 a|The full amount that is
requested/contested in a transaction. 2 decimal digits allowed.

Use . (decimal point) as the separator.

|currency |String |Required |3 a|The currency of the requested/contested
transaction amount.

Format: 3-character abbreviation according to ISO 4217.
|payment-method e|name |String |Optional |15 |The name of the payment method
used. Set this value to _PayPal_.
|===

.2. Redirect the Customer to the Payment Page (Initial Response URL)

[source,json]
----
{
"payment-redirect-url" : "https://wpp.wirecard.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7"
}
----

[cols=",,",]
|===
|Field (JSON) |Data Type |Description

|payment-redirect-url |String |The URL which redirects to the payment
form. Sent as a response to the initial request.
|===

.3. Parse and Process the Payment Response (Decoded Payment Response)

[source,json]
----
 {
  "api-id" : "up3-wpp",
  "parent-transaction-id" : "6998700b-a573-4a39-b8e0-c0da1008c468",
  "shipping" : {
    "last-name" : "Puente",
    "first-name" : "Tito",
    "address" : {
      "street1" : "C/ La Cochibamba 3",
      "city" : "Madrid",
      "postal-code" : "28001",
      "country" : "ES"
    }
  },
  "wallet" : {
    "account-id" : "ZNKTXUBNSQE2Y"
  },
  "payment-methods" : {
    "payment-method" : [ {
      "name" : "paypal"
    } ]
  },
  "transaction-id" : "59b94534-edd3-4668-9c9d-567be60e4622",
  "completion-time-stamp" : "2018-03-21T17:24:00",
  "requested-amount" : {
    "currency" : "EUR",
    "value" : 1.000000
  },
  "statuses" : {
    "status" : [ {
      "description" : "The resource was successfully created.",
      "provider-transaction-id" : "O-70W17875FY9058845",
      "severity" : "information",
      "code" : "201.0000"
    } ]
  },
  "custom-fields" : { },
  "instrument-country" : "DE",
  "request-id" : "649e2792-5af4-45c8-909c-7333b0a8f43c",
  "merchant-account-id" : {
    "value" : "9abf05c1-c266-46ae-8eac-7f87ca97af28"
  },
  "transaction-state" : "success",
  "transaction-type" : "order",
  "account-holder" : {
    "last-name" : "Puente",
    "email" : "tito.puente@example.com",
    "first-name" : "Tito"
  }
}
----


[cols="30,5,5,5,55"]
|===
3+|Field (JSON) |Data Type |Description

3+|api-id |String |Identifier of the currently used API.
3+|parent-transaction-id |String |The ID of the transaction being referenced
as a parent.
.6+|shipping 2+|last-name |String |The last name of the shipping address.
2+|first-name |String |The first name of the shipping address.
.4+|address |street1 |String |The first line of the shipping address street.
|city |String |The city of the shipping address.
|postal-code |String |The postal code/ZIP of the shipping address.
|country |String |The country ID part of the shipping address.
|wallet 2+|account-id |String |Account holder's _PayPal_ wallet identifier.
|payment-methods |payment-method |name |String |The name of the payment method
used for the transaction.
3+|transaction-id |String |A unique identifier assigned to every transaction
(by Wirecard). Used when searching for or referencing to it later.
3+|completion-time-stamp |YYYY-MM-DD-Thh:mm:ss a|The UTC/ISO time-stamp
documents the time & date when the transaction was executed.

Format: YYYY-MM-DDThh:mm:ss (ISO).
.2+|requested-amount 2+|currency |String a|The currency of the
requested/contested transaction amount.

Format: 3-character abbreviation according to ISO 4217.
2+|value |Numeric |The full amount that is requested/contested in a
transaction. 2 decimals allowed.
.4+|statuses .4+|status |description |String |The description of the
transaction status message.
|provider-transaction-id |String |A unique transaction identifier generated
by the provider.
|severity |String a|The definition of the status message.

Possible values:

- information
- warning
- error

//-

|code |String |Status code of the status message.
3+|instrument-country |String |Payment origin country.
3+|request-id |String |A unique identifier assigned to every request
(by merchant). Used when searching for or referencing it later.
2+|merchant-account-id |value |String |A unique identifier assigned to every
merchant account (by Wirecard).
3+|transaction-state |String a|The current transaction state.

Possible values:

- in-progress
- success
- failed

Typically, a transaction starts with state in-progress and finishes with state either success or failed. This information is returned in the response only.
3+|transaction-type |String |The requested transaction type.
.3+|account-holder 2+|last-name |String |The last name of the account holder.
2+|email |String |Account holder's email address.
2+|first-name |String |The first name of the account holder.
|===

[#WPP_PayPal_PostProcessing]
====== Post-Processing Operations

WPP is best used to deal with one-off payments (e.g. regular,
independent _debit_ transactions) or the initial transaction in a chain of
them (e.g. a first _authorization_ in a chain of recurring transactions).
However, when it comes to referencing a transaction for any kind of
post-processing operation — such as a refund of one of your _debit_ transactions 
— use our <<RestApi, REST API>>﻿﻿ directly.

WARNING: Check the REST API
<<API_PaymentMethods_PayPal, _PayPal_ specification>> for details on
_PayPal_ specific post processing operations.

There are multiple post processing operations available for _PayPal_:

- _capture_ operations for both _authorization_ and _authorization-only_
- recurring transactions
- void transactions
- refunds

For examples and more information, see the REST
API <<API_PaymentMethods_PayPal, _PayPal_ specification>>.

[#WPP_PayPal_JSONNVPFields]
====== JSON/NVP Field Reference

Here you can:

- find the NVP equivalents for JSON fields (for migrating merchants),
- see the structure of a full request (optional fields included).

[#WPP_PayPal_JSONNVPFields_request]
.JSON Structure for _PayPal_ Requests

[source,json]
----
{
"payment": {
 "merchant-account-id": {
      "value": "string"
    },
 "request-id": "string",
 "transaction-type": "string",
 "requested-amount": {
      "currency": "string",
      "value": 0
    },
 "payment-methods": {
      "payment-method": [
        {
          "name": "string"
        }
      ]
    },
 "account-holder": {
      "address": {
        "city": "string",
        "country": "string",
        "postal-code": "string",
        "state": "string",
        "street1": "string",
        "street2": "string",
      },
      "email": "string",
      "first-name": "string",
      "last-name": "string",
      "phone": "string"
    },
 "shipping": {
      "address": {
        "city": "string",
        "country": "string",
        "postal-code": "string",
        "state": "string",
        "street1": "string",
        "street2": "string"
      },
      "first-name": "string",
      "last-name": "string",
      "phone": "string"
    },
 "descriptor": "string",
 "order-number": "string",
 "periodic": {
      "periodic-type": "string",
      "sequence-type": "string"
    },
 "success-redirect-url": "string",
 "fail-redirect-url": "string",
 "cancel-redirect-url": "string"
}
}
----

[cols=",,",]
|===
|Field (NVP) |Field (JSON) |JSON Parent

|merchant_account_id |value |merchant-account-id ({ })
|request_id |request-id |payment ({ })
|transaction_type |transaction-type |payment ({ })
|requested_amount_currency |currency |requested-amount ({ })
|requested_amount |value |requested-amount ({ })
|payment_method |payment-method ([ ])/name |payment-methods ({ })
|city |address ({ })/ city |account-holder ({ })
|country |address ({ })/ country |account-holder ({ })
|postal_code |address ({ })/ postal-code |account-holder ({ })
|state |address ({ })/ state |account-holder ({ })
|street1 |address ({ })/ street1 |account-holder ({ })
|street2 |address ({ })/ street2 |account-holder ({ })
|email |email |account-holder ({ })
|first_name |first-name |account-holder ({ })
|last_name |last-name |account-holder ({ })
|phone |phone |account-holder ({ })
|shipping_city |address ({ })/ city |shipping ({ })
|shipping_country |address ({ })/ country |shipping ({ })
|shipping_postal_code |address ({ })/ postal-code |shipping ({ })
|shipping_state |address ({ })/ state |shipping ({ })
|shipping_street1 |address ({ })/ street1 |shipping ({ })
|shipping_street2 |address ({ })/ street2 |shipping ({ })
|shipping_first_name |first-name |shipping ({ })
|shipping_last_name |last-name |shipping ({ })
|shipping_phone |phone |shipping ({ })
|descriptor |descriptor |payment ({ })
|order_number |order-number |payment ({ })
|periodic_type |periodic-type |periodic ({ })
|sequence_type |sequence-type |periodic ({ })
|success_redirect_url |success-redirect-url |payment ({ })
|fail_redirect_url |fail-redirect-url |payment ({ })
|cancel_redirect_url |cancel-redirect-url |payment ({ })
|===

[#WPP_PayPal_JSONNVPField_response]
.JSON Structure for _PayPal_ Responses

[source,json]
----
{
"payment": {
 "api-id": "string",
 "wallet": {
      "account-id": "string"
    },
 "transaction-id": "string",
 "completion-time-stamp": "2017-11-21T09:38:57.645Z",
 "statuses": {
      "status": [
        {
          "code": "string",
          "description": "string",
          "severity": "string"
        }
      ]
    },
 "provider-transaction-reference-id": "string",
 "instrument-country": "string",
 "transaction-state": "string"
    }
}
----

[cols=",,",]
|===
|Field (NVP) |Field (JSON) |JSON Parent

|api_id |api-id |payment ({ })
|wallet_account_id |account-id |wallet ({ })
|transaction_id |transaction-id |payment ({ })
|completion_time_stamp |completion-time-stamp |payment ({ })
|status_code_n |status ([ {} ])/ code |statuses ({ })
|provider_transaction_id_n |status ([ {} ])/ provider-transaction-id
|statuses ({ })
|status_description_n |status ([ {} ])/ description |statuses ({ })
|status_severity_n |status ([ {} ])/ severity |statuses ({ })
|provider_transaction_reference_id |provider-transaction-reference-id
|payment ({ })
|instrument_country |instrument-country |payment ({ })
|transaction_state |transaction-state |payment ({ })
|===

//-
