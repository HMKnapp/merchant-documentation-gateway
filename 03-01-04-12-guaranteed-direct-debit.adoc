[#PPv2_GuaranteedDirectDebit]
===== Guaranteed Direct Debit by Wirecard

[#PPv2_GuaranteedDirectDebit_General]
====== General Information

This is a reference page for _Guaranteed Direct Debit_. Here you find all the information
necessary for integrating this payment method into your Hosted and Embedded Payment Page.

.Are you unfamiliar with {payment-page-v2} ({payment-page-v2-abbr})?

NOTE: Visit one of the integration guides
(<<PaymentPageSolutions_PPv2_HPP_Integration, Hosted>>,
<<PaymentPageSolutions_PPv2_EPP_Integration, Embedded>>) for a quick explanation and
a step-by-step guide before continuing.

All <<PPv2, {payment-page-v2-abbr}>> integrations share a
<<PPSolutions_PPv2_Workflow, common process flow>> for creating payments.

Below, you can find example requests for the available transaction type <<PPv2_GuaranteedDirectDebit_TransactionType_authorization,_authorization_>>, including field lists with short descriptions.

These requests are designed for the testing environment and do not
use real information.

NOTE: For production, you need to use production credentials. For details
contact <<ContactUs, merchant support>>.

All given requests return successful responses.

For more details on the ``redirect-url``, see the <<PPSolutions_PPv2_ConfigureRedirects, Configuring Redirects and IPNs for {payment-page-v2-abbr}>> section.

For response verification examples, see
the <<PPSolutions_PPv2_PPv2Security, {payment-page-v2-abbr} Security>> section.


[#PPv2_GuaranteedDirectDebit_About]
====== About _Guaranteed Direct Debit_

Guaranteed Direct Debit is a payment method through which money is transferred securely from the consumer account to the merchant. For this purpose,  the transaction is authorized before the money is debited. Guaranteed Direct Debit makes processing simple and reduces the rate of canceled purchases.


[#PPv2_GuaranteedDirectDebit_TestCredentials]
====== Test Credentials
Test credentials for the transaction type <<PPv2_GuaranteedDirectDebit_TransactionType_authorization,_authorization_>>.

[cols="35h,65"]
|===
| URI (Endpoint)             | ``https://wpp-test.wirecard.com/api/payment/register``
| Merchant Account ID (MAID) | 3cfb0fb7-59e2-4d92-847f-37121d633844
| Username                   | 16390-testing
| Password                   | 3!3013=D3fD8X7
| Secret Key (used for response verification) | cf0b29fc-a6ab-474d-b6be-92e9596e9107
|===

[#PPv2_GuaranteedDirectDebit_TestCredentials_RequestValues]
.Guaranteed Direct Debit - Specific Request Values

[cols="35h,65"]
|===
| IBAN         | DE42512308000000060004
| BIC          | WIREDEMMXXX
| Bank         | Test Bank
|===

[#PPv2_GuaranteedDirectDebit_TransactionType_authorization]
====== Transaction Type _authorization_

An _authorization_ transaction performs a creditworthiness check at the moment
when the consumer makes an order. All order items must be listed for the shopping
basket. The authorization amount must match the value of the items in the basket.

For a successful _authorization_ transaction:

. Create an authorization session (initial authorization request).
. Redirect the consumer to the payment page (initial response URL).
. Highly recommended: parse and process the payment response.

//-

<<PPv2_GuaranteedDirectDebit_TestCredentials, Endpoint>> for
_Guaranteed Direct Debit_ payments.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_Guaranteed Direct Debit_ payment form.

.Request Headers

[cols="20,80"]
|===
h| Authorization
| Basic MTYzOTAtdGVzdGluZzozITMwMTM9RDNmRDhYNw==
h| Content-Type
| application/json
|===

.1. Create a Payment Session (Initial Request)

[source,json]
----
include::samples/json/PPv2_GuaranteedDirectDebit_TransactionTypeAuthorization_1CreateAPaymentSessionInitialRequest.json[]
----

[%autowidth]
|===
2+|Field (JSON) |Data Type |Cardinality |Size |Description

m|merchant-account-id
m|value
|String
|Required
|36
|A unique identifier assigned to every merchant account (by {payment-provider}).

2+m|request-id
|String
|Required
|64
|A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. ``{{$guid}}`` serves as a placeholder for a random request-id. +
Allowed characters: `[a-z0-9-_ ]`

2+m|transaction-type
|String
|Required
|36
a|The requested transaction type. Available transaction types for *Guaranteed Direct Debit*:

- `authorization`

//-

.2+m|requested-amount
m|currency
|String
|Required
|3
|The currency of the requested/contested transaction amount. For *Guaranteed Direct Debit* payments, the currency must be set to ``EUR``.
Format: 3-character abbreviation according to ISO 4217.

m|value
|Numeric
|Required
|11
|The full amount that is requested/contested in a transaction. 2 decimal places allowed. +
Use `.` (decimal point) as the separator.

m|payment-methods
m|payment-method/name
|String
|Optional
|15
|The name of the payment method used. Set this value to ``guaranteeddirectdebit``.

.5+m|account-holder
m|first-name
|String
|Required 
|32
|The first name of the consumer.

m|last-name
|String
|Required 
|32
|The last name of the consumer.

m|email
|String
|Required 
|64
|The email address of the consumer.

m|phone
|String
|Required 
|32
|The phone number of the consumer.

m|date-of-birth
|String
|Required 
|n/a
|The date of birth of the consumer.

.5+m|account-holder/address
m|street1
|String
|
|128
|The first line of the street address of the consumer.

m|state
|String
|
|32
|The state or province of the address of the consumer.

m|country
|Token
|
|3
|The Country Id of the address of the consumer.

m|city
|String
|
|32
|The city of the address of the consumer.

m|postal-code
|String
|
|16
|The postal code or ZIP of the address of the consumer.

2+m|ip-address
|String
|
|45
a|The internet protocol address of the consumer as recorded by the entity receiving the transaction attempt from the consumer. 

2+m|order-number
|String
|Required 
|64
a|String provided by the merchant, to store the 'Order Number' for the transaction.

.7+m|order-items/order-item
m|name
|Alphanumeric
|Required 
|
a|Name of the item in the basket.

m|description
|String 
|Required
|
a|Description of the item in the basket.

m|article-number
|String
|Required
|
a|EAN or other article identifier for merchant.

m|amount/currency
|String
|Required
|3
|The currency of the item price per unit.

m|amount/value
|Numeric
|Required
|
|The item price per unit.

m|tax-rate
|Numeric
|Required
|
a|The item tax rate per unit.

m|quantity
|Numeric
|Required
|
a|The total count of items in the order.

2+m|locale
|String
|Optional
|6
|A set of parameters that defines the user’s language, country and any special
variant preferences that the user wants to see in their user interface.
Typically used in conjunction with Hosted Payment Page.

2+m|country
|Token
|
|3
|The Country Id of the address of the consumer.

2+m|creditor-id
|String
|Optional
|256
|The creditor ID of the merchant, allowing processing of Guaranteed Direct Debit transactions.

.2+m|mandate
m|mandate-id
|String
|Optional
|35
|The mandate Id for the mandate generated between the consumer and the merchant allowing
the merchant to debit the consumer’s bank account.

m|signed-date
|String
|Optional
|19
|The date that the mandate was signed.

2+m|success-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after a successful payment, e.g. ``\https://{pp-redirect-url-success}``.

2+m|cancel-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``.

2+m|fail-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after an unsuccessful payment, e.g. ``\https://{pp-redirect-url-error}``.
|===


.2. Redirect the Consumer to the Payment Page (Sample Response URL)

The response to this initial _authorization_ request is the
``payment-redirect-url``.

Consumers are redirected to the payment form. There they enter their
data and submit the form to confirm the payment. A payment can be:

- successful (``transaction-state: success``),
- failed (``transaction-state: failed``),
- canceled. The consumer canceled the payment before/after submission
(``transaction-state: failed``).

//-

The transaction result is the value of ``transaction-state`` in the
payment response. More details (including the status code) can also be
found in the payment response in the ``statuses`` object. Canceled
payments are returned as _failed_, but the
``status description`` indicates it was canceled.

In any case (unless the consumer cancels the transaction on a 3rd party
provider page), a base64 encoded response containing payment information
is sent to the configured redirection URL. See
<<PPSolutions_WPP_ConfigureRedirects, Configuring Redirects and IPNs for WPP>>
for more details on redirection targets after payment & transaction status
notifications.

You can find a decoded payment response example below.

.3. Parse and Process the _authorization_ Response (Decoded Payment Response)

[source,json]
----
include::samples/json/PPv2_GuaranteedDirectDebit_TransactionTypeAuthorization_DecodedPaymentResponse.json[]
----

[%autowidth]
|===
2+|Field (JSON) |Data Type |Cardinality |Size |Description

2+m|country
|Token
|
|3
|The Country Id of the address of the consumer.

2+m|locale
|String
|Optional
|6
|A set of parameters that defines the user’s language, country and any special variant preferences that the user wants to see in their user interface. Typically used in conjunction with Hosted Payment Page.

.2+m|payment-methods/payment-method
m|payload
|String
|
|
|The value of ``payload`` depends on the payment method. +

m|name
|String
|Optional
|15
|The name of the payment method used. Set this value to ``guaranteeddirectdebit``.

2+m|cancel-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``.

2+m|fail-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after an unsuccessful payment, e.g. ``\https://{pp-redirect-url-error}``.

2+m|ip-address
|String
|Optional
|45
a|The internet protocol address of the consumer as recorded by the entity receiving the transaction attempt from the consumer.

.2+m|custom-fields/custom-field
m|field-name
|String
|Optional
|36
|The merchant defined name of the custom field.

m|field-value
|String
|Optional
|36
|The merchant defined name of the custom field.

2+m|transaction-id
|String
|Required
|36
a|A unique identifier assigned to every transaction. This information is
returned in the response only.

2+m|request-id
|String
|Required
|64
|A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. ``{{$guid}}`` serves as a placeholder for a random request-id. +
Allowed characters: `[a-z0-9-_ ]`

2+m|transaction-type
|String
|Required
|36
a|The requested transaction type. Available transaction types for *Guaranteed Direct Debit*:

- `authorization`

//-

2+m|transaction-state
|Token
|Required
|n/a
a|The current status of a transaction. Typically, a transaction starts with an "in-progress"
state and finishes with either the "success" or the "failed" state. This information is returned in the
response only.

2+m|completion-time-stamp
|String
|Required
|n/a
|The date and time when a transaction state changed to either "success" or "failed", in GMT.
This information is returned in the response only.

.2+m|requested-amount
m|currency
|String
|Required
|3
|The currency of the requested/contested transaction amount. For *Guaranteed Direct Debit* payments,
the currency must be set to ``EUR``. +
The format is a 3-character abbreviation according to ISO 4217.

m|value
|Numeric
|Required
|11
|The full amount that is requested/contested in a transaction. 2 decimal places allowed. +
Use `.` (decimal point) as the separator.

.3+m|statuses/status
m|description
|String
|Required
|512
|Text used to describe the transaction status. This information is returned in the response only.

m|severity
|Token
|Required
|20
|The severity of the transaction, can be information, warning, or error. This information
is returned in the response only.

m|code
|String
|Required
|12
|The status of a transaction. This is primarily used in conjunction with the transaction state
to determine the exact details of the status of the transaction. This information is returned in
the response only.

2+m|success-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after a successful payment,
e.g. ``\https://{pp-redirect-url-success}``.

.5+m|account-holder
m|first-name
|String
|Optional
|32
|The first name of the consumer.

m|email
|String
|Optional
|64
|The email address of the consumer.

m|phone
|String
|Optional
|32
|The phone number of the consumer.

m|last-name
|String
|Required
|32
|The last name of the consumer.

m|account-info
|
|
|
|

.5+m|account-holder/address
m|country
|Token
|Optional
|3
|The Country Id of the address of the consumer.

m|street1
|String
|Optional
|128
|The first line of the street address of the consumer.

m|city
|String
|Optional
|32
|The city of the address of the consumer.

m|postal-code
|String
|Optional
|16
|The postal code or ZIP of the address of the consumer.

m|state
|String
|Optional
|32
|The state or province of the address of the consumer.

.3+m|bank-account
m|bic
|String
|Optional
|15
|The bank identifier code (BIC) in the bank transfer.
Allowed characters: ([a-zA-Z]{4}[a-zA-Z]{2}[a-zA-Z0-9]{2}([a-zA-Z0-9]{3}).

m|bank-name
|String
|Optional
|100
|The name of the consumer’s bank

m|iban
|String
|Optional
|34
|The international bank account number (IBAN) required in a bank transfer. It is an international standard for identifying bank accounts across national borders. The current standard is ISO 13616:2007, which indicates SWIFT as the formal registrar.
Allowed characters: [a-zA-Z]{2}[0-9]{2}[a-zA-Z0-9]{4}[0-9]{7}([a-zA-Z0-9]?){0,16}.

2+m|order-number
|String
|Required
|64
a|String provided by the merchant, to store the 'Order Number' for the transaction.

m|merchant-account-id
m|value
|String
|Required
|36
|A unique identifier assigned to every merchant account.

.7+m|order-items/order-item
m|description
|String 
|Required
|
a|Description of the item in the basket.

m|article-number
|String
|Required
|
a|EAN or other article identifier for merchant.

m|tax-rate
|Numeric
|Required
|
a|The item tax rate per unit.

m|quantity
|Numeric
|Required
|
a|The total count of items in the order.

m|amount/currency
|String
|Required
|3
|The currency of the item price per unit.

m|amount/value
|Numeric
|Required
|
|The item price per unit.

m|name
|Alphanumeric
|Required
|
a|Name of the item in the basket.

.2+m|mandate
m|signed-date
|String
|Optional
|19
|The date that the mandate was signed.

m|mandate-id
|String
|Optional
|35
|The mandate Id for the mandate generated between the consumer and the merchant allowing
the merchant to debit the consumer’s bank account.

2+m|creditor-id
|String
|Optional
|256
|The creditor ID of the merchant, allowing processing of Guaranteed Direct Debit transactions.

2+m|api-id
|Token
|Optional
|36
|A unique identifier assigned to every API.

m|device
m|fingerprint
|String
|Optional
|4096
|A device fingerprint is information about a remote computing device, collected by the merchant
for identification purposes. Fingerprints can be used to fully or partially
identify individual users or devices even when cookies are turned off.

2+m|descriptor
|String
|Optional
|64
|The description of the transaction displayed on the account holder’s statement.
In the case of a credit card statement, it can be dynamically set per transaction.
It is only supported by some acquirers.

|===
