[#PPv2_GuaranteedDirectDebit]
===== Guaranteed Direct Debit by Wirecard

[#PPv2_GuaranteedDirectDebit_General]
====== General Information

This is a reference page for _Guaranteed Direct Debit_. Here you find all the information
necessary for integrating this payment method into your Hosted and Embedded Payment Page.

.Are you unfamiliar with {payment-page-v2} ({payment-page-v2-abbr})?

NOTE: Visit one of the integration guides
(<<PaymentPageSolutions_PPv2_HPP_Integration, Hosted>>,
<<PaymentPageSolutions_PPv2_EPP_Integration, Embedded>>) for a quick explanation and
a step-by-step guide before continuing.

All <<PPv2, {payment-page-v2-abbr}>> integrations share a
<<PPSolutions_PPv2_Workflow, common process flow>>﻿ for creating payments.

Below, you find example requests for the available transaction type <<PPv2_GuaranteedDirectDebit_TransactionType_authorization, _authorization_>>,
including field lists with short descriptions.

These requests are designed for the testing environment and do not
use real information. 

NOTE: For production, you need to use production credentials. For details
contact <<ContactUs, merchant support>>.

All given requests return successful responses.

For more details on the ``redirect-url``, see the 
<<PPSolutions_PPv2_ConfigureRedirects, Configuring Redirects and IPNs for {payment-page-v2-abbr}>>﻿﻿ 
section.

For response verification examples, see
the <<PPSolutions_PPv2_PPv2Security, {payment-page-v2-abbr} Security>>﻿ section.


[#PPv2_GuaranteedDirectDebit_About]
====== About _Guaranteed Direct Debit_

image::images/03-01-04-10-sepa-direct-debit/sepadirectdebit_logo.png[SEPA Direct Debit logo, 200]

////
The Single Euro Payments Area (SEPA) is an initiative of the European banking
industry that makes electronic payments across the euro area as easy as domestic
payments within one country. The payments are processed under the same
basic conditions, rights, and obligations regardless of their location.

Guaranteed Direct Debit is a payment method which authorizes a transaction
before it transfers money from the consumer account to the merchant.
////

[#PPv2_GuaranteedDirectDebit_TestCredentials]
====== Test Credentials
Test credentials for the transaction type <<PPv2_GuaranteedDirectDebit_TransactionType_authorization, _authorization_>>.

[cols="35h,65"]
|===
| URI (Endpoint)             | ``https://wpp-test.wirecard.com/api/payment/register``
| Merchant Account ID (MAID) | 3cfb0fb7-59e2-4d92-847f-37121d633844
| Username                   | 16390-testing
| Password                   | 3!3013=D3fD8X7
| Secret Key (used for response verification) | cf0b29fc-a6ab-474d-b6be-92e9596e9107
|===

////
[#PPv2_GuaranteedDirectDebit_TestCredentials_RequestValues]
.Guaranteed Direct Debit - specific Request Values

[cols="35h,65"]
|===
| Creditor ID           | DE98ZZZ09999999999
|===

image::images/03-01-04-12-guaranteed-direct-debit/GuaranteedDirectDebit_testing.jpg[Guaranteed Direct Debit testing]
////

[#PPv2_GuaranteedDirectDebit_TransactionType_authorization]
====== Transaction Type _authorization_

An _authorization_ transaction performs a creditworthiness check at the moment
when the consumer makes an order. All order items must be listed for the shopping
basket. The authorization amount must match the value of the items in the basket.

For a successful _authorization_ transaction:

. Create an authorization session (initial authorization request).
. Redirect the consumer to the payment page (initial response URL).
. Highly recommended: Parse and process the payment response.

//-

<<PPv2_GuaranteedDirectDebit_TestCredentials, Endpoint>> for
_Guaranteed Direct Debit_ payments.

.Initial Request

The initial request creates the payment session. If it's
successful, you receive a URL as a response which redirects to the
_Guaranteed Direct Debit_ payment form.

.Request Headers

[cols="20,80"]
|===
h| Authorization
| Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
h| Content-Type
| application/json
|===

.1. Create a Payment Session (Initial Request)

[source,json]
----
include::samples/json/PPv2_GuaranteedDirectDebit_TransactionTypeAuthorization_1CreateAPaymentSessionInitialRequest.json[]
----

[%autowidth, cols="m,,,,,,"]
|===
3+|Field (JSON) |Data Type |Cardinality |Size |Description

2+|merchant-account-id
m|value
|String
|Required
|36
|A unique identifier assigned to every merchant account (by {payment-provider}).

3+|request-id
|String
|Required
|64
|A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. ``{{$guid}}`` serves as a placeholder for a random request-id. +
Allowed characters: `[a-z0-9-_ ]`

3+|transaction-type
|String
|Required
|36
a|The requested transaction type. Available transaction types for *Guaranteed Direct Debit*:

- `authorization`

//-

.2+|requested-amount
2+m|currency
|String
|Required
|3
|The currency of the requested/contested transaction amount. For *Guaranteed Direct Debit* payments, the currency must be set to ``EUR``.
Format: 3-character abbreviation according to ISO 4217.

2+m|value
|Numeric
|Required
|11
|The full amount that is requested/contested in a transaction. 2 decimal places allowed. +
Use `.` (decimal point) as the separator.

|payment-methods
m|payment-method
m|name
|String
|Optional
|15
|The name of the payment method used. Set this value to ``guaranteeddirectdebit``.

.6+|account-holder
2+m|first-name
|String
|
|32
|The first name of the consumer.

2+m|last-name
|String
|
|32
|The last name of the consumer.

2+m|email
|String
|
|64
|The email address of the consumer.

2+m|phone
|String
|
|32
|The phone number of the consumer.

2+m|date-of-birth
|String
|
|n/a
|The date of birth of the consumer.

2+m|address
m|street1
|String
|
|128
|The first line of the street address of the consumer.

m|state
|String
|
|32
|The state or province of the address of the consumer.

m|country
|Token
|
|3
|The Country Id of the address of the consumer.

m|city
|String
|
|32
|The city of the address of the consumer.

m|postal-code
|String
|
|16
|The postal code or ZIP of the address of the consumer.

3+|ip-address
|String
|
|45
a|The internet protocol address of the consumer as recorded by the entity receiving the transaction attempt from the consumer.

3+|order-number
|String
|
|64
a|String provided by the merchant, to store the 'Order Number' for the transaction.

3+|order-items
.6+|order-item
m|name
|Alphanumeric
|
|
a|Name of the item in the basket.

m|description
|
|
|
a|The ...

m|article-number
|Alphanumeric
|
|
a|EAN or other article identifier for merchant.

.2+|amount
2+m|currency
|String
|Required
|3
|The currency of the item price per unit.

2+m|value
|Number
|
|
|The item price per unit.

m|tax-rate
|Number
|
|
a|The item tax rate per unit.

m|quantity
|Number
|
|
a|The total count of items in the order.

3+|locale
|String
|Optional
|6
|A set of parameters that defines the user’s language, country and any special
variant preferences that the user wants to see in their user interface.
Typically used in conjunction with Hosted Payment Page.

3+|country
|Token
|
|3
|The Country Id of the address of the consumer.

3+|creditor-id
|String
|Optional
|256
|The creditor ID of the merchant, allowing him to process Guaranteed Direct Debit transactions.

.2+|mandate
2+m|mandate-id
|String
|Optional
|35
|The mandate Id for the mandate generated between the consumer and the merchant allowing
the merchant to debit the consumer’s bank account.

2+m|signed-date
|String
|Optional
|19
|The date that the mandate was signed.

3+|success-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after a successful payment, e.g. ``\https://{pp-redirect-url-success}``.

3+|cancel-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``.

3+|fail-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after an unsuccessful payment, e.g. ``\https://{pp-redirect-url-error}``.
|===


.2. Redirect the Consumer to the Payment Page (Sample Response URL)

The response to this initial _authorization_ request is the
``payment-redirect-url``.

.3. Parse and Process the _authorization_ Response (Decoded Payment Response)

[source,json]
----
include::samples/json/PPv2_GuaranteedDirectDebit_TransactionTypeAuthorization_DecodedPaymentResponse.json[]
----

[%autowidth, cols="m,,,,,,"]
|===
3+|Field (JSON) |Data Type |Cardinality |Size |Description

2+|merchant-account-id
m|value
|String
|Required
|36
|A unique identifier assigned to every merchant account.

3+|request-id
|String
|Required
|64
|A unique identifier assigned to every request (by merchant). Used when searching for or referencing it later. ``{{$guid}}`` serves as a placeholder for a random request-id. +
Allowed characters: `[a-z0-9-_ ]`

3+|transaction-type
|String
|Required
|36
a|The requested transaction type. Available transaction types for *Guaranteed Direct Debit*:

- `authorization`

//-

.2+|requested-amount
2+m|currency
|String
|Required
|3
|The currency of the requested/contested transaction amount. For *Guaranteed Direct Debit* payments, the currency must be set to ``EUR``.
Format: 3-character abbreviation according to ISO 4217.

2+m|value
|Numeric
|Required
|11
|The full amount that is requested/contested in a transaction. 2 decimal places allowed. +
Use `.` (decimal point) as the separator.

|payment-methods
m|payment-method
m|name
|String
|Optional
|15
|The name of the payment method used. Set this value to ``guaranteeddirectdebit``.

.6+|account-holder
2+m|first-name
|String
|
|32
|The first name of the consumer.

2+m|last-name
|String
|
|32
|The last name of the consumer.

2+m|email
|String
|
|64
|The email address of the consumer.

2+m|phone
|String
|
|32
|The phone number of the consumer.

2+m|date-of-birth
|String
|
|n/a
|The date of birth of the consumer.

2+m|address
m|street1
|String
|
|128
|The first line of the street address of the consumer.

m|state
|String
|
|32
|The state or province of the address of the consumer.

m|country
|Token
|
|3
|The Country Id of the address of the consumer.

m|city
|String
|
|32
|The city of the address of the consumer.

m|postal-code
|String
|
|16
|The postal code or ZIP of the address of the consumer.

3+|ip-address
|String
|
|45
a|The internet protocol address of the consumer as recorded by the entity receiving the transaction attempt from the consumer.

3+|order-number
|String
|
|64
a|String provided by the merchant, to store the 'Order Number' for the transaction.

3+|order-items
.6+|order-item
m|name
|Alphanumeric
|
|
a|Name of the item in the basket.

m|description
|
|
|
a|The ...

m|article-number
|Alphanumeric
|
|
a|EAN or other article identifier for merchant.

.2+|amount
2+m|currency
|String
|Required
|3
|The currency of the item price per unit.

2+m|value
|Number
|
|
|The item price per unit.

m|tax-rate
|Number
|
|
a|The item tax rate per unit.

m|quantity
|Number
|
|
a|The total count of items in the order.

3+|locale
|String
|Optional
|6
|A set of parameters that defines the user’s language, country and any special
variant preferences that the user wants to see in their user interface.
Typically used in conjunction with Hosted Payment Page.

3+|country
|Token
|
|3
|The Country Id of the address of the consumer.

3+|creditor-id
|String
|Optional
|256
|The creditor ID of the merchant, allowing him to process Guaranteed Direct Debit transactions.

.2+|mandate
2+m|mandate-id
|String
|Optional
|35
|The mandate Id for the mandate generated between the consumer and the merchant allowing
the merchant to debit the consumer’s bank account.

2+m|signed-date
|String
|Optional
|19
|The date that the mandate was signed.

3+|success-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after a successful payment, e.g. ``\https://{pp-redirect-url-success}``.

3+|cancel-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after having canceled a payment, e.g. ``\https://{pp-redirect-url-cancel}``.

3+|fail-redirect-url
|String
|Required
|256
|The URL to which the consumer is redirected after an unsuccessful payment, e.g. ``\https://{pp-redirect-url-error}``.
|===
