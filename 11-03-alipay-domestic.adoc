[#API_AlipayDomestic]
=== Alipay Domestic

image::images/11-03-alipay-domestic/AlipayDomestic_logo.jpg[alt=Alipay Domestic logo, width=200, align="right"]

[#API_AlipayDomestic_Introduction]
==== Introduction

Alipay is China's leading third-party online payment solution, providing
an easy, safe, and secure way for millions of individuals and businesses
to make and receive payments on the Internet. Alipay provides an escrow
payment service that reduces transaction risk for online consumers.
Shoppers have the ability to verify whether they are happy with goods
they have purchased before releasing funds to the seller.

[#API_AlipayDomestic_General]
==== General Information

[#API_AlipayDomestic_General_PaymentMode]
===== Payment Mode, Countries and Currencies

This table illustrates which payment mode _Alipay Domestic_ belongs
to. It also provides detailed information about the countries and
currencies which are relevant for _Alipay Domestic._

[cols="20h,80"]
|===
| Payment Mode | <<PaymentMethods_PaymentMode_Wallet, Wallet>>
| Countries | China
| Currencies | CNY
|===

[#API_AlipayDomestic_General_CommunicationFormats]
===== Communication Formats

This table illustrates how _Alipay Domestic_ notifications are encoded
and which languages and methods can be used for requests and responses.

[cols="20,40,40"]
|===
.2+h| Requests/Responses |Format  |XML, JSON, NVP
                         |Methods |POST
h| IPN Encodements     2+|Please follow the instructions given at
<<GeneralPlatformFeatures_IPN_NotificationExamples, Instant Payment Notification>> to set up IPN.
|===

[#API_AlipayDomestic_TransactionTypes]
==== Transaction Types

For transaction type details which are not given here look at 
<<AppendixB, Appendix B: Transaction Types>>.

[cols="e,"]
|===
| Transaction Type | Link to the Sample

| check-signature  |
| get-url          |
| debit            | See <<API_AlipayDomestic_Samples_Debit, samples>>
| refund-debit     | 
|===

[#AlipayDomestic_TestCredentials]
==== Test Credentials

[cols="15,55,30"]
|===
.2+h| URL(s) Endpoints
|For the transaction type _debit._
|``\https://api-test.wirecard.com/engine/rest/paymentmethods/``
|For the transaction types _refund-debit_ and _refund-request_.
|``\https://api-test.wirecard.com/engine/rest/payments/``

h| Merchant Account ID (MAID)
2+|Please contact <<ContactUs, merchant support>> for complete test credentials.

h| Username
2+|Please contact <<ContactUs, merchant support>> for complete test credentials.

h| Password
2+|Please contact <<ContactUs, merchant support>> for complete test credentials.

h| Secret Key
2+|Please contact <<ContactUs, merchant support>> for complete test credentials.
|===

[#API_AlipayDomestic_TestCredentials_Additional]
===== Additional Test Credentials on _Alipay Domestic_ Environment

[cols="20h, 80"]
|===
| Account Name | ``\alipaytest20091@gmail.com``
| Password | 111111
|===

[#API_AlipayDomestic_Workflow]
==== Workflow

._debit_ Workflow
image::images/11-03-alipay-domestic/AlipayDom_Workflow_debit.png[Alipay Domestic _debit_ Workflow]

. Consumer adds items to shopping basket.
. Consumer selects Payment Method _Alipay Domestic._
. Merchant initiates a _debit_ transaction.
. _Alipay Domestic_ responds with a redirection URL to the merchant.
. Merchant redirects consumer to _Alipay Domestic._
. Consumer enters his account data and confirms the payment.
. _Alipay Domestic_ processes the transaction
. _WPPG_ receives transaction status.
. _WPPG_ sends transaction status to merchant and redirects the
consumer to the merchant.
. Merchant receives the transaction's status and displays the
completion of the payment process to the consumer.

[#API_AlipayDomestic_Fields]
==== Fields

The fields required for Alipay are the same fields as
the <<RestApi_Fields, REST API Fields>>.  

[#API_AlipayDomestic_Samples]
==== Samples

[#API_AlipayDomestic_Samples_Debit]
===== _debit_

[#API_AlipayDomestic_Samples_Debit_Xml]
====== XML

.XML debit Request (Successful)

[source,xml]
----
POST https://sandbox-engine.thesolution.com/engine/rest/paymentmethods/ HTTP/1.1Accept-Encoding: gzip,deflate
Content-Type: application/xml
Authorization: Basic dGVhbWNpdHk6dGVhbWNpdHk=
Content-Length: 672
Host: sandbox-engine.thesolution.com
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <payment-methods>
    <payment-method name="alipay"/>
  </payment-methods>
  <merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id>
  <request-id>demo-00000000010</request-id>
  <transaction-type>debit</transaction-type>
  <requested-amount currency="CNY">1.01</requested-amount>
  <order-number>37530</order-number>
  <order-detail>Test product 001</order-detail>
  <ip-address>127.0.0.1</ip-address>
  <locale>en</locale>
  <account-holder>
    <first-name>John</first-name>
    <last-name>Doe</last-name>
    <email>john.doe@wirecard.com</email>
  </account-holder>
</payment>
----

.XML debit Response (Successful)

[source,xml]
----
HTTP/1.1 201 CreatedServer: nginx
Date: Wed, 10 Jun 2015 15:25:03 GMT
Content-Type: application/xml;charset=UTF-8
Content-Length: 1559
Connection: keep-alive
Content-Language: en-US

<payment xmlns="http://www.elastic-payments.com/schema/payment">
   <merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id>
   <transaction-id>ddae2fed-0f84-11e5-87be-00163e5411b5</transaction-id>
   <request-id>demo-00000000010</request-id>
   <transaction-type>debit</transaction-type>
   <transaction-state>success</transaction-state>
   <completion-time-stamp>2015-06-10T15:25:03.000Z</completion-time-stamp>
   <statuses>
      <status code="201.0000" description="The resource was successfully created." severity="information"/>
   </statuses>
   <requested-amount currency="CNY">1.01</requested-amount>
   <account-holder>
      <first-name>John</first-name>
      <last-name>Doe</last-name>
      <email>john.doe@wirecard.com</email>
   </account-holder>
   <ip-address>127.0.0.1</ip-address>
   <order-number>37530</order-number>
   <order-detail>Test product 001</order-detail>
   <payment-methods>
      <payment-method url="https://mapi.alipay.com/gateway.do?sign_type=MD5&amp;partner=2088101568358171&amp;_input_charset=utf-8&amp;service=create_direct_pay_by_user&amp;notify_url=https%3A%2F%2Fsandbox-engine.thesolution.com%2Fengine%2Fnotification%2Falipay%2F+&amp;return_url=https%3A%2F%2Fsandbox-engine.thesolution.com%2Fengine%2Fnotification%2Falipay%2Fredirect%2Fddae2fed-0f84-11e5-87be-00163e5411b5%2F&amp;out_trade_no=ddae2fed-0f84-11e5-87be-00163e5411b5&amp;payment_type=1&amp;subject=37530&amp;total_fee=1.01&amp;buyer_email=john.doe%40wirecard.com&amp;sign=f6821cc77d752ea2981e281325f7dce6" name="alipay"/>
   </payment-methods>
   <locale>en</locale>
</payment>
----

.XML debit Notification (Successful)

[source,xml]
----
Host: requestb.inContent-Type: text/plain
Total-Route-Time: 0
Connection: close
Payment.Request-Id: 7024F639-1ACA-458D-BA58-FFF8F05EFBE8
Content-Length: 5948
X-Request-Id: 66dc2fc3-bac3-4f5a-976c-f3879055b9df
Payment.Transaction-Id: c9297cf6-16c4-11e5-87be-00163e5411b5
Breadcrumbid: ID-staging-tomcat-n102-36990-1434638258564-0-4093
Via: 1.1 vegur
Connect-Time: 0
User-Agent: Jakarta Commons-HttpClient/3.1
Notification.Url: http://requestb.in/11h0jul1

<?xml version="1.0" encoding="UTF-8"?><payment xmlns="http://www.elastic-payments.com/schema/payment"><merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id><transaction-id>c9297cf6-16c4-11e5-87be-00163e5411b5</transaction-id><request-id>7024F639-1ACA-458D-BA58-FFF8F05EFBE8</request-id><transaction-type>debit</transaction-type><transaction-state>success</transaction-state><completion-time-stamp>2015-06-19T20:50:14.000Z</completion-time-stamp><statuses><status code="201.0000" description="alipay:The resource was successfully created." provider-transaction-id="2012111319234154" severity="information"/></statuses><requested-amount currency="CNY">1.010000</requested-amount><account-holder><first-name>John</first-name><last-name>Doe</last-name><email>alipay_test@alipay.com</email><phone>5555555555</phone><address><street1>150 Eglinton</street1><street2>Suite 111</street2><city>Toronto</city><state>ON</state><country>CA</country><postal-code>M4P1E8</postal-code></address></account-holder><ip-address>127.0.0.1</ip-address><order-number>PO98U457Z</order-number><order-detail>1 XL TShirt (white)</order-detail><notifications><notification url="http://requestb.in/11h0jul1"/></notifications><custom-fields><custom-field field-name="Invoice Number" field-value="IN4523H11"/></custom-fields><payment-methods><payment-method name="alipay"/></payment-methods><api-id>elastic-payment-page</api-id><processing-redirect-url/><cancel-redirect-url/><fail-redirect-url/><success-redirect-url/><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI=""><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>grYdTCI/l0WY/lfhndtb5KAnilg=</DigestValue></Reference></SignedInfo><SignatureValue>KBU++2waR3mDKvcSL4nCfb5r5+cFnIGxHLHjA274RLC7wY2t7ziYJuRkHYWw2Yq/AElgEi3lzicU
G3ZAVh2ksdsVznm0Sk+NMfJO8Duh6p5WwvH8nuCmDCpupTjvsYHWT6qklZjaXPkXJ59k8dCx+0Xg
Axt2Dh8/SLiqMbhEWmR9F5+ivrAKKiv0bIjtqVGz2kxIj2TIKxhWQNc/RA+3Qj+rudkD4YNXtosB
n+zSlxgUs4LBi5OzfEHeH7Gie7yyxlLJJpa5j/02rGB6taTLD3HZ1+zwscqKdVEHiY43jsymTp73
lEDkeGmrcH9R7PPQCGNjFxk6S77ROmRGyV7gRw==</SignatureValue><KeyInfo><X509Data><X509SubjectName>CN=*.thesolution.com,OU=Domain Control Validated,O=*.thesolution.com</X509SubjectName><X509Certificate>MIIFaTCCBFGgAwIBAgIHS05K//8WnzANBgkqhkiG9w0BAQUFADCByjELMAkGA1UEBhMCVVMxEDAO
BgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoTEUdvRGFkZHkuY29t
LCBJbmMuMTMwMQYDVQQLEypodHRwOi8vY2VydGlmaWNhdGVzLmdvZGFkZHkuY29tL3JlcG9zaXRv
cnkxMDAuBgNVBAMTJ0dvIERhZGR5IFNlY3VyZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTERMA8G
A1UEBRMIMDc5NjkyODcwHhcNMTExMTAxMTM1MzQxWhcNMTIxMjAxMTY0MTUwWjBbMRowGAYDVQQK
DBEqLnRoZXNvbHV0aW9uLmNvbTEhMB8GA1UECwwYRG9tYWluIENvbnRyb2wgVmFsaWRhdGVkMRow
GAYDVQQDDBEqLnRoZXNvbHV0aW9uLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
AKdw14rJ3PjXr8NbZFypT14XRKpBLuwH+Y8+GPq7mb+X4D20ZHwQklPvO1DsHbnKf4PfbxlSeX+i
jwJ78fDuM9yezS193wzmzJzBnpUkvduiPD7lBpx87tIVT9Hcpt9dMrqF4Y9UByzOws77gMux5gHF
tV9KmSL7RF0rHSCm5/27n9hzxAffspZXhS3l1cBKGkIiltt5OlGnCGCZvFruyw2R7W/Z9MxxtLOn
+YdB6i04fc4oygtvzt4DycZ0ZwjT10W3E7/k/xGUx/pYH9RLN3Niu9xanRLESJlt2ohFXoE2eArP
+y+QAyj8c4P+k6bPwZegXCFsNHXP6VJyDZtOLSECAwEAAaOCAcAwggG8MA8GA1UdEwEB/wQFMAMB
AQAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMA4GA1UdDwEB/wQEAwIFoDAzBgNVHR8E
LDAqMCigJqAkhiJodHRwOi8vY3JsLmdvZGFkZHkuY29tL2dkczEtNTkuY3JsMFMGA1UdIARMMEow
SAYLYIZIAYb9bQEHFwEwOTA3BggrBgEFBQcCARYraHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5
LmNvbS9yZXBvc2l0b3J5LzCBgAYIKwYBBQUHAQEEdDByMCQGCCsGAQUFBzABhhhodHRwOi8vb2Nz
cC5nb2RhZGR5LmNvbS8wSgYIKwYBBQUHMAKGPmh0dHA6Ly9jZXJ0aWZpY2F0ZXMuZ29kYWRkeS5j
b20vcmVwb3NpdG9yeS9nZF9pbnRlcm1lZGlhdGUuY3J0MB8GA1UdIwQYMBaAFP2sYTKTbEXW4u6F
X5q653aZaMznMC0GA1UdEQQmMCSCESoudGhlc29sdXRpb24uY29tgg90aGVzb2x1dGlvbi5jb20w
HQYDVR0OBBYEFGWt8Z80Urg6pSHSiuot3idSbCOHMA0GCSqGSIb3DQEBBQUAA4IBAQBrdO66l5sg
s9zUIKiY1oQsKah69RkcQo1f7cwBwNDQLi/DY0KD4efWjOjeon3noaoJ26rrfKyfCE8ShmjGcOuL
4YdEFdvuFgEIBe86jg5CnVF0vNfdiaIMJXAE/SaoK/b/NabepcvwC2/A+snNaf4kmJkDbHg3IvIY
62znQhzyQWzpYRYaA36XlBxhoYoz8jKLntfSF/SvXCy/f+J9+55T1r/U2kM5Ulem7z9PsaJUHJjl
M35hH6Phh1kFU8r0FCuySsfPdyqZe5Xc/bP7yOub4XINvnIEZMcDQfL+PCIEdYDxNbYM6+gtCl78
8Bz9XY5A6TrXcazIPwW/t3jTZRs/</X509Certificate></X509Data></KeyInfo></Signature></payment>
----

.XML debit Request (Failure)

[source,xml]
----
POST https://sandbox-engine.thesolution.com/engine/rest/paymentmethods/ HTTP/1.1Accept-Encoding: gzip,deflate
Content-Type: application/xml
Authorization: Basic dGVhbWNpdHk6dGVhbWNpdHk=
Content-Length: 277
Host: sandbox-engine.thesolution.com
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

<payment xmlns="http://www.elastic-payments.com/schema/payment">
  <payment-methods>
    <payment-method name="alipay"/>
  </payment-methods>
  <merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id>
  <request-id>demo-011111112</request-id>
</payment>
----

.XML debit Response (Failure)

[source,xml]
----
HTTP/1.1 201 CreatedServer: nginx
Date: Wed, 17 Jun 2015 16:33:32 GMT
Content-Type: application/xml;charset=UTF-8
Content-Length: 519
Connection: keep-alive
Content-Language: en-US

<?xml version="1.0" encoding="UTF-8" standalone="yes"?><payment xmlns="http://www.elastic-payments.com/schema/payment"><merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id><request-id>demo-011111112</request-id><transaction-state>failed</transaction-state><statuses><status code="400.1011" description="The Requested Amount has not been provided.  Please check your input and try again." severity="error"/></statuses><payment-methods><payment-method name="alipay"/></payment-methods></payment>
----

.XML debit Notification (Failure)

[source,xml]
----
Content-Type: text/plain
X-Request-Id: dfbf48c3-abbe-4511-9a2b-65a204f1fba9
Host: requestb.in
Content-Length: 5984
User-Agent: Jakarta Commons-HttpClient/3.1
Total-Route-Time: 0
Payment.Request-Id: C8AAC76A-E41A-42E1-9E2E-234ECBFFA3C1
Notification.Url: http://requestb.in/11h0jul1
Connection: close
Connect-Time: 1
Breadcrumbid: ID-staging-tomcat-n101-59038-1434563095388-0-4521
Via: 1.1 vegur
Payment.Transaction-Id: 467b957f-16c1-11e5-87be-00163e5411b5


<?xml version="1.0" encoding="UTF-8"?><payment xmlns="http://www.elastic-payments.com/schema/payment"><merchant-account-id>4fd7149f-14cd-4a67-a8cb-d54044504cc8</merchant-account-id><transaction-id>467b957f-16c1-11e5-87be-00163e5411b5</transaction-id><request-id>C8AAC76A-E41A-42E1-9E2E-234ECBFFA3C1</request-id><transaction-type>debit</transaction-type><transaction-state>failed</transaction-state><completion-time-stamp>2015-06-19T20:25:07.000Z</completion-time-stamp><statuses><status code="500.1999" description="alipay:The acquirer returned an unknown response.  Contact Technical Support." provider-transaction-id="2012111319234154" severity="error"/></statuses><requested-amount currency="CNY">1.010000</requested-amount><account-holder><first-name>John</first-name><last-name>Doe</last-name><email>alipay_test@alipay.com</email><phone>5555555555</phone><address><street1>150 Eglinton</street1><street2>Suite 111</street2><city>Toronto</city><state>ON</state><country>CA</country><postal-code>M4P1E8</postal-code></address></account-holder><ip-address>127.0.0.1</ip-address><order-number>PO98U457Z</order-number><order-detail>1 XL TShirt (white)</order-detail><notifications><notification url="http://requestb.in/11h0jul1"/></notifications><custom-fields><custom-field field-name="Invoice Number" field-value="IN4523H11"/></custom-fields><payment-methods><payment-method name="alipay"/></payment-methods><api-id>elastic-payment-page</api-id><processing-redirect-url/><cancel-redirect-url/><fail-redirect-url/><success-redirect-url/><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI=""><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>mqhOEJMTImb4P9xEORSOL9q86AE=</DigestValue></Reference></SignedInfo><SignatureValue>ZPm7gEPGCXTYpchTeKIhV1jpkBwAZhbq5bl4EutR5mWk6GHjCdhG1s9nCQHqJcwNmH6mN2Hunrif
+ZD1pE99CKikvftUZkcCc9Rw5l/5rKYIyLxpOelYfSW57wxj1U/7jlvKi1SrizoVP80gXwBhR2qm
56p+rdK7TR/nW+btTBt3T1hStgwvBgREYtXnlRwcu9Fe9oaGD6xGJwfalU3V/Q5LHDn7H8NZAjEJ
/ICcsXBTlTi8SYfO757+vAuHtTq2/uZQqSxNfvNdSXScH/goMKGEd8MPzkxKWMWzs6ohVQZoNk4p
XA3WSu0KCTdxgwNXcz4Op1L6ezCXEhUXnvbkiA==</SignatureValue><KeyInfo><X509Data><X509SubjectName>CN=*.thesolution.com,OU=Domain Control Validated,O=*.thesolution.com</X509SubjectName><X509Certificate>MIIFaTCCBFGgAwIBAgIHS05K//8WnzANBgkqhkiG9w0BAQUFADCByjELMAkGA1UEBhMCVVMxEDAO
BgNVBAgTB0FyaXpvbmExEzARBgNVBAcTClNjb3R0c2RhbGUxGjAYBgNVBAoTEUdvRGFkZHkuY29t
LCBJbmMuMTMwMQYDVQQLEypodHRwOi8vY2VydGlmaWNhdGVzLmdvZGFkZHkuY29tL3JlcG9zaXRv
cnkxMDAuBgNVBAMTJ0dvIERhZGR5IFNlY3VyZSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eTERMA8G
A1UEBRMIMDc5NjkyODcwHhcNMTExMTAxMTM1MzQxWhcNMTIxMjAxMTY0MTUwWjBbMRowGAYDVQQK
DBEqLnRoZXNvbHV0aW9uLmNvbTEhMB8GA1UECwwYRG9tYWluIENvbnRyb2wgVmFsaWRhdGVkMRow
GAYDVQQDDBEqLnRoZXNvbHV0aW9uLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
AKdw14rJ3PjXr8NbZFypT14XRKpBLuwH+Y8+GPq7mb+X4D20ZHwQklPvO1DsHbnKf4PfbxlSeX+i
jwJ78fDuM9yezS193wzmzJzBnpUkvduiPD7lBpx87tIVT9Hcpt9dMrqF4Y9UByzOws77gMux5gHF
tV9KmSL7RF0rHSCm5/27n9hzxAffspZXhS3l1cBKGkIiltt5OlGnCGCZvFruyw2R7W/Z9MxxtLOn
+YdB6i04fc4oygtvzt4DycZ0ZwjT10W3E7/k/xGUx/pYH9RLN3Niu9xanRLESJlt2ohFXoE2eArP
+y+QAyj8c4P+k6bPwZegXCFsNHXP6VJyDZtOLSECAwEAAaOCAcAwggG8MA8GA1UdEwEB/wQFMAMB
AQAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMA4GA1UdDwEB/wQEAwIFoDAzBgNVHR8E
LDAqMCigJqAkhiJodHRwOi8vY3JsLmdvZGFkZHkuY29tL2dkczEtNTkuY3JsMFMGA1UdIARMMEow
SAYLYIZIAYb9bQEHFwEwOTA3BggrBgEFBQcCARYraHR0cDovL2NlcnRpZmljYXRlcy5nb2RhZGR5
LmNvbS9yZXBvc2l0b3J5LzCBgAYIKwYBBQUHAQEEdDByMCQGCCsGAQUFBzABhhhodHRwOi8vb2Nz
cC5nb2RhZGR5LmNvbS8wSgYIKwYBBQUHMAKGPmh0dHA6Ly9jZXJ0aWZpY2F0ZXMuZ29kYWRkeS5j
b20vcmVwb3NpdG9yeS9nZF9pbnRlcm1lZGlhdGUuY3J0MB8GA1UdIwQYMBaAFP2sYTKTbEXW4u6F
X5q653aZaMznMC0GA1UdEQQmMCSCESoudGhlc29sdXRpb24uY29tgg90aGVzb2x1dGlvbi5jb20w
HQYDVR0OBBYEFGWt8Z80Urg6pSHSiuot3idSbCOHMA0GCSqGSIb3DQEBBQUAA4IBAQBrdO66l5sg
s9zUIKiY1oQsKah69RkcQo1f7cwBwNDQLi/DY0KD4efWjOjeon3noaoJ26rrfKyfCE8ShmjGcOuL
4YdEFdvuFgEIBe86jg5CnVF0vNfdiaIMJXAE/SaoK/b/NabepcvwC2/A+snNaf4kmJkDbHg3IvIY
62znQhzyQWzpYRYaA36XlBxhoYoz8jKLntfSF/SvXCy/f+J9+55T1r/U2kM5Ulem7z9PsaJUHJjl
M35hH6Phh1kFU8r0FCuySsfPdyqZe5Xc/bP7yOub4XINvnIEZMcDQfL+PCIEdYDxNbYM6+gtCl78
8Bz9XY5A6TrXcazIPwW/t3jTZRs/</X509Certificate></X509Data></KeyInfo></Signature></payment>
----

[#API_AlipayDomestic_Samples_Debit_Nvp]
====== NVP

.NVP debit Request (Successful)

[source]
----
POST https://sandbox-engine.thesolution.com/engine/rest/paymentmethods/ HTTP/1.1Accept-Encoding: gzip,deflate
Content-Type: application/x-www-form-urlencoded;charset=UTF-8
Authorization: Basic dGVhbWNpdHk6dGVhbWNpdHk=
Accept: text/plain
Content-Length: 307
Host: sandbox-engine.thesolution.com
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

merchant_account_id=4fd7149f-14cd-4a67-a8cb-d54044504cc8&request_id=demo-9424&transaction_type=debit&requested_amount_currency=CNY&requested_amount=1.01&first_name=John&last_name=Doe&email=john.doe@wirecard.com&order_number=15957&order_detail=TestProduct&locale=en&ip_address=127.0.0.1&payment_method=alipay
----

.NVP debit Response (Successful)

[source]
----
HTTP/1.1 201 CreatedServer: nginx
Date: Wed, 17 Jun 2015 13:58:46 GMT
Content-Length: 1181
Connection: keep-alive
Content-Language: en-US

order_number=15957&payment_method_url=https%3A%2F%2Fmapi.alipay.com%2Fgateway.do%3Fsign_type%3DMD5%26partner%3D2088101568358171%26_input_charset%3Dutf-8%26service%3Dcreate_direct_pay_by_user%26notify_url%3Dhttps%253A%252F%252Fsandbox-engine.thesolution.com%252Fengine%252Fnotification%252Falipay%252F%2B%26return_url%3Dhttps%253A%252F%252Fsandbox-engine.thesolution.com%252Fengine%252Fnotification%252Falipay%252Fredirect%252Ff86aa01d-14f8-11e5-87be-00163e5411b5%252F%26out_trade_no%3Df86aa01d-14f8-11e5-87be-00163e5411b5%26payment_type%3D1%26subject%3D15957%26total_fee%3D1.01%26buyer_email%3Djohn.doe%2540wirecard.com%26sign%3Dd8668eea74f6bd87a8d9e8458a8efc16&transaction_type=debit&locale=en&completion_time_stamp=20150617135845&status_code_1=201.0000&status_severity_1=information&transaction_state=success&transaction_id=f86aa01d-14f8-11e5-87be-00163e5411b5&first_name=John&merchant_account_id=4fd7149f-14cd-4a67-a8cb-d54044504cc8&ip_address=127.0.0.1&order_detail=TestProduct&request_id=demo-2664&requested_amount=1.01&requested_amount_currency=CNY&email=john.doe%40wirecard.com&status_description_1=The+resource+was+successfully+created.&last_name=Doe&payment_method=alipay&
----

.NVP debit Notification (Successful)

[source]
----
Content-Type: text/plainX-Request-Id: 302e2bc6-6017-49f0-8525-6ecf32f6664d
Host: requestb.in
Content-Length: 782
User-Agent: Jakarta Commons-HttpClient/3.1
Total-Route-Time: 0
Payment.Request-Id: c21d76ed-1d3d-5eee-e64f-aa0f6bced54d
Notification.Url: http://requestb.in/11h0jul1
Connection: close
Connect-Time: 0
Breadcrumbid: ID-staging-tomcat-n102-36990-1434638258564-0-4025
Via: 1.1 vegur
Payment.Transaction-Id: 916d9ac8-16c2-11e5-87be-00163e5411b5

phone=1+555+555+5555&transaction_type=debit&locale=&status_severity_1=information&status_code_1=201.0000&completion_time_stamp=20150619203422&state=ON&transaction_state=success&city=Toronto&merchant_account_id=4fd7149f-14cd-4a67-a8cb-d54044504cc8&first_name=John&requested_amount_currency=CNY&status_description_1=alipay%3AThe+resource+was+successfully+created.&response_signature=dc72eb8184a9d6aa3914d6fb8753ab8b30ae633324ec08da7693e1ba71446370&street1=123+test&transaction_id=916d9ac8-16c2-11e5-87be-00163e5411b5&country=CA&ip_address=127.0.0.1&request_id=c21d76ed-1d3d-5eee-e64f-aa0f6bced54d&provider_transaction_reference_id=&requested_amount=1.010000&email=john.doe%40wirecard.com&provider_transaction_id_1=2012111319234154&postal_code=M4P1E8&last_name=Doe&authorization_code=&
----

.NVP debit Request (Failure)

[source]
----
POST https://sandbox-engine.thesolution.com/engine/rest/paymentmethods/ HTTP/1.1Accept-Encoding: gzip,deflate
Content-Type: application/x-www-form-urlencoded
Authorization: Basic dGVhbWNpdHk6dGVhbWNpdHk=
Accept: text/plain
Content-Length: 312
Host: sandbox-engine.thesolution.com
Connection: Keep-Alive
User-Agent: Apache-HttpClient/4.1.1 (java 1.5)

merchant_account_id=7bc76f18-67f4-4080-943b-dbce27459aa5&request_id=demo-6835&transaction_type=debit&requested_amount_currency=&requested_amount=1.01&first_name=John&last_name=Doe&email=john.doe@wirecard.com&order_number=15957&order_detail=TestProduct&locale=en&ip_address=127.0.0.1&payment_method=alipay
----

.NVP debit Response (Failure)

[source]
----
HTTP/1.1 201 CreatedServer: nginx
Date: Wed, 17 Jun 2015 19:35:25 GMT
Content-Length: 474
Connection: keep-alive
Content-Language: en-US

order_number=15957&transaction_type=debit&locale=en&status_code_1=400.1012&status_severity_1=error&transaction_state=failed&first_name=John&merchant_account_id=7bc76f18-67f4-4080-943b-dbce27459aa5&ip_address=127.0.0.1&order_detail=TestProduct&request_id=demo-6835&requested_amount=1.01&email=john.doe%40wirecard.com&status_description_1=The+Requested+Amount+Currency+has+not+been+provided.++Please+check+your+input+and+try+again.&last_name=Doe&payment_method=alipay&
----

.NVP debit Notification (Failure)

[source]
----
Content-Type: text/plainX-Request-Id: 4c5a9b45-61cb-4d00-b00c-ec12f3314d29
Host: requestb.in
Content-Length: 807
User-Agent: Jakarta Commons-HttpClient/3.1
Total-Route-Time: 0
Payment.Request-Id: b084ff49-d7ed-dc11-70b5-285197d02677
Notification.Url: http://requestb.in/11h0jul1
Connection: close
Connect-Time: 1
Breadcrumbid: ID-staging-tomcat-n102-36990-1434638258564-0-4069
Via: 1.1 vegur
Payment.Transaction-Id: 0362410c-16c3-11e5-87be-00163e5411b5

phone=1+555+555+5555&transaction_type=debit&locale=&status_severity_1=error&status_code_1=500.1999&completion_time_stamp=20150619203733&state=ON&transaction_state=failed&city=Toronto&merchant_account_id=4fd7149f-14cd-4a67-a8cb-d54044504cc8&first_name=John&requested_amount_currency=CNY&status_description_1=alipay%3AThe+acquirer+returned+an+unknown+response.++Contact+Technical+Support.&response_signature=1ad9240967ddb2fa3cbae7cf9ea01037f59e3e795c674e9358e8af1d280016dc&street1=123+test&transaction_id=0362410c-16c3-11e5-87be-00163e5411b5&country=CA&ip_address=127.0.0.1&request_id=b084ff49-d7ed-dc11-70b5-285197d02677&provider_transaction_reference_id=&requested_amount=1.010000&email=john.doe%40wirecard.com&provider_transaction_id_1=2012111319234154&postal_code=M4P1E8&last_name=Doe&authorization_code=&
----
