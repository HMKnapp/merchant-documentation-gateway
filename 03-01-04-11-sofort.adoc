[#WPP_Sofort]
===== Sofort.

This is a reference page for _Sofort._ Here you find all the information
necessary for integrating this payment method into your Hosted and Embedded Payment Page.

.Are you unfamiliar with Wirecard Payment Page (WPP)?

NOTE: Visit one of the integration guides
(<<PPSolutions_WPP_HPP_HPPintegration, Hosted>>,
<<PPSolutions_WPP_HPP_EPPintegration, Embedded>>) for a quick explanation and
a step-by-step guide before continuing.

All <<PPSolutions_WPP, WPP>> integrations share a
<<PPSolutions_WPP_Workflow, common process flow>>﻿ for creating payments.

Below, you find example requests for all available transaction types, 
including field lists with short descriptions.

These requests are designed for the testing environment and do not
use real information. 

NOTE: For production, you need to use production credentials. For details
contact <<ContactUs, merchant support>>.

All given requests return successful responses.

For more details on the ``redirect-url``, see the 
<<PPSolutions_WPP_ConfigureRedirects, Configuring Redirects and IPNs for WPP>>﻿﻿ 
section.

For response verification examples, see
the <<PPSolutions_WPP_WPPSecurity, WPP Security>>﻿ section.


[#WPP_Sofort_About]
====== About _Sofort._

image::images/03-01-04-11-sofort/sofort_logo.png[Sofort logo, 200]

Sofort GmbH is a payment service provider which has been part of the Klarna Group since 2014.
_Sofort_ (also known as Pay now with Klarna) allows consumers to make online purchases 
using their online banking details. Merchants get a real-time transfer confirmation, and can 
dispatch their goods straight away.


[#WPP_Sofort_TestCredentials]
====== Test Credentials

[cols="35h,65"]
|===
| URI (Endpoint)             | ``\https://wpp-test.wirecard.com/api/payment/register``
| Merchant Account ID (MAID) | f19d17a2-01ae-11e2-9085-005056a96a54
| Username                   | 70000-APITEST-AP
| Password                   | qD2wzQ_hrc!8
| Secret Key (used for response verification) | ad39d9d9-2712-4abd-9016-cdeb60dc3c8f
|===

[#WPP_Sofort_TestCredentials_Sandbox]
.Testing Credentials for Sofort. Sandbox

[cols="35h,65"]
|===
| Bank (Sort Code)           | Demo Bank (00000)
| User ID/password/TAN/other | Arbitrary (4 characters minimum)
|===

NOTE: On Sofort. testing environment, use the sort code *00000* or the name
"Demo Bank" when prompted. For other credentials (User ID, password,
TAN) any number/text will do as long as it is at least 4 characters long.

image::images/03-01-04-11-sofort/sofort_testing.jpg[Sofort testing, 750]


[[Sofort.withWPP-TransactionTypes]]
Transaction Types
-----------------

One transaction type is available for** Sofort.** :

* link:#Sofort.withWPP-Debit[Debit]

[[Sofort.withWPP-DebitDebit]]
[[Sofort.withWPP-Debit]]Debit
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

A debit transaction charges the specified amount from the account
holder's bank account and marks it for immediate transfer.

For a successful debit transaction:

1.  Create a payment session (initial request).
2.  Redirect the customer to the payment page (initial response URL).
3.  Highly recommended: Parse and process the payment response. +

We provide ready-made JSON examples for each step of this process. You
can find them below.

API Endpoints

*Test*

`https://wpp-test.wirecard.com/api/payment/register`

*Production/Live*

Contact link:Contact-Us_4391175.html[merchant support] for your
production credentials.

This example is an initial request which creates the payment session. If
it is successful, you receive a URL as a response, which redirects to
the payment form.

*Request Headers*

[source,syntaxhighlighter-pre]
----
Authorization: Basic NzAwMDAtQVBJVEVTVC1BUDpxRDJ3elFfaHJjITg=
Content-Type: application/json
----

Optional fields

For a full list of optional fields you can use, see the REST API
link:Sofort._786562.html[Sofort specification].

For a full structure of a request (optional fields included), see the
link:#Sofort.withWPP-Field-reference[JSON/NVP Field Reference] section
at the bottom of this page.

*1. Create a Payment Session (Initial Request)*

[source,syntaxhighlighter-pre]
----
 {
    "payment": {
        "merchant-account-id": {
            "value":"f19d17a2-01ae-11e2-9085-005056a96a54"
        },
        "request-id":"{{$guid}}",
        "transaction-type": "debit",
        "requested-amount": {         
            "value": "10.1",
            "currency": "EUR"
        },
        "payment-methods": {
            "payment-method":[
            {
                "name": "sofortbanking"
            }
            ]
        },          
        "descriptor": "test",
        "success-redirect-url": "https://demoshop-test.wirecard.com/demoshop/#!/success",
        "fail-redirect-url": "https://demoshop-test.wirecard.com/demoshop/#!/error",        
        "cancel-redirect-url": "https://demoshop-test.wirecard.com/demoshop/#!/cancel"
    }
}
----

*Field (JSON)*

*Data Type*

*Required/* +
*Optional*

*Size*

*Description*

merchant-account-id

value

String

Required

36

A unique identifier assigned to every merchant account (by Wirecard).

request-id

String

Required

64

A unique identifier assigned to every request (by merchant). Used when
searching for or referencing it later. `{{$guid}}` serves as a
placeholder for a random request-id.

Allowed characters: +
a - z +
0 - 9 +
-_

transaction-type

String

Required

36

The requested transaction type. For Sofort. payments, the
transaction-type must be set to `debit`.

requested-amount 

value

Numeric

Required

18

The full amount that is requested/contested in a transaction. 2 decimal
places allowed.

Use `.` (decimal point) as the separator.

currency

String

Required

3

The currency of the requested/contested transaction amount. For Sofort.
payments, the currency must be set to*** ***`EUR`.

Format: 3-character abbreviation according to ISO 4217.

payment-method

name

String

Required

15

The name of the payment method used. Set this value to `sofortbanking`.

descriptor

String

Optional

100

Description of the transaction for account holder’s bank statement
purposes. 

success-redirect-url

String

Required

2000

The URL to which the consumer is redirected after a successful
payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/success`

fail-redirect-url

String

Required

2000

The URL to which the consumer is redirected after a failed payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/error`

cancel-redirect-url

String

Required

2000

The URL to which the consumer is redirected after having canceled a
payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/cancel `

*2. Redirect the Customer to the Payment Page (Initial Response URL)*

[source,syntaxhighlighter-pre]
----
{
"payment-redirect-url" : "https://wpp.wirecard.com/?wPaymentToken=f0c0e5b3-23ad-4cb4-abca-ed80a0e770e7"
}
----

[cols=",,",]
|=======================================================================
|*Field (JSON)* |*Data Type* |*Description*

|payment-redirect-url |String |The URL which redirects to the payment
form. Sent as a response to the initial request.
|=======================================================================

At this point, you need to redirect your customer to
`payment-redirect-url` (or render it in an `iframe` depending on your
link:Wirecard-Payment-Page_3704201.html[integration method]).

The customers are redirected to the payment form. There they enter their
data and submit the form to confirm the payment. A payment can be:

* successful (`transaction-state: success`),
* failed (`transaction-state: failed`),
* or the customer canceled the payment before/after submission
(`transaction-state: failed`).

The transaction result is the value of `transaction-state `in the
payment response. More details (including the status code) can also be
found in the payment response in the `statuses` object. Canceled
payments are returned as `"transaction-state" : "failed"`, but the
status description indicates it was canceled.

In any case (unless the customer cancels the transaction on a 3rd party
provider page), a base64 encoded response containing payment information
is sent to the configured redirection URL. See
link:Configuring-Redirects-and-IPNs-for-WPP_3704400.html[Configuring
Redirects and IPNs for WPP] for more details on redirection targets
after payment & transaction status notifications.

You can find a decoded payment response example below.

*3. Parse and Process the Payment Response (Decoded Payment Response)*

[source,syntaxhighlighter-pre]
----
 {
  "descriptor" : "test",
  "payment-methods" : {
    "payment-method" : [ {
      "name" : "sofortbanking"
    } ]
  },
  "parent-transaction-id" : "e9a8b4ad-161b-4721-a799-e512141f1512",
  "api-id" : "up3-wpp",
  "transaction-id" : "974d9b1e-5381-4813-b09c-5f755da43840",
  "statuses" : {
    "status" : [ {
      "description" : "Successful confirmation received from the bank.",
      "severity" : "information",
      "code" : "201.1126"
    } ]
  },
  "account-holder" : {
    "first-name" : "Max",
    "last-name" : "Mustermann"
  },
  "request-id" : "e2234c45-84ab-44a2-b299-56cab4fcc927",
  "requested-amount" : {
    "value" : 10.100000,
    "currency" : "EUR"
  },
  "transaction-state" : "success",
  "success-redirect-url" : "https://demoshop-test.wirecard.com/demoshop/#!/success",
  "merchant-account-id" : {
    "value" : "f19d17a2-01ae-11e2-9085-005056a96a54"
  },
  "completion-time-stamp" : "2018-04-13T10:47:10",
  "cancel-redirect-url" : "https://demoshop-test.wirecard.com/demoshop/#!/cancel",
  "fail-redirect-url": "https://demoshop-test.wirecard.com/demoshop/#!/error",
  "transaction-type" : "debit"
}
----

*Field (JSON)*

*Data Type*

*Description*

descriptor

String

Description of the transaction for account holder’s bank statement
purposes.

payment-method

name

String

The name of the payment method used.

parent-transaction-id

String

The ID of the transaction being referenced as a parent.

api-id

String

Identifier of the currently used API.

transaction-id

String

A unique identifier assigned to every transaction(by Wirecard). Used
when searching for or referencing to it later.

status +
 +

code

String

Status code of the status message.

description

String

The description of the transaction status message.

severity

String

The definition of the status message.

Possible values:

* `information`
* `warning`
* `error`

account-holder

first-name

String

The first name of the account holder.

last-name

String

The last name of the account holder.

request-id

String

A unique identifier assigned to every request (by merchant). Used when
searching for or referencing it later.

requested-amount

currency

String

The currency of the requested/contested transaction amount. For **
Sofort. ** payments, the currency must be set to `EUR`.

Format: 3-character abbreviation according to ISO 4217.

value

Numeric

The full amount that is requested/contested in a transaction.

transaction-state

String

The current transaction state.

Possible values:

* `in-progress`
* `success`
* `failed`

Typically, a transaction starts with state` in-progress` and finishes
with state either `success` or `failed`. This information is returned in
the response only.

success-redirect-url

String

The URL to which the consumer is redirected after a successful
payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/success`

merchant-account-id

value

String

A unique identifier assigned to every merchant account (by Wirecard).

completion-time-stamp

YYYY-MM-DD-Thh:mm:ss

The UTC/ISO time-stamp documents the time & date when the transaction
was executed. +
Format: YYYY-MM-DDThh:mm:ss (ISO).

cancel-redirect-url

String

The URL to which the consumer is redirected after having canceled a
payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/cancel`

fail-redirect-url

String

The URL to which the consumer is redirected after a failed payment, +
e.g. `https://demoshop-test.wirecard.com/demoshop/#!/error`

transaction-type

String

The requested transaction type. For Sofort. payments, the
transaction-type must be set to `debit`.

'''''

[[Sofort.withWPP-PostProcessingOperations]]
Post Processing Operations 
---------------------------

{empty}[[Sofort.withWPP-Follow-up]]

Use our link:REST-API_786616.html[REST API] for any post processing
operations. Check the REST API link:Sofort._786562.html[Sofort.
specification] for details on Sofort. specific transactions.

WPP is best used to deal with "one-off" payments (e.g. regular,
independent debit transactions) or the initial transaction in a chain of
them (e.g. a first authorization in a chain of recurring transactions).
However, when it comes to referencing a transaction for any kind of
follow-up — like a refund of one of your debit transactions — use
our link:REST-API_786616.html[REST API] directly.

For Sofort., there is only one post processing operation available:

* a refund, via SEPA Credit Transfer.

A direct refund through WPP is not possible for Sofort. so you have to
obtain your consumer's banking information and send the refund using
SEPA Credit Transfer. For examples and more information, see the REST
API https://document-center.wirecard.com/display/PREPTD/SEPA+Credit+Transfer[specification
for SEPA Credit Transfer]. 

'''''

[[Sofort.withWPP-Field-referenceJSON/NVPFieldReference]]
[[Sofort.withWPP-Field-reference]]JSON/NVP Field Reference
----------------------------------------------------------

Here you can:

* find the NVP equivalents for JSON fields (for migrating merchants),
* or see the structure of a full request (optional fields included).

*JSON Structure for Sofort. Requests*

[source,syntaxhighlighter-pre]
----
 {
    "payment": {
        "merchant-account-id": {
            "value":"string"
        },
        "request-id":"string",
        "transaction-type": "string",
        "requested-amount": {         
            "value": 0,
            "currency": "string"
        },
        "payment-methods": {
            "payment-method":[
            {
                "name": "string"
            }
            ]
        },
        "account-holder" : {
            "first-name" : "string",
            "last-name" : "string"
        },          
        "descriptor": "string",
        "success-redirect-url": "string",
        "fail-redirect-url": "string",  
        "cancel-redirect-url": "string"
    }
}
----

[cols=",,",]
|=================================================================
|*Field (NVP)* |*Field (JSON)* |*JSON Parent*
|merchant_account_id |value |merchant-account-id (\{ })
|request_id |request-id |payment (\{ })
|transaction_type |transaction-type |payment (\{ })
|requested_amount |value |requested-amount (\{ })
|requested_amount_currency |currency |requested-amount (\{ })
|payment_method |payment-method ([ ])/name |payment-methods (\{ })
|first_name |first-name |account-holder (\{ })
|last_name |last-name |account-holder (\{ })
|descriptor |descriptor |payment (\{ })
|success_redirect_url |success-redirect-url |payment (\{ })
|fail_redirect_url |fail-redirect-url |payment (\{ })
|cancel_redirect_url |cancel-redirect-url |payment (\{ })
|=================================================================

[[Sofort.withWPP-Response-onlyFields]]
Response-only Fields
~~~~~~~~~~~~~~~~~~~~

 

[source,syntaxhighlighter-pre]
----
{
"payment": {
  "transaction-id" : "string",
  "transaction-state" : "string",
  "completion-time-stamp" : "2018-03-23T10:41:34",
  "api-id" : "string",  
  "statuses" : {
    "status" : [ {
      "description" : "string",
      "severity" : "string",
      "code" : "string"      
    } ]
  }
  }
}
----

 

 

[cols=",,",]
|====================================================================
|*Field (NVP)* |*Field (JSON)* |*JSON Parent*
|transaction_id |transaction-id |payment (\{ })
|transaction_state |transaction-state |payment (\{ })
|completion_time_stamp |completion-time-stamp |payment (\{ })
|api_id |api-id |payment (\{ })
|status_description_n |status ([ \{} ])/ description |statuses (\{ })
|status_severity_n |status ([ \{} ])/ severity |statuses (\{ })
|status_code_n |status ([ \{} ])/ code |statuses (\{ })
|====================================================================

Attachments:
~~~~~~~~~~~~

image:images/icons/bullet_blue.gif[image,width=8,height=8]
link:attachments/3704254/4391144.png[Logo_Klarna_PayNow_128x192.png]
(image/png) +
image:images/icons/bullet_blue.gif[image,width=8,height=8]
link:attachments/3704254/4391145.jpg[sofort.jpg] (image/jpeg) +

[[footer]]
Document generated by Confluence on Feb 06, 2019 10:33

[[footer-logo]]
http://www.atlassian.com/[Atlassian]
