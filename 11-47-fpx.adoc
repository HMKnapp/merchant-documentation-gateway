include::shortcuts.adoc[]
:timestamp-pattern: YYYY-MM-DDThh:mm:ssZ

[#FPX]
=== FPX

[#PPv1_FPX_Introduction]
==== Introduction

image::images/11-47-fpx/fpx_logo.png[fpx logo, 200]

_FPX_ (Financial Process Exchange) is an online Internet Banking debit payment method that is offered by MyClear (Malaysia Electronic Clearing Corporation Sdn Bhd), which is a subsidiary under Bank Negara Malaysia (i.e. Malaysia's central bank). 

//vhauss: shall we remove "debit" from "...online Internet Banking debit payment method" as WPP V1 supports only "purchase"?
//vhauss: Frage: ist "Internet Banking" nicht immer online? evtl. reicht es sogar, nur zu sagen: "...is an online payment method that is offered by..."

// vhauss added from https://paynet.my/business-fpx.html
// from here
FPX service is suitable for all businesses that offer products or services via the internet. With FPX, all payments are concluded online in real-time basis, making the service as good as cash. Plus, it generates payment records, simplifies reconciliation and reduces risk, thereby encouraging more shoppers to shop online. 
//to here

All consumers have to do, is to choose their bank before they are sent to their respective bank's internet banking pages to confirm the purchase. 

[#FPX_GeneralInformation]
==== General Information

[#FPX_GeneralInformation_PaymentMode]
.Payment Mode, Countries, and Currencies

[cols="20h, 80"]
|===
| Payment Mode | <<PaymentMethods_PaymentMode_OnlineBankTransfer, Online Bank Transfer>>
| Countries | Malaysia 
| Currencies | MYR
|===

[#FPX_GeneralInformation_CommunicationFormats]
.Communication Formats

This table illustrates how _FPX_ notifications are encoded and
which formats and methods can be used for requests and responses.

|===
| *Requests/Responses* | NVP Format
| *IPN Encodement*     | Please follow the instructions given at
<<GeneralPlatformFeatures_IPN, Instant Payment Notification>> to set up IPN.
|===

[#FPX_TransactionTypes]
==== Transaction Types

{payment-page-v1} supports the transaction type _purchase_ only.

[#FPX_TestCredentials]
==== Test Credentials

[cols="35,65"]
|===
h| URL (Endpoint)
|``\https://test.{domain}.sg/engine/hpp/``
h| Merchant Account ID (MAID)
| 5f544f9f-c56a-4242-8ce7-d6422ca3599d

h| Username (to log in to Bank)
| 1234
h| Password (to log in to Bank)
| 1234
h| Secret Key 
| 0fbb1b24-6082-42d4-891e-cf9202083dcf
|===

===== Additional Test Credentials on _FPX_ Environment 
[cols="35,65"]
|===
.2+h| Banks to use for Bank Selection 
| SBI BANK A (to obtain a positive test case)
| SBI BANK B/C (to obtain negative test case)
|===

[#FPX_Workflow]
==== Workflow

[mermaid, CC_Fields_intro_elements_parentchild,svg,subs=attributes+]
----
sequenceDiagram
    participant Consumer
    participant Merchant
    participant {payment-gateway-abbr}
    participant FPX
Consumer->>Consumer: adds shopping items to basket.
Consumer->>Merchant: proceeds to checkout.
Merchant->>{payment-gateway-abbr}: sends payment request to {payment-gateway-abbr}.
{payment-gateway-abbr}->>Consumer: asks consumer to select a payment method.
Consumer->>{payment-gateway-abbr}: selects FPX.
{payment-gateway-abbr}->> Consumer: shows {payment-page-v1-abbr} with available banks for FPX.
Consumer->>{payment-gateway-abbr}: selects bank.
{payment-gateway-abbr}->>FPX: initiates the transaction.
FPX->>Consumer: redirects consumer to bank page.
Consumer->>Consumer: logs in on bank page.
Consumer->>FPX: completes payment on bank page.
FPX->>{payment-gateway-abbr}: sends transcation status to {payment-gateway-abbr}.
{payment-gateway-abbr}->>Merchant: sends notification to merchant.
Merchant->>Consumer: redirects consumer to merchant's status page.
----

. Consumer adds items to shopping basket.
. Merchant sends consumer's payment request to {payment-gateway-abbr} for processing.
. Consumer selects Payment Method _FPX_.
. {payment-gateway-abbr} displays list of available banks for consumer to select.
. Consumer selects desired bank.
. {payment-gateway-abbr} sends consumer to _FPX_ page, showing the details of the bank the consumer has selected.
. FPX sends consumer to desired bank page.
. Consumer logs in and proceeds with payment.
. {payment-gateway-abbr} receives transaction status from _FPX_.
. {payment-gateway-abbr} sends transaction status to merchant.
. Merchant receives the transaction's status and redirects the consumer to the status page of the payment process.

[#FPX_Fields]
==== Fields

The fields used for _FPX requests, responses and notifications are the
same as for REST API and Payment Page. Please refer to: <<RestApi_Fields, REST API Fields>> or <<PaymentPageSolutions_Fields, Payment Page>>.

[#FPX_Samples]
==== Sample

To test _FPX_, use the following JavaScript snippet.

NOTE: For details on hash-generation, go to our *{payment-page-v1-abbr} Security* section, see <<PP_Security_RequestSignature, Request Signature>> and <<PP_Security_SecretKeyExchange, Secret Key Exchange>>.

._purchase_ Request (Successful)

[source,javascript,subs=attributes+]

----
 var requestedData = {
    "request_time_stamp": getTimeStamp(), //get current timepstamp
    "request_id": generateUid(), //generate unique ID
    "merchant_account_id": "5f544f9f-c56a-4242-8ce7-d6422ca3599d",
    "transaction_type": "purchase",
    "requested_amount": "100.00",
    "requested_amount_currency" : "MYR",
    "success_redirect_url": "https://{pp-redirect-url-success}",
    "cancel_redirect_url": "https://{pp-redirect-url-cancel}",
    "fail_redirect_url": "https://{pp-redirect-url-error}",
    "ip_address" : "127.0.0.1",
    "secret_key": "0fbb1b24-6082-42d4-891e-cf9202083dcf",
    "psp_name": "demo",
    "first_name": "Test",
    "last_name": "User",
    "attempt_three_d" : "false",
    "request_signature": "" //generate request signature.
}
{payment-page-function}.hostedPay(requestData);
----

//-
